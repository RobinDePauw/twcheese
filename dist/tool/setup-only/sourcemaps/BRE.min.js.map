{"version":3,"sources":["BRE.js"],"names":["modules","installedModules","__webpack_require__","moduleId","exports","module","i","l","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","__webpack_exports__","DebugEvents","PHASE_COMPLETION_READY","PHASE_COMPLETION_NOT_READY","PHASE_CHANGED","QUESTION_ANSWERED","QUESTION_NOT_ANSWERED","OPTION_VALUE_CHANGED","BUG_REPORT_SUCCEEDED","BUG_REPORT_FAILED","USER_REJECTED","Phase","[object Object]","phaseName","this","followsUpOn","autoComplete","thingToFollowUpOn","auto","Error","PhaseTypes","ATTEMPT","QUESTION","REPORT","ProcessFactory","_twcheese_src_Models_Debug_DebugProcess_js__WEBPACK_IMPORTED_MODULE_0__","_twcheese_src_Models_Debug_Build_PhaseFactory_js__WEBPACK_IMPORTED_MODULE_1__","_twcheese_src_Models_Debug_BugReporter_js__WEBPACK_IMPORTED_MODULE_2__","_twcheese_src_Models_Debug_PhaseReport_js__WEBPACK_IMPORTED_MODULE_3__","lazyEvalUsingParent","parentPhase","str","parentResult","result","eval","actions","phaseFactory","cfg","finishWithReport","process","phaseCfg","phases","enqueuePhase","createPhase","bugReporter","lazyEval","phase","addFollowUpPhasesForSuccess","addFollowUpPhasesForAnswers","type","success","subPhase","addSuccessFollowUp","q","questionCfg","entries","questions","optionCfg","options","followUp","option","addFollowUp","DebugProcess","_twcheese_src_Models_Debug_DebugEvents_js__WEBPACK_IMPORTED_MODULE_0__","processName","currentPhaseIndex","push","watchPhase","splice","events","$","on","join","e","trigger","goToNextPhase","thing","getCurrentPhase","getThingsToFollowUpOn","followUpPhases","insertPhase","hasNextPhase","checkCompletionReady","start","length","slice","map","getSummary","PhaseReport","_twcheese_src_Models_Debug_Phase_js__WEBPACK_IMPORTED_MODULE_0__","_twcheese_src_Models_Debug_DebugEvents_js__WEBPACK_IMPORTED_MODULE_1__","_twcheese_src_Models_Debug_PhaseTypes_js__WEBPACK_IMPORTED_MODULE_2__","Status","SUCCESS","FAIL","NOT_ATTEMPTED","super","status","error","report","buildReport","submitReport","then","url","html_url","catch","finally","PhaseAttempt_PhaseAttempt","asyncFunctionToAttempt","instructions","attempt","async","fail","_error","_result","summarizeData","ctrl","successFollowUpPhases","abortableAttempt","err","console","warn","Promise","resolve","reject","func","cb","setFollowsUpOn","doAttempt","data","summarizeError","message","extra","stack","phaseNum","functionToAttempt","PhaseQuestion_PhaseQuestion","_examinedHtml","html","examinedHtml","question","isAnswered","reduce","acc","concat","QuestionTypes","VALUE","FREE_FORM","SELECT","Question_Question","text","selectedOptionIndex","index","getSelectedOption","answer","QuestionSelect_QuestionSelect","Option_Option","humanText","className","QuestionFreeForm_QuestionFreeForm","questionText","placeholderText","minResponseLength","setSelectedOption","watchSelectedOption","Correctness","CORRECT","INCORRECT","NOT_SURE","OPTION_INCORRECT","QuestionValue_QuestionValue","valueQuestioned","_valueQuestioned","assign","valueChecked","QuestionFactory_QuestionFactory","createQuestionFreeForm","createQuestionSelect","createQuestionValue","ask","addOption","valueExamined","examine","PhaseFactory_PhaseFactory","questionFactory","createPhaseAttempt","createPhaseQuestion","createPhaseReport","action","internalName","execute","summarizeResult","setDataSummarizer","setInstructions","lookAt","addQuestion","DataCollector","debugProcess","censoredProps","Set","scrub","buildData","nav","window","navigator","getSummarySoFar","contentHtml","document","getElementById","outerHTML","appCodeName","app","appName","appVersion","platfrom","userAgent","languages","extend","oscpu","gameData","game_data","keys","has","censorCsrfInString","replace","API","bugReport","BugReporter_BugReporter","title","dataCollected","getCollectibleData","majorVersion","world","player","TwCheese","version","JSON","stringify","createIssue","response","fetch","method","body","ok","statusText","json","getProp","propPath","defaultValue","tokens","split","token","language","buildings","twcheese","market","textScraper","gameTexts","textId","haystack","needle","includes","elements","searchFor","filter","el","buildingType","buildingName","game","image_base","ImageSrc_self","ROOT","ImageSrc","plus","minus","wood","stone","iron","attack","haulPartial","haulFull","info","attackSentViaFa","attackSizeSmall","attackSizeMedium","attackSizeLarge","attackContainsSnob","attackContainsSpy","attackContainsKnight","popupBackground","popupBorder","servant","loadingSpinner","calendar","sidebarMain","sidebarBug","sidebarGithub","jq","blue","black","darkGrey","grey","red","legacy","helpBackground","helpBackgroundBright","buildingIcon","troopIcon","troopType","dotIcon","color","scavengeOption","optionId","BattleReportCondensed_BattleReportCondensed","subject","attackIcons","attackerName","attackerNobleDied","attackerVillage","buildingLevels","defenderName","defenderVillage","defenderSurvivors","dotColor","haulStatus","HAUL_STATUS_UNKNOWN","isForwarded","loyalty","note","reportId","resources","strTimeReceived","timeLaunched","wasAttackFeint","isZero","HAUL_STATUS_FULL","village","Math","round","distanceTo","HAUL_STATUS_PARTIAL","Village","id","x","y","parseInt","otherVillage","diffX","diffY","hypot","Resource_Resource","amount","TYPE_TIMBER","TYPE_CLAY","TYPE_IRON","Resources_Resources","woodAmount","stoneAmount","ironAmount","other","factor","maxAmount","min","valueOf","TYPES","Config_Config","props","_loadCachedData","prop","setProp","_save","saved","localStorage","getItem","parse","_beforeSave","setItem","_getCacheableData","throttle","maxBurstsPerSecond","recentRequests","Array","unshift","performance","now","pop","anchorTimestamp","delayMs","setTimeout","originalFetch","requestDocument","sleepIfNeeded","responseText","doc","DOMParser","parseFromString","gameUrl","screen","uriParams","domain","TribalWars","buildURL","attackPrepUrl","unitCounts","targetVillageId","originVillageId","from","target_village_id","unitType","count","requestWasMade","apply","arguments","RemoteConfig_RemoteConfig","seconds","ttl","needsUpdate","update","Date","getTime","timeUpdated","xmlDoc","requestXml","_processXml","parseXmlNode","node","children","parseFloat","innerHTML","childNode","tagName","config","userConfig","gameConfig","setUrl","setTtl","buildingConfig","troopConfig","main","maxLevel","minLevel","popFactor","req","barracks","stable","smith","garage","church","farm","church_f","snob","place","statue","storage","hide","wall","watchtower","buildingTypes","resProductionHourly","level","popUsed","building","pop_factor","Buildings_BuildingLevels","fill","max_level","areRequirementsMet","reqs","requiredBuildingLevels","reqType","reqLevel","array","levels","forEach","buildingUtil","typeExistsOnWorld","Troops_troopTypes","travelMinutes","troop","speed","troopCarry","carry","TroopCounts","allowedTroopTypes","counts","values","sum","doSomething","capacity","troopPop","distance","role","calcTravelDuration","travelMinutesPerField","knight","relevantMinutes","max","subtrahend","difference","troopCounts","troops","minutesPerField","troopUtil","troopTypesOnWorld","units","existsOnWorld","resourceAmount","haulBonus","troopCount","carryCapacity","travelDuration","serverOffsetFromUtc","server_utc_diff","localOffsetFromUtc","getTimezoneOffset","pretendServerIsUTC","cheeseDate","addMilliseconds","TwCheeseDate_TwCheeseDate","Timing","getCurrentServerTime","days","ret","clone","setUTCDate","getUTCDate","hours","setUTCHours","getUTCHours","minutes","setUTCMinutes","getUTCMinutes","setUTCSeconds","getUTCSeconds","milliseconds","setUTCMilliseconds","getUTCMilliseconds","addDays","addHours","addMinutes","addSeconds","getUTCFullYear","getUTCMonth","date","isSameDayInUtc","tomorrow","otherDate","includeMillis","year","monthName","toLocaleString","month","day","toString","padStart","ms","getMonth","ReportRenamer_ReportRenamer","newName","createName","post","postToGame","ajaxaction","report_id","attacker","defender","timingInfo","calcTimingInfo","floor","launchTime","attackerLosses","after","toArray","reportName","trim","startsWith","parseTwCheeseName","parseDefaultName","fallbackReport","aName","dvX","dvY","match","avX","avY","avId","dName","dvId","matches","fromArray","newServerDate","catAmounts","catAmountsChurch","ramAmounts","invulnerable","DemolitionCalculator","demoScouted","demoBuffer","assignDemolition","siegeAmounts","whichSiegeLookup","bufferLevel","canUpgrade","oneShotScouted","oneShotUpgraded","BattleReport_BattleReport","attackerQuantity","attackerSurvivors","battleTime","catDamage","defenderLosses","defenderQuantity","espionageLevel","haul","luck","morale","ramDamage","unitsInTransit","unitsOutside","subMilliseconds","returnTime","startOfSecond","buildingPop","populationUsed","idle","populationCap","calcRaidUnits","home","timeNow","maxLoot","resourceCap","hideableResources","hourlyProduction","resourceProductionHourly","hoursSinceReport","resourcesProducedSinceReport","multiply","resourcesNow","add","travelHours","resourcesProducedDuringTravel","resourcesAtArrival","cap","countToCarry","periodHours","resourcesProduced","totalResources","suggestSiegeUnits","Player","StationedTroops","parseArrival","monthNumber","yearShort","millis","parseArrivalCzech","parseArrivalPortuguese","parseArrivalNL","parseArrivalEnglish","scrapeResources","resourcesContainer","$res","find","remove","resAmount","resIconCssClass","icon","parent","scrapePlayer","playerCell","playerLink","firstChild","href","scrapeTroopCounts","troopRow","troopTypes","cells","scrapeVillage","link","removeTroopsLabel","troopRowCopy","createElement","appendChild","BattleReportScraper_BattleReportScraper","gameDoc","$gameDoc","mainTable","parents","luckTable","attackerTable","attackerUnitsTable","defenderTable","defenderUnitsTable","resultsTable","supportKilledTable","_validate","shouldAlwaysBeThere","propName","getAttacker","getAttackerLosses","getAttackerQuantity","getAttackerVillage","getBattleTime","getBuildingLevels","getCatDamage","getDefender","getDefenderLosses","getDefenderQuantity","getDefenderVillage","getDotColor","getEspionageLevel","getHaul","getLoyalty","getLuck","getMorale","getRamDamage","getReportId","getResources","getUnitsOutside","getUnitsInTransit","subtract","levelAfter","rows","buildingData","val","thElements","getElementsByTagName","catHeader","first","damageCell","parentNode","bElements","levelBefore","attr","spied_resources","spied_buildings","spied_external","Number","haulHeader","luckString","substring","indexOf","loyaltyHeader","before","moraleContainer","moraleString","ramHeader","URL","resContainer","supportKilled","row","h4elements","transitHeader","nextSibling","bits","SENT_VIA_FA","CONTAINS_SNOB","CONTAINS_KNIGHT","SIZE_SMALL","SIZE_MEDIUM","SIZE_LARGE","CONTAINS_SPY","sizeThresholds","Icons","Map","src","description","AttackIcons","mask","icons","bit","wasSentViaFa","spy","threshold","AttackIconsScraper_AttackIconsScraper","imgElements","img","setSentViaFa","setContainsSnob","setContainsSpy","setContainsKnight","setSizeSmall","setSizeMedium","setSizeLarge","BattleReportCondensedScraper_BattleReportCondensedScraper","reportRenamer","attackIconsScraper","reportsTable","reports","scrapeReport","reportLink","reportIcons","parseName","isNew","endsWith","determineHaulStatus","scrapeIcons","lootImg","scoreDefenderDied","spear","sword","axe","archer","light","marcher","heavy","ram","catapult","militia","scoreAttackerDied","UI_escapeHtml","String","&","<",">","\"","'","cssInitd","initCss","css","appendTo","enhanceBattleReport","reportTable","defenseUnitsTable","rowAbove","survivorsRow","insertRow","insertCell","align","cell","unitCount","unit_table","population","calcPopulation","idleLabel","loyaltyExtra","reportedLoyalty","timeReported","target","hourlyGain","hoursPassed","loyaltyNow","loyaltyAtArrival","calcLoyalty","resultsHeaders","loyaltyRow","loyaltyHTML","removeChild","oddRow","oddHeader","defenderScore","calcDefenderScore","odaRow","odaHeader","attackerScore","calcAttackerScore","launchRow","toHtml","showReturnTime","returnRow","isDefenderMe","wasVillageConquered","linkHtml","jsonRow","colSpan","spawnLegacyHelpButton_language","AbstractWidget","_beforeInsert","$el","append","afterInsert","callback","observer","MutationObserver","mutations","outerloop","mutation","addedNodes","contains","disconnect","observe","attributes","childList","subtree","afterDOMInsert","ReportRaiderWidget_ReportRaiderWidget","raiderTroopTypes","initStructure","watchSelf","applyUserConfig","mayFillRallyPoint","$scoutsContainer","createHtml","$raidMode","$haulBonus","$period","$periodContainer","$scouts","$buttonSetDefault","raiderUnitsTable","$raiderLinks","$raiderTroopCounts","travelTimes","calcTravelDurations","rallyPointUrl","raidModeOptions","iconCells","troopCountCells","travelTimeCells","Format","timeSpan","updateRaiders","set","getScouts","getRaidMode","getHaulBonus","getPeriod","UI","SuccessMessage","period","scouts","raidMode","raiders","calcRaidScouted","setRaiders","calcRaidPredicted","calcRaidPeriodic","show","spyCount","attackUrl","eq","ReportRenamerWidget_ReportRenamerWidget","renamer","$note","$renameButton","$autoRename","$namePreview","$availableChars","availableChars","rename","checked","autoRename","ReportToolsWidget_ReportToolsWidget","initChildWidgets","$content","$toggleIcon","$raiderContainer","$renamerContainer","createDemolitionTableHtml","catHeaders","ramHeaders","catRowOne","catRowTwo","ramRowOne","ramRowTwo","suggestedCounts","buildingTypesOnWorld","headerInnerHtml","siegeWeapon","rowTwo","toggleCollapsed","toggle","duration","willCollapse","columnCategories_language","centeredImg","tooltip","villageLink","columnCategories_cfg","hideable","cols","width","header","haulStatusIconSrc","view","createCellHtml","getIcons","escapeHtml","defenderDistance","try","startHidden","resType","number","cssClass","columnCategories","category","cellAtIndex","endIndex","initialColSpan","ReportListWidget_ReportListWidget","columnIndexes","resizable","reportsFolderDisplay","style","overflow","position","height","minHeight","minWidth","reportsTableHeaderDiv","reportsTableHeader","tableLayout","cellIndex","titleTh","widthSum","colIndexes","col","alignmentTh","paddingTop","paddingBottom","lowerTh","borderSpacing","reportsTableBodyDiv","clientHeight","reportsTableBody","alignmentCell","yScrollPanel","overflowY","overflowX","background","right","scrollbarWidth","yTableEmulator","xScrollPanel","marginTop","xTableEmulator","clientWidth","$head","$body","$bodyPane","$xBodyEmulator","$yBodyEmulator","$xScrollPanel","$yScrollPanel","$headContainer","top","outerHeight","populateReportsTable","applySettings","fitDisplayComponents","scrollTop","scrollLeft","preventDefault","deltaY","sign","originalEvent","timeStart","scrollStep","msElapsed","stepY","requestAnimationFrame","minimal","fallbackSubjectColSpan","twcheeseReport","hasDecentInfo","textAlign","alignForTroops","alignForResources","adjustScrollbars","hideColumns","settingName","configKey","showColumn","hideColumn","column","head","tableWidth","columnWidth","display","bodyPaneHeight","maxChars","chars","alignCols","innerText","bodyCell","padding","isReportMatch","DisplayConfigurer_DisplayConfigurer","reportListWidget","widget","toggleReportsColumns","getHideableCategories","refreshContents","DisplayConfigWidget_DisplayConfigWidget","displayConfigurer","reportsFolderSettingsDiv","insertCheckbox","shouldShowColumn","toggleColumn","getHideableColumns","Exporter_Exporter","attackFrom","headerText","exportText","buildHeader","ATTACK_FROM_CURRENT","buildEntryCurrentVillage","ATTACK_FROM_ORIGINAL","buildEntryOriginalVillage","buildFooter","ExporterBBCode_ExporterBBCode","urlCurrentVillage","coord","urlOriginalVillage","ExporterPlainText_ExporterPlainText","ExporterHTML_ExporterHTML","leadingZero","ExportRepeatLinksWidget_ExportRepeatLinksWidget","defaultHeader","exporters","bbcode","plainLink","updateExportText","$exportText","$buttonCopy","$headerInput","$formatOptions","$attackingVillageOptions","select","execCommand","format","buildExportText","ReportSelector","getSelectedReportIds","selectMatchingReports","deselectAllReports","wasDefenderCleared","textLower","toLowerCase","nameLower","coordinates","ReportSelectorWidget_ReportSelectorWidget","reportSelector","reportsSelectorBar","borderStyle","borderWidth","reportsSelectorBarLabel","backgroundColor","backgroundImage","backgroundRepeat","fontSize","fontWeight","paddingLeft","selectorClickyTable","imgHtml","clickyOptions","click","selectAll","selectNone","selectNew","selectOld","selectDotColor","selectForwarded","selectLoot","BattleReportCondensed","selectFeint","selectDeadNoble","selectLoyalty","selectCleared","descriptor","optionEl","addEventListener","selectorInputTable","inputOptions","hintInput","hintButton","use","selectText","sprite","selectAttacker","selectDefender","placeholder","coords","selectAttackerVillage","selectDefenderVillage","input","size","alreadyCleared","$button","$buttonIcon","margin","MassRenamerWidget_language","MassRenamerWidget_MassRenamerWidget","$buttonRename","$progressCount","$targetCount","$progressPercent","$timeRemaining","massRename","reportIds","total","progress","estimatedTimeRemaining","startTime","reportDoc","fullReport","oldReport","minutesRemaining","secondsRemaining","refreshDisplay","ErrorMessage","ReportsFolderWidget_ReportsFolderWidget","reportsFolder","reportsFolderToolbar","currentPanel","toggleDisplayConfig","toggleExport","processCfg","initialized","reportEnhanced","reportsFolderEnhanced","processFactory","registerTool","narcismDiv","all","ensureUpdated","ensureRemoteConfigsUpdated","insertBefore","address","twcheese_menu","twcheese_menu_text","left","marginLeft","zIndex","onmouseover","onmouseout","cursor","onclick","open","spawnLegacyHelpButton","enhanceReport","alert","oldReportsList","reportsForm","reportScraper","scrapeReports","enhanceReportsFolder","getDebugProcess"],"mappings":"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","file":"../BRE.min.js","sourcesContent":["/******/ (function(modules) { // webpackBootstrap\n/******/ \t// The module cache\n/******/ \tvar installedModules = {};\n/******/\n/******/ \t// The require function\n/******/ \tfunction __webpack_require__(moduleId) {\n/******/\n/******/ \t\t// Check if module is in cache\n/******/ \t\tif(installedModules[moduleId]) {\n/******/ \t\t\treturn installedModules[moduleId].exports;\n/******/ \t\t}\n/******/ \t\t// Create a new module (and put it into the cache)\n/******/ \t\tvar module = installedModules[moduleId] = {\n/******/ \t\t\ti: moduleId,\n/******/ \t\t\tl: false,\n/******/ \t\t\texports: {}\n/******/ \t\t};\n/******/\n/******/ \t\t// Execute the module function\n/******/ \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n/******/\n/******/ \t\t// Flag the module as loaded\n/******/ \t\tmodule.l = true;\n/******/\n/******/ \t\t// Return the exports of the module\n/******/ \t\treturn module.exports;\n/******/ \t}\n/******/\n/******/\n/******/ \t// expose the modules object (__webpack_modules__)\n/******/ \t__webpack_require__.m = modules;\n/******/\n/******/ \t// expose the module cache\n/******/ \t__webpack_require__.c = installedModules;\n/******/\n/******/ \t// define getter function for harmony exports\n/******/ \t__webpack_require__.d = function(exports, name, getter) {\n/******/ \t\tif(!__webpack_require__.o(exports, name)) {\n/******/ \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n/******/ \t\t}\n/******/ \t};\n/******/\n/******/ \t// define __esModule on exports\n/******/ \t__webpack_require__.r = function(exports) {\n/******/ \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n/******/ \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n/******/ \t\t}\n/******/ \t\tObject.defineProperty(exports, '__esModule', { value: true });\n/******/ \t};\n/******/\n/******/ \t// create a fake namespace object\n/******/ \t// mode & 1: value is a module id, require it\n/******/ \t// mode & 2: merge all properties of value into the ns\n/******/ \t// mode & 4: return value when already ns object\n/******/ \t// mode & 8|1: behave like require\n/******/ \t__webpack_require__.t = function(value, mode) {\n/******/ \t\tif(mode & 1) value = __webpack_require__(value);\n/******/ \t\tif(mode & 8) return value;\n/******/ \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n/******/ \t\tvar ns = Object.create(null);\n/******/ \t\t__webpack_require__.r(ns);\n/******/ \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n/******/ \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n/******/ \t\treturn ns;\n/******/ \t};\n/******/\n/******/ \t// getDefaultExport function for compatibility with non-harmony modules\n/******/ \t__webpack_require__.n = function(module) {\n/******/ \t\tvar getter = module && module.__esModule ?\n/******/ \t\t\tfunction getDefault() { return module['default']; } :\n/******/ \t\t\tfunction getModuleExports() { return module; };\n/******/ \t\t__webpack_require__.d(getter, 'a', getter);\n/******/ \t\treturn getter;\n/******/ \t};\n/******/\n/******/ \t// Object.prototype.hasOwnProperty.call\n/******/ \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n/******/\n/******/ \t// __webpack_public_path__\n/******/ \t__webpack_require__.p = \"\";\n/******/\n/******/\n/******/ \t// Load entry module and return exports\n/******/ \treturn __webpack_require__(__webpack_require__.s = 8);\n/******/ })\n/************************************************************************/\n/******/ ([\n/* 0 */\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"a\", function() { return DebugEvents; });\nconst DebugEvents = {\r\n    PHASE_COMPLETION_READY: 'phase_completion_ready',\r\n    PHASE_COMPLETION_NOT_READY: 'phase_completion_not_ready',\r\n    PHASE_CHANGED: 'phase_changed',\r\n    QUESTION_ANSWERED: 'question_answered',\r\n    QUESTION_NOT_ANSWERED: 'question_not_answered',\r\n    OPTION_VALUE_CHANGED: 'answer_value_changed',\r\n    BUG_REPORT_SUCCEEDED: 'bug_report_succeeded',\r\n    BUG_REPORT_FAILED: 'bug_report_failed',\r\n    USER_REJECTED: 'user_rejected'\r\n};\r\n\r\n\r\n\n\n/***/ }),\n/* 1 */\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"a\", function() { return Phase; });\n\r\nclass Phase {\r\n    constructor(phaseName) {\r\n        this.name = phaseName;\r\n        this.followsUpOn = null;\r\n        this.autoComplete = false;\r\n    }\r\n\r\n    setFollowsUpOn(thingToFollowUpOn) {\r\n        this.followsUpOn = thingToFollowUpOn;\r\n        return this;\r\n    }\r\n\r\n    setAutoComplete(auto) {\r\n        this.autoComplete = auto;\r\n        return this;\r\n    }\r\n\r\n    getType() {\r\n        throw Error('notimplemented');\r\n    }\r\n\r\n    start() {\r\n        throw Error('not implemented');\r\n    }\r\n\r\n    checkCompletionReady() {\r\n        throw Error('not implemented');\r\n    }\r\n\r\n    getThingsToFollowUpOn() {\r\n        throw Error('not implemented');\r\n    }\r\n\r\n    getSummary() {\r\n        throw Error('not implemented');\r\n    }\r\n    \r\n}\r\n\r\n\n\n/***/ }),\n/* 2 */\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"a\", function() { return PhaseTypes; });\nconst PhaseTypes = {\r\n    ATTEMPT: 'attempt',\r\n    QUESTION: 'question',\r\n    REPORT: 'report'\r\n};\r\n\r\n\n\n/***/ }),\n/* 3 */\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"a\", function() { return ProcessFactory; });\n/* harmony import */ var _twcheese_src_Models_Debug_DebugProcess_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(4);\n/* harmony import */ var _twcheese_src_Models_Debug_Build_PhaseFactory_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(6);\n/* harmony import */ var _twcheese_src_Models_Debug_BugReporter_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(7);\n/* harmony import */ var _twcheese_src_Models_Debug_PhaseReport_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(5);\n\r\n\r\n\r\n\r\n\r\n\r\nfunction lazyEvalUsingParent(parentPhase) {\r\n    return (str) => {\r\n        return () => {\r\n            let parentResult = parentPhase.result;\r\n            return eval(str);\r\n        };\r\n    }\r\n}\r\n\r\n\r\nclass ProcessFactory {\r\n\r\n    constructor(actions) {\r\n        this.phaseFactory = new _twcheese_src_Models_Debug_Build_PhaseFactory_js__WEBPACK_IMPORTED_MODULE_1__[/* PhaseFactory */ \"a\"](actions);\r\n    }\r\n\r\n    create(name, cfg, finishWithReport) {\r\n        let process = new _twcheese_src_Models_Debug_DebugProcess_js__WEBPACK_IMPORTED_MODULE_0__[/* DebugProcess */ \"a\"](name);\r\n\r\n        for (let phaseCfg of cfg.phases) {\r\n            process.enqueuePhase(this.createPhase(phaseCfg));\r\n        }\r\n\r\n        if (finishWithReport) {\r\n            let bugReporter = new _twcheese_src_Models_Debug_BugReporter_js__WEBPACK_IMPORTED_MODULE_2__[/* BugReporter */ \"a\"](process);\r\n            process.enqueuePhase(_twcheese_src_Models_Debug_PhaseReport_js__WEBPACK_IMPORTED_MODULE_3__[/* PhaseReport */ \"a\"].create(bugReporter));\r\n        }\r\n\r\n        return process;\r\n    }\r\n\r\n    createPhase(cfg, lazyEval) {\r\n        let phase = this.phaseFactory.create(cfg, lazyEval);\r\n        this.addFollowUpPhasesForSuccess(phase, cfg);\r\n        this.addFollowUpPhasesForAnswers(phase, cfg);\r\n        return phase;\r\n    }\r\n\r\n    addFollowUpPhasesForSuccess(phase, cfg) {\r\n        if (cfg.type === 'PhaseAttempt' && cfg.success) {\r\n            for (let phaseCfg of cfg.success) {\r\n                let subPhase = this.createPhase(phaseCfg, lazyEvalUsingParent(phase));\r\n                phase.addSuccessFollowUp(subPhase);\r\n            }\r\n        }\r\n    }\r\n\r\n    addFollowUpPhasesForAnswers(phase, cfg) {\r\n        if (cfg.type !== 'PhaseQuestion') {\r\n            return;\r\n        }\r\n        \r\n        for (let [q, questionCfg] of Object.entries(cfg.questions)) {\r\n            if (questionCfg.type !== 'QuestionSelect') {\r\n                continue;\r\n            }\r\n            for (let [o, optionCfg] of Object.entries(questionCfg.options)) {\r\n                if (optionCfg.followUp) {\r\n                    for (let phaseCfg of optionCfg.followUp) {\r\n                        let option = phase.questions[q].options[o];\r\n                        let subPhase = this.createPhase(phaseCfg, lazyEvalUsingParent(phase))\r\n                        option.addFollowUp(subPhase);\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n};\r\n\r\n\n\n/***/ }),\n/* 4 */\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"a\", function() { return DebugProcess; });\n/* harmony import */ var _twcheese_src_Models_Debug_DebugEvents_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(0);\n\r\n\r\n\r\nclass DebugProcess {\r\n    constructor(processName) {\r\n        this.name = processName;\r\n        this.phases = [];\r\n        this.currentPhaseIndex = -1;\r\n    }\r\n\r\n    enqueuePhase(phase) {\r\n        this.phases.push(phase);\r\n        this.watchPhase(phase);\r\n        return this;\r\n    }\r\n\r\n    insertPhase(phase) {\r\n        this.phases.splice(this.currentPhaseIndex + 1, 0, phase);\r\n        this.watchPhase(phase);\r\n        return this;\r\n    }\r\n\r\n    watchPhase(phase) {\r\n        let events = [\r\n            _twcheese_src_Models_Debug_DebugEvents_js__WEBPACK_IMPORTED_MODULE_0__[/* DebugEvents */ \"a\"].PHASE_COMPLETION_READY,\r\n            _twcheese_src_Models_Debug_DebugEvents_js__WEBPACK_IMPORTED_MODULE_0__[/* DebugEvents */ \"a\"].PHASE_COMPLETION_NOT_READY,\r\n            _twcheese_src_Models_Debug_DebugEvents_js__WEBPACK_IMPORTED_MODULE_0__[/* DebugEvents */ \"a\"].PHASE_CHANGED\r\n        ];\r\n\r\n        $(phase).on(events.join(' '), (e) => $(this).trigger(e.type, e));\r\n\r\n        $(phase).on(_twcheese_src_Models_Debug_DebugEvents_js__WEBPACK_IMPORTED_MODULE_0__[/* DebugEvents */ \"a\"].PHASE_COMPLETION_READY, () => {\r\n            if (phase.autoComplete) {\r\n                this.goToNextPhase();\r\n            }\r\n        });\r\n    }\r\n\r\n    start() {\r\n        this.currentPhaseIndex = -1;\r\n        this.goToNextPhase();\r\n    }\r\n\r\n    goToNextPhase() {\r\n        if (this.currentPhaseIndex >= 0) {\r\n            for (let thing of this.getCurrentPhase().getThingsToFollowUpOn()) {\r\n                for (let phase of thing.followUpPhases) {\r\n                    this.insertPhase(phase);\r\n                }            \r\n            }\r\n        }        \r\n        if (!this.hasNextPhase()) {\r\n            throw Error(`there's no next phase`);\r\n        }\r\n        this.currentPhaseIndex++;\r\n        $(this).trigger(_twcheese_src_Models_Debug_DebugEvents_js__WEBPACK_IMPORTED_MODULE_0__[/* DebugEvents */ \"a\"].PHASE_CHANGED);\r\n        this.getCurrentPhase().checkCompletionReady();\r\n        this.getCurrentPhase().start();\r\n    }\r\n\r\n    hasNextPhase() {\r\n        return this.currentPhaseIndex < this.phases.length - 1;\r\n    }\r\n\r\n    getCurrentPhase() {\r\n        return this.phases[this.currentPhaseIndex];\r\n    }\r\n\r\n    getSummarySoFar() {\r\n        // everything before the current phase\r\n        return this.phases.slice(0, this.currentPhaseIndex)\r\n            .map(phase => phase.getSummary());\r\n    }\r\n\r\n    static create(processName) {\r\n        return new DebugProcess(processName);\r\n    }\r\n\r\n}\r\n\r\n\n\n/***/ }),\n/* 5 */\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"a\", function() { return PhaseReport; });\n/* harmony import */ var _twcheese_src_Models_Debug_Phase_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(1);\n/* harmony import */ var _twcheese_src_Models_Debug_DebugEvents_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(0);\n/* harmony import */ var _twcheese_src_Models_Debug_PhaseTypes_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(2);\n\r\n\r\n\r\n\r\n\r\nconst Status = {\r\n    SUCCESS: 'success',\r\n    FAIL: 'fail',\r\n    NOT_ATTEMPTED: 'not_attempted'\r\n};\r\n\r\n\r\nclass PhaseReport extends _twcheese_src_Models_Debug_Phase_js__WEBPACK_IMPORTED_MODULE_0__[/* Phase */ \"a\"] {\r\n    constructor(bugReporter) {\r\n        super('send bug report');\r\n        this.bugReporter = bugReporter;\r\n        this.status = Status.NOT_ATTEMPTED;\r\n        this.error;\r\n    }\r\n\r\n    getType() {\r\n        return _twcheese_src_Models_Debug_PhaseTypes_js__WEBPACK_IMPORTED_MODULE_2__[/* PhaseTypes */ \"a\"].REPORT;\r\n    }\r\n\r\n    start() {\r\n        let report = this.bugReporter.buildReport();\r\n        this.bugReporter.submitReport(report)\r\n            .then(d => {\r\n                this.status = Status.SUCCESS;\r\n                $(this).trigger({\r\n                    type: _twcheese_src_Models_Debug_DebugEvents_js__WEBPACK_IMPORTED_MODULE_1__[/* DebugEvents */ \"a\"].BUG_REPORT_SUCCEEDED,\r\n                    url: d.html_url\r\n                })\r\n            })\r\n            .catch(error => {\r\n                this.error = error;\r\n                this.status = Status.FAIL;\r\n                $(this).trigger(_twcheese_src_Models_Debug_DebugEvents_js__WEBPACK_IMPORTED_MODULE_1__[/* DebugEvents */ \"a\"].BUG_REPORT_FAILED)\r\n            })\r\n            .finally(() => this.checkCompletionReady());\r\n    }\r\n\r\n    checkCompletionReady() {\r\n        if (this.status !== Status.NOT_ATTEMPTED) {\r\n            $(this).trigger(_twcheese_src_Models_Debug_DebugEvents_js__WEBPACK_IMPORTED_MODULE_1__[/* DebugEvents */ \"a\"].PHASE_COMPLETION_READY);\r\n        } else {\r\n            $(this).trigger(_twcheese_src_Models_Debug_DebugEvents_js__WEBPACK_IMPORTED_MODULE_1__[/* DebugEvents */ \"a\"].PHASE_COMPLETION_NOT_READY);\r\n        }\r\n    }\r\n\r\n    getThingsToFollowUpOn() {\r\n        return [];\r\n    }\r\n\r\n    getSummary() {\r\n        return {\r\n            phaseName: this.name\r\n        };\r\n    }\r\n\r\n    static create(bugReporter) {\r\n        return new PhaseReport(bugReporter);\r\n    }\r\n}\r\n\r\n\r\n\n\n/***/ }),\n/* 6 */\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n\n// EXTERNAL MODULE: ./src/Models/Debug/Phase.js\nvar Phase = __webpack_require__(1);\n\n// EXTERNAL MODULE: ./src/Models/Debug/DebugEvents.js\nvar DebugEvents = __webpack_require__(0);\n\n// EXTERNAL MODULE: ./src/Models/Debug/PhaseTypes.js\nvar PhaseTypes = __webpack_require__(2);\n\n// CONCATENATED MODULE: ./src/Models/Debug/PhaseAttempt.js\n\r\n\r\n\r\n\r\nconst Status = {\r\n    SUCCESS: 'success',\r\n    FAIL: 'fail',\r\n    NOT_ATTEMPTED: 'not_attempted'\r\n};\r\n\r\n\r\nclass PhaseAttempt_PhaseAttempt extends Phase[\"a\" /* Phase */] {\r\n    constructor(phaseName, asyncFunctionToAttempt) {\r\n        super(phaseName);\r\n        this.instructions;\r\n        this.attempt = asyncFunctionToAttempt;\r\n        this.success = async () => {};\r\n        this.fail = async () => {};\r\n        this.status = Status.NOT_ATTEMPTED;\r\n        this.autoComplete = true;\r\n        this._error;\r\n        this._result;\r\n        this.summarizeData = d => d;\r\n        this.ctrl = {};\r\n\r\n        this.successFollowUpPhases = [];\r\n    }\r\n\r\n    getType() {\r\n        return PhaseTypes[\"a\" /* PhaseTypes */].ATTEMPT;\r\n    }\r\n\r\n    get result() {\r\n        if (this.status === Status.NOT_ATTEMPTED) {\r\n            throw new Error('tried to get result before the attempt settled');\r\n        }\r\n        if (this.status === Status.FAIL) {\r\n            throw new Error(`tried to get result of an attempt that failed`);\r\n        }\r\n        return this._result;\r\n    }\r\n\r\n    async doAttempt() {\r\n        try {\r\n            let result = await this.abortableAttempt();\r\n            this.status = Status.SUCCESS;\r\n            this._result = result;            \r\n            await this.success(result);\r\n        } catch (err) {\r\n            console.warn(err);\r\n            this.status = Status.FAIL;\r\n            this._error = err;\r\n            await this.fail(err);\r\n        }\r\n        this.checkCompletionReady();\r\n    }\r\n\r\n    async abortableAttempt() {\r\n        return new Promise(async (resolve, reject) => {\r\n            $(this.ctrl).on(DebugEvents[\"a\" /* DebugEvents */].USER_REJECTED, () => reject('user rejected'));\r\n            try {\r\n                let parentResult;\r\n                if (this.followsUpOn) {\r\n                    parentResult = this.followsUpOn.result;\r\n                }\r\n                let result = await this.attempt(parentResult, this.ctrl);\r\n                resolve(result);\r\n            }\r\n            catch(err) {\r\n                reject(err);\r\n            }            \r\n        });\r\n    }\r\n\r\n    userAbort() {\r\n        $(this.ctrl).trigger(DebugEvents[\"a\" /* DebugEvents */].USER_REJECTED);\r\n    }\r\n\r\n    setInstructions(instructions) {\r\n        this.instructions = instructions;\r\n        return this;\r\n    }\r\n\r\n    setDataSummarizer(func) {\r\n        this.summarizeData = func;\r\n        return this;\r\n    }\r\n\r\n    onSuccess(cb) {\r\n        this.success = cb;\r\n        return this;\r\n    }\r\n\r\n    addSuccessFollowUp(phase) {\r\n        this.successFollowUpPhases.push(phase);\r\n        phase.setFollowsUpOn(this);\r\n        return this;\r\n    }\r\n\r\n    get followUpPhases() {\r\n        if (this.status === Status.SUCCESS) {\r\n            return this.successFollowUpPhases;\r\n        }\r\n        return [];\r\n    }\r\n\r\n    onFail(cb) {\r\n        this.fail = cb;\r\n        return this;\r\n    }\r\n\r\n    start() {\r\n        this.doAttempt();\r\n    }\r\n\r\n    checkCompletionReady() {\r\n        if (this.status !== Status.NOT_ATTEMPTED) {\r\n            $(this).trigger(DebugEvents[\"a\" /* DebugEvents */].PHASE_COMPLETION_READY);\r\n        } else {\r\n            $(this).trigger(DebugEvents[\"a\" /* DebugEvents */].PHASE_COMPLETION_NOT_READY);\r\n        }\r\n    }\r\n\r\n    getThingsToFollowUpOn() {\r\n        return [this];\r\n    }\r\n\r\n    getSummary() {\r\n        return {\r\n            phaseName: this.name,\r\n            status: this.status,\r\n            data: typeof this._result === 'undefined' ? this._result : this.summarizeData(this._result),\r\n            error: this.summarizeError()\r\n        }\r\n    }\r\n\r\n    summarizeError() {\r\n        let err = this._error;\r\n        if (!(err instanceof Error)) {\r\n            return err;\r\n        }\r\n        return {\r\n            message: err.message,\r\n            name: err.name,\r\n            extra: err.extra,\r\n            stack: err.stack\r\n        };\r\n    }\r\n    \r\n    static create(phaseNum, functionToAttempt) {\r\n        return new PhaseAttempt_PhaseAttempt(phaseNum, functionToAttempt);\r\n    }\r\n\r\n}\r\n\r\n\n// CONCATENATED MODULE: ./src/Models/Debug/PhaseQuestion.js\n\r\n\r\n\r\n\r\n\r\nclass PhaseQuestion_PhaseQuestion extends Phase[\"a\" /* Phase */] {\r\n    constructor(phaseName) {\r\n        super(phaseName);\r\n        this.questions = [];\r\n        this._examinedHtml;\r\n    }\r\n\r\n    getType() {\r\n        return PhaseTypes[\"a\" /* PhaseTypes */].QUESTION;\r\n    }\r\n\r\n    lookAt(html) {\r\n        this._examinedHtml = html;\r\n        return this;\r\n    }\r\n\r\n    get examinedHtml() {\r\n        if (typeof this._examinedHtml === 'function') {\r\n            return this._examinedHtml();\r\n        }\r\n        return this._examinedHtml;\r\n    }\r\n\r\n    addQuestion(question) {\r\n        this.questions.push(question);\r\n        $(question).on(DebugEvents[\"a\" /* DebugEvents */].QUESTION_ANSWERED, () => {\r\n            this.checkCompletionReady();\r\n        });\r\n        $(question).on(DebugEvents[\"a\" /* DebugEvents */].QUESTION_NOT_ANSWERED, () => {\r\n            this.checkCompletionReady();\r\n        });\r\n        return this;\r\n    }\r\n\r\n    start() {\r\n        // do nothing;\r\n    }\r\n\r\n    checkCompletionReady() {\r\n        for (let question of this.questions) {\r\n            if (!question.isAnswered()) {\r\n                $(this).trigger(DebugEvents[\"a\" /* DebugEvents */].PHASE_COMPLETION_NOT_READY);\r\n                return;\r\n            }\r\n        }\r\n        $(this).trigger(DebugEvents[\"a\" /* DebugEvents */].PHASE_COMPLETION_READY);\r\n    }\r\n\r\n    getThingsToFollowUpOn() {\r\n        return this.questions.reduce((acc, question) => acc.concat(question.getThingsToFollowUpOn()), []);\r\n    }\r\n\r\n    getSummary() {\r\n        return {\r\n            phaseName: this.name,\r\n            questions: this.questions.map(question => question.getSummary())\r\n        };\r\n    }\r\n\r\n    static create(phaseName) {\r\n        return new PhaseQuestion_PhaseQuestion(phaseName);\r\n    }\r\n\r\n}\r\n\r\n\r\n\r\n\n// CONCATENATED MODULE: ./src/Models/Debug/QuestionTypes.js\nconst QuestionTypes = {\r\n    VALUE: 'value',\r\n    FREE_FORM: 'free_form',\r\n    SELECT: 'select'\r\n};\r\n\r\n\n// CONCATENATED MODULE: ./src/Models/Debug/Question.js\n\r\n\r\n\r\nclass Question_Question {\r\n    constructor(text) {\r\n        this.text = text;\r\n        this.options = [];\r\n        this.selectedOptionIndex = null;\r\n    }\r\n\r\n    getType() {\r\n        throw Error('not implemented');\r\n    }\r\n\r\n    addOption(option) {\r\n        this.options.push(option);\r\n        return this;\r\n    }\r\n\r\n    setSelectedOption(index) {\r\n        this.selectedOptionIndex = index;\r\n        $(this).trigger(DebugEvents[\"a\" /* DebugEvents */].QUESTION_ANSWERED);\r\n        return this;\r\n    }\r\n\r\n    isAnswered() {\r\n        return this.selectedOptionIndex !== null;\r\n    }\r\n\r\n    getSelectedOption() {\r\n        return this.options[this.selectedOptionIndex];\r\n    }\r\n\r\n    getThingsToFollowUpOn() {\r\n        let option = this.getSelectedOption();\r\n        return (option.followUpPhases.length > 0) ? [option] : [];\r\n    }\r\n\r\n    getSummary() {\r\n        return {\r\n            question: this.text,\r\n            answer: this.getSelectedOption().value\r\n        };\r\n    }\r\n\r\n    static create(text) {\r\n        return new Question_Question(text);\r\n    }\r\n}\r\n\r\n\n// CONCATENATED MODULE: ./src/Models/Debug/QuestionSelect.js\n\r\n\r\n\r\n\r\nclass QuestionSelect_QuestionSelect extends Question_Question {\r\n    getType() {\r\n        return QuestionTypes.SELECT;\r\n    }\r\n\r\n    static create(text) {\r\n        return new QuestionSelect_QuestionSelect(text);\r\n    }\r\n}\r\n\r\n\r\n\n// CONCATENATED MODULE: ./src/Models/Debug/Option.js\n\r\n\r\n\r\nclass Option_Option {\r\n    constructor(humanText, value, className = '') {\r\n        this.text = humanText;\r\n        this.value = value;\r\n        this.className = className;\r\n        this.followUpPhases = [];\r\n    }\r\n\r\n    addFollowUp(phase) {\r\n        this.followUpPhases.push(phase);\r\n        phase.setFollowsUpOn(this);\r\n        return this;\r\n    }\r\n\r\n    setValue(value) {\r\n        this.value = value;\r\n        $(this).trigger(DebugEvents[\"a\" /* DebugEvents */].OPTION_VALUE_CHANGED);\r\n    }\r\n\r\n    static create(humanText, value, className) {\r\n        return new Option_Option(humanText, value, className);\r\n    }\r\n\r\n}\r\n\r\n\n// CONCATENATED MODULE: ./src/Models/Debug/QuestionFreeForm.js\n\r\n\r\n\r\n\r\n\r\n\r\nclass QuestionFreeForm_QuestionFreeForm extends Question_Question {\r\n\r\n    constructor(questionText, placeholderText, minResponseLength = 0) {\r\n        super(questionText);\r\n        this.minResponseLength = minResponseLength;\r\n        this.options = [\r\n            Option_Option.create(placeholderText, '', 'free-form')\r\n        ];\r\n        this.setSelectedOption(0);\r\n        this.watchSelectedOption();        \r\n    }\r\n\r\n    getType() {\r\n        return QuestionTypes.FREE_FORM;\r\n    }\r\n\r\n    watchSelectedOption() {\r\n        $(this.getSelectedOption()).on(DebugEvents[\"a\" /* DebugEvents */].OPTION_VALUE_CHANGED, () => {\r\n            if (this.isAnswered()) {\r\n                $(this).trigger(DebugEvents[\"a\" /* DebugEvents */].QUESTION_ANSWERED);\r\n            } else {\r\n                $(this).trigger(DebugEvents[\"a\" /* DebugEvents */].QUESTION_NOT_ANSWERED);\r\n            }\r\n        });\r\n    }\r\n\r\n    isAnswered() {\r\n        return super.isAnswered() && this.options[0].value.length >= this.minResponseLength;\r\n    }\r\n\r\n    static create(questionText, placeholderText, minResponseLength) {\r\n        return new QuestionFreeForm_QuestionFreeForm(questionText, placeholderText, minResponseLength);\r\n    }\r\n\r\n}\r\n\r\n\r\n\n// CONCATENATED MODULE: ./src/Models/Debug/Correctness.js\n\r\nconst Correctness = {\r\n    CORRECT: 'correct',\r\n    INCORRECT: 'incorrect',\r\n    NOT_SURE: 'not_sure'\r\n}\r\n\r\n\n// CONCATENATED MODULE: ./src/Models/Debug/QuestionValue.js\n\r\n\r\n\r\n\r\n\r\n\r\nconst OPTION_INCORRECT = 1;\r\n\r\nclass QuestionValue_QuestionValue extends Question_Question {\r\n\r\n    constructor(questionText, valueQuestioned) {\r\n        super(questionText);\r\n        this._valueQuestioned = valueQuestioned;\r\n        this.options = [\r\n            Option_Option.create('Correct', Correctness.CORRECT, 'correct'),\r\n            Option_Option.create('Incorrect', Correctness.INCORRECT, 'incorrect'),\r\n            Option_Option.create('Not sure', Correctness.NOT_SURE, 'not-sure')\r\n        ];\r\n    }\r\n\r\n    get value() {\r\n        if (typeof this._valueQuestioned === 'function') {\r\n            return this._valueQuestioned();\r\n        }\r\n        return this._valueQuestioned;\r\n    }\r\n\r\n    getType() {\r\n        return QuestionTypes.VALUE;\r\n    }\r\n\r\n    addFollowUp(phase) {\r\n        this.options[OPTION_INCORRECT].addFollowUp(phase);\r\n        return this;\r\n    }\r\n\r\n    getSummary() {\r\n        return Object.assign(super.getSummary(), {\r\n            valueChecked: this.value\r\n        });\r\n    }\r\n\r\n    static create(questionText, valueQuestioned) {\r\n        return new QuestionValue_QuestionValue(questionText, valueQuestioned);\r\n    }\r\n}\r\n\r\n\n// CONCATENATED MODULE: ./src/Models/Debug/Build/QuestionFactory.js\n\r\n\r\n\r\n\r\n\r\n\r\nclass QuestionFactory_QuestionFactory {\r\n    \r\n    create(cfg, lazyEval) {\r\n        switch (cfg.type) {\r\n            case 'QuestionFreeForm':\r\n                return this.createQuestionFreeForm(cfg);\r\n            case 'QuestionSelect':\r\n                return this.createQuestionSelect(cfg);\r\n            case 'QuestionValue':\r\n                return this.createQuestionValue(cfg, lazyEval);\r\n            default:\r\n                throw `unrecognized question type: ${cfg.type}`;\r\n        }\r\n    }\r\n\r\n    createQuestionFreeForm(cfg) {\r\n        let minResponseLength = cfg.minResponseLength || 0;\r\n        return QuestionFreeForm_QuestionFreeForm.create(cfg.ask, cfg.placeholderText, minResponseLength);\r\n    }\r\n\r\n    createQuestionSelect(cfg) {\r\n        let question = QuestionSelect_QuestionSelect.create(cfg.ask);\r\n\r\n        for (let optionCfg of cfg.options) {\r\n            question.addOption(Option_Option.create(optionCfg.answer, optionCfg.value));\r\n        }\r\n\r\n        return question;\r\n    }\r\n\r\n    createQuestionValue(cfg, lazyEval) {\r\n        let valueExamined = lazyEval(cfg.examine);\r\n        return QuestionValue_QuestionValue.create(cfg.ask, valueExamined);\r\n    }\r\n\r\n}\r\n\r\n\n// CONCATENATED MODULE: ./src/Models/Debug/Build/PhaseFactory.js\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"a\", function() { return PhaseFactory_PhaseFactory; });\n\r\n\r\n\r\n\r\n\r\nclass PhaseFactory_PhaseFactory {\r\n\r\n    constructor(actions) {\r\n        this.actions = actions;\r\n        this.questionFactory = new QuestionFactory_QuestionFactory();\r\n    }\r\n\r\n    create(cfg, lazyEval) {\r\n        switch (cfg.type) {\r\n            case 'PhaseAttempt':\r\n                return this.createPhaseAttempt(cfg);\r\n            case 'PhaseQuestion':\r\n                return this.createPhaseQuestion(cfg, lazyEval);\r\n            case 'PhaseReport':\r\n                return this.createPhaseReport(cfg);\r\n            default:\r\n                throw Error(`unrecognized phase type ${cfg.type}`);\r\n        }\r\n    }\r\n\r\n    createPhaseAttempt(cfg) {\r\n        let action = this.actions[cfg.action];\r\n        if (typeof action === 'undefined') {\r\n            throw Error(`unrecognized action: ${cfg.action}`);\r\n        }\r\n\r\n        let phase = PhaseAttempt_PhaseAttempt.create(cfg.internalName, action.execute);\r\n\r\n        if (action.summarizeResult) {\r\n            phase.setDataSummarizer(action.summarizeResult);\r\n        }\r\n        if (cfg.instructions) {\r\n            phase.setInstructions(cfg.instructions);\r\n        }\r\n        return phase;\r\n    }\r\n\r\n    createPhaseQuestion(cfg, lazyEval) {\r\n        let phase = PhaseQuestion_PhaseQuestion.create(cfg.internalName);\r\n\r\n        if (cfg.lookAt) {\r\n            phase.lookAt(lazyEval(cfg.lookAt));\r\n        }\r\n\r\n        for (let questionCfg of cfg.questions) {\r\n            let question = this.questionFactory.create(questionCfg, lazyEval);\r\n            phase.addQuestion(question);\r\n        }\r\n        \r\n        return phase;\r\n    }\r\n\r\n}\r\n\r\n\n\n/***/ }),\n/* 7 */\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n\n// CONCATENATED MODULE: ./src/Models/Debug/DataCollector.js\n\r\nclass DataCollector {\r\n    constructor(debugProcess) {\r\n        this.process = debugProcess;\r\n        this.censoredProps = new Set(['csrf', 'birthdate']);\r\n    }\r\n\r\n    getCollectibleData() {\r\n        return this.scrub(this.buildData());\r\n    }\r\n\r\n    buildData() {\r\n        let nav = window.navigator;\r\n\r\n        return {\r\n            process: this.process.getSummarySoFar(),\r\n            contentHtml: document.getElementById('contentContainer').outerHTML,\r\n            navigator: {\r\n                appCodeName: nav.app,\r\n                appName: nav.appName,\r\n                appVersion: nav.appVersion,\r\n                platfrom: nav.platfrom,\r\n                userAgent: nav.userAgent,\r\n                languages: $.extend(true, [], nav.languages),\r\n                oscpu: nav.oscpu\r\n            },\r\n            gameData: $.extend(true, {}, window.game_data)\r\n        }\r\n    }\r\n\r\n    scrub(d) {\r\n        if (typeof d === 'object' && d !== null) {\r\n            for (let key of Object.keys(d)) {\r\n                if (this.censoredProps.has(key)) {\r\n                    d[key] = 'CENSORED';\r\n                } else {\r\n                    d[key] = this.scrub(d[key]);\r\n                }\r\n            }\r\n        }\r\n        if (typeof d === 'string') {\r\n            return this.censorCsrfInString(d);\r\n        }\r\n        return d;\r\n    }\r\n\r\n    censorCsrfInString(s) {\r\n        return s.replace(/((&|&amp;)h=)(\\w+)/g, '$1CENSORED')\r\n            .replace(/(\\?h=)(\\w+)(&|&amp;)/g, '$1CENSORED$3')\r\n            .replace(/(csrf_token = ')(\\w+)/g, '$1CENSORED')\r\n            .replace(/(\"csrf\":\")(\\w+)/g, '$1CENSORED');\r\n    }\r\n}\r\n\r\n\n// CONCATENATED MODULE: ./conf/API.js\nlet API = {\r\n    bugReport: {\r\n        url: 'https://56hqsw3c2c.execute-api.us-east-2.amazonaws.com/prod/bugreport'\r\n    }\r\n}\r\n\r\n\r\n\r\n\n// CONCATENATED MODULE: ./src/Models/Debug/BugReporter.js\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"a\", function() { return BugReporter_BugReporter; });\n\r\n\r\n\r\nclass BugReporter_BugReporter {\r\n    constructor(process) {\r\n        this.process = process;\r\n    }\r\n\r\n    buildReport() {\r\n        return {\r\n            title: '[Bug report] ' + this.process.name,\r\n            dataCollected: (new DataCollector(this.process)).getCollectibleData()\r\n        }\r\n    }\r\n\r\n    async submitReport(report) {\r\n        let message = [\r\n            '|game version|world|player|twcheese|',\r\n            '|---|---|---|---|',\r\n            `|${game_data.majorVersion}|${game_data.world}|${game_data.player.name}|${window.TwCheese.version}|`,\r\n            '```' + JSON.stringify(report.dataCollected, null, 2) +  '```'\r\n        ].join(\"\\n\");\r\n        return await this.createIssue(report.title, message);\r\n    }\r\n\r\n    async createIssue(title, message) {\r\n        let response = await fetch(API.bugReport.url, {\r\n            method: 'POST',\r\n            body: JSON.stringify({\r\n                title: title,\r\n                message: message\r\n            })\r\n        });\r\n        if (!response.ok) {\r\n            throw new Error(`Failed to create issue. [${response.status}: ${response.statusText}]`);\r\n        }\r\n        return await response.json();\r\n    }\r\n\r\n}\r\n\r\n\n\n/***/ }),\n/* 8 */\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n__webpack_require__.r(__webpack_exports__);\n\n// CONCATENATED MODULE: ./src/Util/Object.js\n\r\n\r\nfunction getProp(object, propPath, defaultValue) {\r\n    let tokens = propPath.split('.');\r\n    for (let i = 0; i < tokens.length - 1; i++) {\r\n        let token = tokens[i];\r\n        if (typeof object[token] !== 'object' || token === null) {\r\n            return defaultValue;\r\n        }\r\n        object = object[token];\r\n    }\r\n    let value = object[tokens[tokens.length - 1]];\r\n    return (typeof value === 'undefined') ? defaultValue : value;\r\n}\r\n\r\n\r\nfunction setProp(object, propPath, value) {\r\n    let tokens = propPath.split('.');\r\n    for (let i = 0; i < tokens.length - 1; i++) {\r\n        let token = tokens[i];\r\n        if (typeof object[token] !== 'object' || token === null) {\r\n            object[token] = {};\r\n        }\r\n        object = object[token];\r\n    }\r\n    object[tokens[tokens.length - 1]] = value;\r\n}\r\n\r\n\r\n\n// CONCATENATED MODULE: ./src/Scrape/TextScraper.js\n\r\n\r\nvar language = { \"buildings\": {}, \"report\": {}, \"twcheese\": {} };\r\nswitch (game_data.market) {\r\n    default:\r\n        /*==== tribalwars.net, tribalwars.us, tribalwars.co.uk, beta.tribalwars.net ====*/\r\n        language['buildings']['main'] = 'Headquarters';\r\n        language['buildings']['barracks'] = 'Barracks';\r\n        language['buildings']['stable'] = 'Stable';\r\n        language['buildings']['garage'] = 'Workshop';\r\n        language['buildings']['church'] = 'Church';\r\n        language['buildings']['church_f'] = 'First church';\r\n        language['buildings']['snob'] = 'Academy';\r\n        language['buildings']['smith'] = 'Smithy';\r\n        language['buildings']['place'] = 'Rally point';\r\n        language['buildings']['statue'] = 'Statue';\r\n        language['buildings']['market'] = 'Market';\r\n        language['buildings']['wood'] = 'Timber camp';\r\n        language['buildings']['stone'] = 'Clay pit';\r\n        language['buildings']['iron'] = 'Iron mine';\r\n        language['buildings']['farm'] = 'Farm';\r\n        language['buildings']['storage'] = 'Warehouse';\r\n        language['buildings']['hide'] = 'Hiding place';\r\n        language['buildings']['wall'] = 'Wall';\r\n        language['buildings']['watchtower'] = 'Watchtower';\r\n\r\n        language['report']['catDamage'] = 'Damage by catapults:';\r\n        language['report']['ramDamage'] = 'Damage by rams:';\r\n        language['report']['haul'] = 'Haul:';\r\n        language['report']['loyalty'] = 'Loyalty:';\r\n        language['report']['unitsInTransit'] = 'Defender\\'s troops, that were in transit';\r\n        language['report']['deletedPlayer'] = '(deleted)';\r\n        language['report']['unread'] = '(new)';\r\n        break;\r\n\r\n    case 'cz':\r\n        /*==== divokekmeny.cz/ ====*/\r\n        language['buildings']['main'] = 'Hlavní budova';\r\n        language['buildings']['barracks'] = 'Kasárna';\r\n        language['buildings']['stable'] = 'Stáj';\r\n        language['buildings']['garage'] = 'Dílna';\r\n        language['buildings']['church'] = 'Kostel';\r\n        language['buildings']['church_f'] = 'První kostel';\r\n        language['buildings']['snob'] = 'Panský dvůr';\r\n        language['buildings']['smith'] = 'Kovárna';\r\n        language['buildings']['place'] = 'Nádvoří';\r\n        language['buildings']['statue'] = 'Socha';\r\n        language['buildings']['market'] = 'Tržiště';\r\n        language['buildings']['wood'] = 'Dřevorubec';\r\n        language['buildings']['stone'] = 'Lom na těžbu hlíny';\r\n        language['buildings']['iron'] = 'Železný důl';\r\n        language['buildings']['farm'] = 'Selský dvůr';\r\n        language['buildings']['storage'] = 'Skladiště';\r\n        language['buildings']['hide'] = 'Skrýš';\r\n        language['buildings']['wall'] = 'Hradby';\r\n        language['buildings']['watchtower'] = 'Watchtower'; // todo: translate\r\n\r\n        language['report']['catDamage'] = 'Škoda vzniklá střelbou z katapultu:';\r\n        language['report']['ramDamage'] = 'Škoda vzniklá beranidlem:';\r\n        language['report']['haul'] = 'Kořist:';\r\n        language['report']['loyalty'] = 'Oddanost:';\r\n        language['report']['unitsInTransit'] = 'Vojsko obránce, které bylo na cestě';\r\n        language['report']['deletedPlayer'] = '(deleted)'; //todo: translate\r\n        language['report']['unread'] = '(new)'; //todo: translate\r\n        break;\r\n\r\n    case 'se':\r\n        language['buildings']['main'] = 'Högkvarter';\r\n        language['buildings']['barracks'] = 'Barack';\r\n        language['buildings']['stable'] = 'Stall';\r\n        language['buildings']['garage'] = 'Verkstad';\r\n        language['buildings']['church'] = 'Kyrka';\r\n        language['buildings']['church_f'] = 'Första Kyrkan';\r\n        language['buildings']['snob'] = 'Akademi';\r\n        language['buildings']['smith'] = 'Smedja';\r\n        language['buildings']['place'] = 'Samlingsplats';\r\n        language['buildings']['statue'] = 'Staty';\r\n        language['buildings']['market'] = 'Marknad';\r\n        language['buildings']['wood'] = 'Sågverk';\r\n        language['buildings']['stone'] = 'Lergrop';\r\n        language['buildings']['iron'] = 'Järngruva';\r\n        language['buildings']['farm'] = 'Farm';\r\n        language['buildings']['storage'] = 'Förråd';\r\n        language['buildings']['hide'] = 'Gömställe';\r\n        language['buildings']['wall'] = 'Mur';\r\n        language['buildings']['watchtower'] = 'Watchtower'; // todo: translate\r\n\r\n        language['report']['catDamage'] = 'Skada gjord av katapulter:';\r\n        language['report']['ramDamage'] = 'Skada gjorda av Murbräckan:';\r\n        language['report']['haul'] = 'Byte:';\r\n        language['report']['loyalty'] = 'Lojalitet:';\r\n        language['report']['unitsInTransit'] = 'Enheter utanför byn';\r\n        language['report']['deletedPlayer'] = '(borttaget)';\r\n        language['report']['unread'] = '(new)'; //todo: translate\r\n        break;\r\n\r\n    /*==== fyletikesmaxes.gr/ ====*/\r\n    case 'gr':\r\n        language['buildings']['main'] = 'Επιτελείο';\r\n        language['buildings']['barracks'] = 'Στρατώνας';\r\n        language['buildings']['stable'] = 'Στάβλος';\r\n        language['buildings']['garage'] = 'Εργαστήριο';\r\n        language['buildings']['church'] = 'Εκκλησία';\r\n        language['buildings']['church_f'] = 'ΠρώτηΕκκλησία';\r\n        language['buildings']['snob'] = 'Ακαδημία';\r\n        language['buildings']['smith'] = 'Οπλοποιείο';\r\n        language['buildings']['place'] = 'ΜέροςΣυγκέντρωσης';\r\n        language['buildings']['statue'] = 'Άγαλμα';\r\n        language['buildings']['market'] = 'Αγορά';\r\n        language['buildings']['wood'] = 'Ξυλουργείο';\r\n        language['buildings']['stone'] = 'Λατομείο';\r\n        language['buildings']['iron'] = 'Σιδηρωρυχείο';\r\n        language['buildings']['farm'] = 'Αγρόκτημα';\r\n        language['buildings']['storage'] = 'Αποθήκη';\r\n        language['buildings']['hide'] = 'Κρυψώνα';\r\n        language['buildings']['wall'] = 'Τείχος';\r\n        language['buildings']['watchtower'] = 'Watchtower'; // todo: translate\r\n\r\n        language['report']['catDamage'] = 'Ζημία που έκαναν οι καταπέλτες:';\r\n        language['report']['ramDamage'] = 'Ζημιά που προκλήθηκε από τον πολιορκητικό κριό:';\r\n        language['report']['haul'] = 'Αλλαγή:';\r\n        language['report']['loyalty'] = 'Πίστη:';\r\n        language['report']['unitsInTransit'] = 'Στρατεύματα αμυνόμενου που ήταν σε μεταφορά';\r\n        language['report']['deletedPlayer'] = '(διεγραμμένο)';\r\n        language['report']['unread'] = '(νέο)';\r\n        break;\r\n\r\n    /* the market where Arma plays :D */\r\n    case 'hr':\r\n        language['buildings']['main'] = 'Sjedište';\r\n        language['buildings']['barracks'] = 'Vojarna';\r\n        language['buildings']['stable'] = 'Štala';\r\n        language['buildings']['garage'] = 'Radionica';\r\n        language['buildings']['church'] = 'Crkva';\r\n        language['buildings']['church_f'] = 'Prva crkva';\r\n        language['buildings']['snob'] = 'Akademija';\r\n        language['buildings']['smith'] = 'Kovačnica';\r\n        language['buildings']['place'] = 'Okupljalište';\r\n        language['buildings']['statue'] = 'Spomenik';\r\n        language['buildings']['market'] = 'Tržnica';\r\n        language['buildings']['wood'] = 'Drvosječa';\r\n        language['buildings']['stone'] = 'Glinokop';\r\n        language['buildings']['iron'] = 'Rudnik željeza';\r\n        language['buildings']['farm'] = 'Farma';\r\n        language['buildings']['storage'] = 'Spremište';\r\n        language['buildings']['hide'] = 'Skrovište';\r\n        language['buildings']['wall'] = 'Zid';\r\n        language['buildings']['watchtower'] = 'Watchtower'; // todo: translate\r\n\r\n        language['report']['catDamage'] = 'Šteta nanešena katapultima:\t';\r\n        language['report']['ramDamage'] = 'Šteta nanešena ovnovima:';\r\n        language['report']['haul'] = 'Nosivost:';\r\n        language['report']['loyalty'] = 'Odanost:';\r\n        language['report']['unitsInTransit'] = 'Obrambene postrojbe koje su bile na putu';\r\n        language['report']['deletedPlayer'] = '(obrisano)';\r\n        break;\r\n\r\n    /* Norwegian */\r\n    case 'no':\r\n        language['buildings']['main'] = 'Hovedkvarter';\r\n        language['buildings']['barracks'] = 'Brakker';\r\n        language['buildings']['stable'] = 'Stall';\r\n        language['buildings']['garage'] = 'Verksted';\r\n        language['buildings']['church'] = 'Kirke';\r\n        language['buildings']['church_f'] = 'Første Kirke';\r\n        language['buildings']['snob'] = 'Akademi';\r\n        language['buildings']['smith'] = 'Smie';\r\n        language['buildings']['place'] = 'Samlingsplass';\r\n        language['buildings']['statue'] = 'Statue';\r\n        language['buildings']['market'] = 'Marked';\r\n        language['buildings']['wood'] = 'Hogstfelt';\r\n        language['buildings']['stone'] = 'Leirgrav';\r\n        language['buildings']['iron'] = 'Jerngruve';\r\n        language['buildings']['farm'] = 'Gård';\r\n        language['buildings']['storage'] = 'Varehus';\r\n        language['buildings']['hide'] = 'Skjulested';\r\n        language['buildings']['wall'] = 'Mur';\r\n        language['buildings']['watchtower'] = 'Watchtower'; // todo: translate\r\n\r\n        language['report']['catDamage'] = 'Skade forårsaket av katapulter:';\r\n        language['report']['ramDamage'] = 'Skade forårsaket av rambukker:';\r\n        language['report']['haul'] = 'Bytte';\r\n        language['report']['loyalty'] = 'Lojalitet:';\r\n        language['report']['unitsInTransit'] = 'Forsvarer';\r\n        language['report']['unitsInTransit'] = 'Antall';\r\n        language['report']['deletedPlayer'] = '(slettet)';\r\n        language['report']['unread'] = '(ny)';\r\n        break;\r\n\r\n    // Portugal\r\n    case 'pt':\r\n        language['buildings']['main'] = 'Edifício Principal';\r\n        language['buildings']['barracks'] = 'Quartel';\r\n        language['buildings']['stable'] = 'Estábulo';\r\n        language['buildings']['garage'] = 'Oficina';\r\n        language['buildings']['church'] = 'Igreja';\r\n        language['buildings']['church_f'] = 'Primeira Igreja';\r\n        language['buildings']['snob'] = 'Academia';\r\n        language['buildings']['smith'] = 'Ferreiro';\r\n        language['buildings']['place'] = 'Praça de Reuniões';\r\n        language['buildings']['statue'] = 'Estátua';\r\n        language['buildings']['market'] = 'Mercado';\r\n        language['buildings']['wood'] = 'Bosque';\r\n        language['buildings']['stone'] = 'Poço de Argila';\r\n        language['buildings']['iron'] = 'Mina de Ferro';\r\n        language['buildings']['farm'] = 'Fazenda';\r\n        language['buildings']['storage'] = 'Armazém';\r\n        language['buildings']['hide'] = 'Esconderijo';\r\n        language['buildings']['wall'] = 'Muralha';\r\n        language['buildings']['watchtower'] = 'Watchtower'; // todo: translate\r\n    \r\n        language['report']['catDamage'] = 'Dano provocado por catapultas:';\r\n        language['report']['ramDamage'] = 'Dano provocado por aríetes:';\r\n        language['report']['haul'] = 'Busca minuciosa:';\r\n        language['report']['loyalty'] = 'Lealdade:';\r\n        language['report']['unitsInTransit'] = 'Unidades fora da aldeia';\r\n        language['report']['deletedPlayer'] = '(eliminado)';\r\n        language['report']['unread'] = '(novo)';\r\n        break;\r\n     \r\n     // Netherlands\r\n     case 'nl':\r\n        /*==== tribalwars.nl ====*/\r\n        language['buildings']['main'] = 'Hoofdgebouw';\r\n        language['buildings']['barracks'] = 'Kazerne';\r\n        language['buildings']['stable'] = 'Stal';\r\n        language['buildings']['garage'] = 'Werkplaats';\r\n        language['buildings']['church'] = 'Kerk';\r\n        language['buildings']['church_f'] = 'Eerste Kerk';\r\n        language['buildings']['snob'] = 'Adelshoeve';\r\n        language['buildings']['smith'] = 'Smederij';\r\n        language['buildings']['place'] = 'Verzamelplaats';\r\n        language['buildings']['statue'] = 'Standbeeld';\r\n        language['buildings']['market'] = 'Markt';\r\n        language['buildings']['wood'] = 'Houthakkers';\r\n        language['buildings']['stone'] = 'Leemgroeve';\r\n        language['buildings']['iron'] = 'Ijzermijn';\r\n        language['buildings']['farm'] = 'Boerderij';\r\n        language['buildings']['storage'] = 'Opslagplaats';\r\n        language['buildings']['hide'] = 'Schuilplaats';\r\n        language['buildings']['wall'] = 'Muur';\r\n        language['buildings']['watchtower'] = 'Uitkijktoren';\r\n\r\n        language['report']['catDamage'] = 'Schade door katapulten:';\r\n        language['report']['ramDamage'] = 'Schade door rammen:';\r\n        language['report']['haul'] = 'Buit:';\r\n        language['report']['loyalty'] = 'Toestemming:';\r\n        language['report']['unitsInTransit'] = 'Eenheden buiten het dorp';\r\n        language['report']['deletedPlayer'] = '(verwijderd)';\r\n        language['report']['unread'] = '(Nieuw)';\r\n        break;\r\n\r\n}\r\n\r\nfunction escapeSingleQuotes(str) {\r\n    return str.replace(/'/g, \"\\\\'\");\r\n}\r\n\r\nclass TextScraper_TextScraper {\r\n    constructor(gameTexts) {\r\n        this.gameTexts = gameTexts;\r\n    }\r\n\r\n    t(textId) {\r\n        return getProp(this.gameTexts, textId);\r\n    }\r\n\r\n    /**\r\n     * @param {HTMLElement|jQuery|string} haystack\r\n     * @param {string} textId\r\n     * @return {boolean}\r\n     */\r\n    includes(haystack, textId) {\r\n        let needle = this.t(textId);\r\n        if (typeof haystack === 'string') {\r\n            return haystack.includes(needle);\r\n        }\r\n        return $(haystack).html().includes(needle);\r\n    }\r\n\r\n    /**\r\n     * @param {HTMLElement[] | jQuery} elements\r\n     * @param {string} textId \r\n     * @return {HTMLElement|undefined}\r\n     */\r\n    first(elements, textId) {\r\n        let searchFor = this.t(textId);\r\n        return $(elements).filter(`:contains('${escapeSingleQuotes(searchFor)}')`)[0];\r\n    }\r\n\r\n    /**\r\n     * @param {HTMLElment|jQuery} el\r\n     * @return {string}\r\n     */\r\n    buildingType(el) {\r\n        let text = $(el).text();\r\n        for (let [buildingType, buildingName] of Object.entries(this.gameTexts.buildings)) {\r\n            if (text.includes(buildingName)) {\r\n                return buildingType;\r\n            }\r\n        }\r\n    }\r\n\r\n}\r\n\r\n\r\nlet textScraper = new TextScraper_TextScraper(language);\r\n\r\n\r\n\r\n\n// CONCATENATED MODULE: ./conf/ImageSrc.js\nlet game = window.image_base;\r\nlet ImageSrc_self = window.TwCheese.ROOT + '/assets/images/';\r\n\r\nlet ImageSrc = {\r\n    plus: game + 'plus.png',\r\n    minus: game + 'minus.png',\r\n    wood: game + 'holz.png',\r\n    stone: game + 'lehm.png',\r\n    iron: game + 'eisen.png',\r\n    attack: game + 'command/attack.png',\r\n    haulPartial: game + 'max_loot/0.png',\r\n    haulFull: game + 'max_loot/1.png',\r\n    info: game + 'questionmark.png',\r\n    attackSentViaFa: game + 'command/farm.png',\r\n    attackSizeSmall: game + 'command/attack_small.png',\r\n    attackSizeMedium: game + 'command/attack_medium.png',\r\n    attackSizeLarge: game + 'command/attack_large.png',\r\n    attackContainsSnob: game + 'command/snob.png',\r\n    attackContainsSpy: game + 'command/spy.png',\r\n    attackContainsKnight: game + 'command/knight.png',\r\n    popupBackground: game + 'popup/content_background.png',\r\n    popupBorder: game + 'popup/border.png',\r\n    servant: game + 'paladin_new.png',\r\n    loadingSpinner: game + 'throbber.gif',\r\n    calendar: ImageSrc_self + 'calendar.png',\r\n    sidebarMain: ImageSrc_self + 'sidebar/gear.png',\r\n    sidebarBug: ImageSrc_self + 'sidebar/bug.png',\r\n    sidebarGithub: ImageSrc_self + 'sidebar/github.png',\r\n    jq: {\r\n        blue: ImageSrc_self + 'jquery/ui-icons_2e83ff_256x240.png',\r\n        black: ImageSrc_self + 'jquery/ui-icons_222222_256x240.png',\r\n        darkGrey: ImageSrc_self + 'jquery/ui-icons_454545_256x240.png',\r\n        grey: ImageSrc_self + 'jquery/ui-icons_888888_256x240.png',\r\n        red: ImageSrc_self + 'jquery/ui-icons_cd0a0a_256x240.png'\r\n    },\r\n    legacy: {\r\n        helpBackground: ImageSrc_self + 'legacy/help_background.png',\r\n        helpBackgroundBright: ImageSrc_self + 'legacy/help_background_highlight.png'\r\n    },    \r\n    buildingIcon: buildingType => game + `buildings/${buildingType}.png`,\r\n    troopIcon: troopType => game + `unit/unit_${troopType}.png`,\r\n    dotIcon: color => game + `dots/${color}.png`,\r\n    scavengeOption: optionId => game + `scavenging/options/${optionId}.png`,\r\n};\r\n\r\n\r\n\n// CONCATENATED MODULE: ./src/Models/BattleReportCondensed.js\n\r\n\r\n\r\nclass BattleReportCondensed_BattleReportCondensed {\r\n    constructor() {\r\n        this.subject = null; // string\r\n        this.attackIcons = null; // AttackIcons\r\n        this.attackerName = null; // string\r\n        this.attackerNobleDied = false; // boolean\r\n        this.attackerVillage = null; // Village\r\n        this.buildingLevels = null; // BuildingLevels\r\n        this.defenderName = null; // string\r\n        this.defenderVillage = null; // Village\r\n        this.defenderSurvivors = null; // TroopCounts\r\n        this.dotColor = null; // string\r\n        this.haulStatus = BattleReportCondensed_BattleReportCondensed.HAUL_STATUS_UNKNOWN;\r\n        this.isForwarded = false; // string\r\n        this.loyalty = null; // {after:number}\r\n        this.note = null; // string\r\n        this.reportId = null; // int\r\n        this.resources = null; // Resources\r\n        this.strTimeReceived = null; // string\r\n        this.timeLaunched = null; // TwCheeseDate\r\n        this.wasAttackFeint = false; // boolean\r\n    }\r\n\r\n    /**\r\n     * were the defender's troops all killed?\r\n     * @return {boolean}\r\n     */\r\n    wasDefenderCleared() {\r\n        return this.defenderSurvivors && this.defenderSurvivors.isZero();\r\n    }\r\n\r\n    haulStatusIconSrc() {\r\n        if (this.haulStatus === BattleReportCondensed_BattleReportCondensed.HAUL_STATUS_UNKNOWN) {\r\n            throw Error(`There's no icon.... that's why the status is unknown!`);\r\n        }\r\n        if (this.haulStatus === BattleReportCondensed_BattleReportCondensed.HAUL_STATUS_FULL) {\r\n            return ImageSrc.haulFull;\r\n        }\r\n        return ImageSrc.haulPartial;\r\n    }\r\n\r\n    /**\r\n     * @param {{x:number, y:number}} village\r\n     * @return number\r\n     */\r\n    defenderDistance(village) {\r\n        if (!this.defenderVillage) {\r\n            return '?';\r\n        }\r\n        return Math.round(this.defenderVillage.distanceTo(village) * 100) / 100;\r\n    }\r\n\r\n}\r\nBattleReportCondensed_BattleReportCondensed.HAUL_STATUS_UNKNOWN = -1;\r\nBattleReportCondensed_BattleReportCondensed.HAUL_STATUS_PARTIAL = 0;\r\nBattleReportCondensed_BattleReportCondensed.HAUL_STATUS_FULL = 1;\r\n\r\n\r\n\n// CONCATENATED MODULE: ./src/Models/Village.js\n\r\nclass Village {\r\n    constructor(id, x, y) {\r\n        this.id = parseInt(id);\r\n        this.x = parseInt(x);\r\n        this.y = parseInt(y);\r\n    }\r\n\r\n    /**\r\n     * @param {Village} otherVillage \r\n     */\r\n    distanceTo(otherVillage) {\r\n        let diffX = this.x - otherVillage.x;\r\n        let diffY = this.y - otherVillage.y;\r\n        return Math.hypot(diffX, diffY);\r\n    }\r\n}\r\n\r\n\r\n\n// CONCATENATED MODULE: ./src/Models/Resource.js\n\r\n\r\nclass Resource_Resource {\r\n    constructor(type, amount) {\r\n        this.type = type;\r\n        this.amount = amount;\r\n    }\r\n\r\n    valueOf() {\r\n        return this.amount;\r\n    }\r\n\r\n    toString() {\r\n        return this.amount;\r\n    }\r\n\r\n    toDebugString() {\r\n        return this.amount;\r\n    }\r\n\r\n    imageSrc() {\r\n        return ImageSrc[this.type];\r\n    }\r\n\r\n}\r\n\r\nResource_Resource.TYPE_TIMBER = 'wood';\r\nResource_Resource.TYPE_CLAY = 'stone';\r\nResource_Resource.TYPE_IRON = 'iron';\r\n\r\n\n// CONCATENATED MODULE: ./src/Models/Resources.js\n\r\n\r\nclass Resources_Resources {\r\n    constructor(woodAmount = 0, stoneAmount = 0, ironAmount = 0) {\r\n        this.wood = new Resource_Resource(Resource_Resource.TYPE_TIMBER, woodAmount);\r\n        this.stone = new Resource_Resource(Resource_Resource.TYPE_CLAY, stoneAmount);\r\n        this.iron = new Resource_Resource(Resource_Resource.TYPE_IRON, ironAmount);\r\n    }\r\n\r\n    sum() {\r\n        return this.wood + this.stone + this.iron;\r\n    }\r\n\r\n    add(other) {\r\n        return new Resources_Resources(\r\n            this.wood + other.wood,\r\n            this.stone + other.stone,\r\n            this.iron + other.iron\r\n        );\r\n    }\r\n\r\n    multiply(factor) {\r\n        return new Resources_Resources(\r\n            this.wood * factor,\r\n            this.stone * factor,\r\n            this.iron * factor\r\n        );\r\n    }\r\n\r\n    cap(maxAmount) {\r\n        return new Resources_Resources(\r\n            Math.min(this.wood, maxAmount),\r\n            Math.min(this.stone, maxAmount),\r\n            Math.min(this.iron, maxAmount)\r\n        );\r\n    }\r\n\r\n    /**\r\n     * @param {Objecet} other \r\n     */\r\n    equals(other) {\r\n        return this.wood.valueOf() === other.wood.valueOf()\r\n            && this.stone.valueOf() === other.stone.valueOf()\r\n            && this.iron.valueOf() === other.iron.valueOf();\r\n    }\r\n\r\n    toArray() {\r\n        return [this.wood.amount, this.stone.amount, this.iron.amount];\r\n    }\r\n\r\n}\r\n\r\nResources_Resources.TYPES = [Resource_Resource.TYPE_TIMBER, Resource_Resource.TYPE_CLAY, Resource_Resource.TYPE_IRON];\r\n\r\n\n// CONCATENATED MODULE: ./src/Models/Config.js\n\r\n\r\n\r\nclass Config_Config {\r\n    constructor(id) {\r\n        this.id = id;\r\n        this.props = {};\r\n        this._loadCachedData();\r\n    }\r\n\r\n    get(prop, defaultValue) {\r\n        return getProp(this.props, prop, defaultValue);\r\n    }\r\n\r\n    set(prop, value) {\r\n        setProp(this.props, prop, value);\r\n        this._save();\r\n    }\r\n\r\n    initProps(props) {\r\n        this.props = props;\r\n    }\r\n\r\n    /**\r\n     * @protected\r\n     * @return {object|null}\r\n     */\r\n    _loadCachedData() {\r\n        let saved = window.localStorage.getItem(this.id);\r\n        if (saved) {\r\n            let data = JSON.parse(saved);\r\n\r\n            // should ideally be data.props\r\n            // But for backwards compatibility, the data could be the props too.\r\n            this.props = data.props || data;\r\n            return data;\r\n        }\r\n        return null;\r\n    }\r\n\r\n    /**\r\n     * @final\r\n     * @protected\r\n     */\r\n    _save() {\r\n        this._beforeSave();\r\n        window.localStorage.setItem(this.id, JSON.stringify(this._getCacheableData()));\r\n    }\r\n\r\n    /**\r\n     * @protected\r\n     */\r\n    _beforeSave() {\r\n        \r\n    }\r\n\r\n    /**\r\n     * @protected\r\n     * @return {object}\r\n     */\r\n    _getCacheableData() {\r\n        return {\r\n            props: this.props\r\n        };\r\n    }\r\n\r\n}\r\n\r\n\n// CONCATENATED MODULE: ./src/Models/RateLimiter.js\nclass RateLimiter {\r\n    constructor(maxBurstsPerSecond) {\r\n        this.maxBurstsPerSecond = maxBurstsPerSecond;\r\n        this.recentRequests = new Array(maxBurstsPerSecond);\r\n    }\r\n\r\n    requestWasMade() {\r\n        this.recentRequests.unshift(performance.now());\r\n        this.recentRequests.pop();\r\n    }\r\n\r\n    async sleepIfNeeded() {\r\n        let anchorTimestamp = this.recentRequests[this.maxBurstsPerSecond - 1];\r\n        if (typeof anchorTimestamp === 'undefined') {\r\n            return;\r\n        }\r\n        let delayMs = anchorTimestamp + 1000 - performance.now();\r\n        if (delayMs <= 0) {\r\n            return;\r\n        }\r\n        return new Promise(function(resolve, reject) {\r\n            setTimeout(resolve, delayMs);\r\n        });\r\n    }\r\n}\r\n\r\n\n// CONCATENATED MODULE: ./src/Util/Network.js\n\r\n\r\nlet throttle = new RateLimiter(5);\r\n\r\nlet originalFetch = window.fetch;\r\nwindow.fetch = function() {\r\n    throttle.requestWasMade();\r\n    return originalFetch.apply(this, arguments);\r\n};\r\n\r\n\r\n/**\r\n * requests the document from a url\r\n * @param {string} url the url of the page to get the document from\r\n * @return {Promise}\r\n * @resolve {HTMLDocment}\r\n */\r\nasync function requestDocument(url) {\r\n    await throttle.sleepIfNeeded();\r\n    let response = await fetch(url);\r\n    let responseText = await response.text();\r\n    let doc = (new DOMParser()).parseFromString(responseText, 'text/html');\r\n\r\n    Object.defineProperty(doc, 'URL', {\r\n        get: () => url\r\n    });\r\n    \r\n    return doc;\r\n};\r\n\r\n\r\n/**\r\n * requests xml document from a url\r\n * @param {string} url the url of the page to get the cml document from\r\n * @return {Promise}\r\n * @resolve {XMLDocument}\r\n */\r\nasync function requestXml(url) {\r\n    await throttle.sleepIfNeeded();\r\n    let response = await fetch(url);\r\n    let responseText = await response.text();\r\n    let xmlDoc = (new DOMParser()).parseFromString(responseText, 'text/xml');\r\n\r\n    Object.defineProperty(xmlDoc, 'URL', {\r\n        get: () => url\r\n    });\r\n\r\n    return xmlDoc;\r\n};\r\n\r\n\r\n/**\r\n * make a POST request to the game\r\n * @param {string} screen \r\n * @param {object} uriParams \r\n * @param {object} data\r\n * @return {Promise}\r\n * @resolve {object} response data from the game\r\n */\r\nasync function postToGame(screen, uriParams, data) {\r\n    await throttle.sleepIfNeeded();\r\n    return new Promise(function(resolve, reject) {\r\n        window.TribalWars.post(screen, uriParams, data, resolve, reject);\r\n    });\r\n}\r\n\r\n\r\nfunction gameUrl(screen, uriParams, method = 'GET') {\r\n    return 'https://' + document.domain + window.TribalWars.buildURL(method, screen, uriParams);\r\n}\r\n\r\n\r\nfunction attackPrepUrl(unitCounts, targetVillageId, originVillageId = window.game_data.village.id) {\r\n    let uriParams = {\r\n        from: 'simulator',\r\n        village: originVillageId,\r\n        target_village_id: targetVillageId        \r\n    };\r\n    for (let [unitType, count] of Object.entries(unitCounts)) {\r\n        uriParams['att_' + unitType] = count;\r\n    }\r\n    return gameUrl('place', uriParams);\r\n}\r\n\r\n\r\n\n// CONCATENATED MODULE: ./src/Models/RemoteConfig.js\n\r\n\r\n\r\n\r\nfunction parseXmlNode(node) {\r\n    if (node.children.length === 0) {\r\n        return parseFloat(node.innerHTML) || null;\r\n    }\r\n    let object = {};\r\n    for (let childNode of node.children) {\r\n        object[childNode.tagName] = parseXmlNode(childNode);\r\n    }\r\n    return object;\r\n}\r\n\r\n\r\nclass RemoteConfig_RemoteConfig extends Config_Config {\r\n\r\n    /**\r\n     * @param {string} url \r\n     */\r\n    setUrl(url) {\r\n        this.url = url;\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * @param {number} seconds \r\n     */\r\n    setTtl(seconds) {\r\n        this.ttl = seconds * 1000;\r\n        return this;\r\n    }\r\n\r\n    async ensureUpdated() {\r\n        if (this.needsUpdate()) {\r\n            await this.update();\r\n        }    \r\n    }\r\n\r\n    needsUpdate() {\r\n        let now = new Date().getTime();\r\n        let ttl = this.ttl || 86400;\r\n        return !this.timeUpdated || ttl < now - this.timeUpdated;\r\n    }\r\n\r\n    async update() {\r\n        let xmlDoc = await requestXml(this.url);\r\n        this._processXml(xmlDoc);\r\n        this._save();\r\n    }\r\n\r\n    /**\r\n     * @protected\r\n     * @param {XMLDocument} xmlDoc \r\n     */\r\n    _processXml(xmlDoc) {\r\n        this.props = parseXmlNode(xmlDoc).config;\r\n    }\r\n\r\n    /**\r\n     * @protected\r\n     * @return {object|null}\r\n     */\r\n    _loadCachedData() {\r\n        let data = super._loadCachedData();\r\n        if (data) {\r\n            this.timeUpdated = data.timeUpdated;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @protected\r\n     */\r\n    _beforeSave() {\r\n        this.timeUpdated = new Date().getTime();\r\n    }\r\n\r\n    /**\r\n     * @protected\r\n     * @return {object}\r\n     */\r\n    _getCacheableData() {\r\n        return Object.assign({}, super._getCacheableData(), {\r\n            timeUpdated: this.timeUpdated\r\n        });\r\n    }\r\n\r\n}\r\n\r\n\r\n\n// CONCATENATED MODULE: ./src/Util/Config.js\n\r\n\r\n\r\nlet userConfig = new Config_Config('twcheese.userConfig');\r\n\r\nlet gameConfig = (new RemoteConfig_RemoteConfig('twcheese.gameConfig'))\r\n    .setUrl(`https://${document.domain}/interface.php?func=get_config`)\r\n    .setTtl(8 * 3600);\r\n\r\nlet buildingConfig = (new RemoteConfig_RemoteConfig('twcheese.buildingConfig'))\r\n    .setUrl(`https://${document.domain}/interface.php?func=get_building_info`)\r\n    .setTtl(8 * 3600);\r\n\r\nlet troopConfig = (new RemoteConfig_RemoteConfig('twcheese.troopConfig'))\r\n    .setUrl(`https://${document.domain}/interface.php?func=get_unit_info`)\r\n    .setTtl(8 * 3600);\r\n\r\n\r\nasync function ensureRemoteConfigsUpdated() {\r\n    await Promise.all([\r\n        gameConfig.ensureUpdated(),\r\n        troopConfig.ensureUpdated(),\r\n        buildingConfig.ensureUpdated()\r\n    ]);\r\n}\r\n    \r\n\r\n\n// CONCATENATED MODULE: ./conf/Buildings.js\nlet cfg = {\r\n    main: {\r\n        maxLevel: 30,\r\n        minLevel: 1,\r\n        pop: 5,\r\n        popFactor: 1.17,\r\n        req: {}\r\n    },\r\n    barracks: {\r\n        maxLevel: 25,\r\n        minLevel: 0,\r\n        pop: 7,\r\n        popFactor: 1.17,\r\n        req: {\r\n            main: 3\r\n        }\r\n    },\r\n    stable: {\r\n        maxLevel: 20,\r\n        minLevel: 0,\r\n        pop: 8,\r\n        popFactor: 1.17,\r\n        req: {\r\n            main: 10,\r\n            barracks: 5,\r\n            smith: 5\r\n        }\r\n    },\r\n    garage: {\r\n        maxLevel: 15,\r\n        minLevel: 0,\r\n        pop: 8,\r\n        popFactor: 1.17,\r\n        req: {\r\n            main: 10,\r\n            smith: 10\r\n        }\r\n    },\r\n    church: {\r\n        maxLevel: 3,\r\n        minLevel: 0,\r\n        pop: 5000,\r\n        popFactor: 1.55,\r\n        req: {\r\n            main: 5,\r\n            farm: 5\r\n        }\r\n    },\r\n    church_f: {\r\n        maxLevel: 1,\r\n        minLevel: 0,\r\n        pop: 5,\r\n        popFactor: 1.55,\r\n        req: {}\r\n    },\r\n    snob: {\r\n        maxLevel: 3,\r\n        minLevel: 0,\r\n        pop: 80,\r\n        popFactor: 1.17,\r\n        req: {\r\n            main: 20,\r\n            smith: 20,\r\n            market: 10\r\n        }\r\n    },\r\n    smith: {\r\n        maxLevel: 20,\r\n        minLevel: 0,\r\n        pop: 20,\r\n        popFactor: 1.17,\r\n        req: {\r\n            main: 5,\r\n            barracks: 1\r\n        }\r\n    },\r\n    place: {\r\n        maxLevel: 1,\r\n        minLevel: 0,\r\n        pop: 0,\r\n        popFactor: 1.17,\r\n        req: {}\r\n    },\r\n    statue: {\r\n        maxLevel: 1,\r\n        minLevel: 0,\r\n        pop: 10,\r\n        popFactor: 1.17,\r\n        req: {}\r\n    },\r\n    market: {\r\n        maxLevel: 25,\r\n        minLevel: 0,\r\n        pop: 20,\r\n        popFactor: 1.17,\r\n        req: {\r\n            main: 3,\r\n            storage: 2\r\n        }\r\n    },\r\n    wood: {\r\n        maxLevel: 30,\r\n        minLevel: 0,\r\n        pop: 5,\r\n        popFactor: 1.155,\r\n        req: {}\r\n    },\r\n    stone: {\r\n        maxLevel: 30,\r\n        minLevel: 0,\r\n        pop: 10,\r\n        popFactor: 1.14,\r\n        req: {}\r\n    },\r\n    iron: {\r\n        maxLevel: 30,\r\n        minLevel: 0,\r\n        pop: 10,\r\n        popFactor: 1.17,\r\n        req: {}\r\n    },\r\n    farm: {\r\n        maxLevel: 30,\r\n        minLevel: 1,\r\n        pop: 0,\r\n        popFactor: 1,\r\n        req: {}\r\n    },\r\n    storage: {\r\n        maxLevel: 30,\r\n        minLevel: 1,\r\n        pop: 0,\r\n        popFactor: 1.15,\r\n        req: {}\r\n    },\r\n    hide: {\r\n        maxLevel: 10,\r\n        minLevel: 0,\r\n        pop: 2,\r\n        popFactor: 1.17,\r\n        req: {}\r\n    },\r\n    wall: {\r\n        maxLevel: 20,\r\n        minLevel: 0,\r\n        pop: 5,\r\n        popFactor: 1.17,\r\n        req: {\r\n            barracks: 1\r\n        }\r\n    },\r\n    watchtower: {\r\n        maxLevel: 20,\r\n        minLevel: 0,\r\n        pop: 500,\r\n        popFactor: 1.18,\r\n        req: {\r\n            main: 5,\r\n            farm: 5\r\n        }\r\n    }    \r\n};\r\n\r\n\n// CONCATENATED MODULE: ./src/Models/Buildings.js\n\r\n\r\n\r\n // todo: request devs make additional info available via interface.php, so this won't be necessary\r\n\r\n\r\n/**\r\n * Building\t\tIndex\r\n * hq:\t\t\t0\r\n * barracks:\t1\r\n * stable:\t\t2\r\n * workshop:\t3\r\n * church:\t\t4\r\n * church_f:\t5\r\n * academy:\t\t6\r\n * smithy:\t\t7\r\n * rally:\t\t8\r\n * statue:\t\t9\r\n * market:\t\t10\r\n * timber:\t\t11\r\n * clay:\t\t12\r\n * iron:\t\t13\r\n * farm:\t\t14\r\n * warehouse:\t15\r\n * hiding:\t\t16\r\n * wall:\t\t17\r\n */\r\nlet buildingTypes = [\r\n    'main',\r\n    'barracks',\r\n    'stable',\r\n    'garage',\r\n    'church',\r\n    'church_f',\r\n    'snob',\r\n    'smith',\r\n    'place',\r\n    'statue',\r\n    'market',\r\n    'wood',\r\n    'stone',\r\n    'iron',\r\n    'farm',\r\n    'storage',\r\n    'hide',\r\n    'wall',\r\n    'watchtower'\r\n];\r\n\r\nfunction maxLevel(buildingType) {\r\n    let building = buildingConfig.get(buildingType);\r\n    if (typeof building === 'undefined') {\r\n        return 0;\r\n    }\r\n    return building.max_level;\r\n}\r\n\r\n\r\nfunction resProductionHourly(level) {\r\n    if (level === 0) {\r\n        return gameConfig.get('speed') * 5;\r\n    }\r\n    return gameConfig.get('speed') * 30 * (1.163118 ** (level - 1));\r\n}\r\n\r\n\r\nfunction popUsed(buildingType, level) {\r\n    let building = buildingConfig.get(buildingType);\r\n    if (typeof building === 'undefined') {\r\n        return 0;\r\n    }\r\n    return Math.round(building.pop * building.pop_factor ** (level - 1));\r\n}\r\n\r\n\r\nfunction requiredBuildingLevels(buildingType) {\r\n    // The config from interface.php is missing building requirements.\r\n    // So use own config.\r\n    let building = cfg[buildingType];\r\n    if (typeof building === 'undefined') {\r\n        return [];\r\n    }\r\n    return building.req;\r\n}\r\n\r\n\r\nclass Buildings_BuildingLevels {\r\n    constructor(fill = 0) {\r\n        for (let type of buildingTypes) {\r\n            this[type] = fill;\r\n        }\r\n    }\r\n\r\n    populationUsed() {\r\n        let pop = 0;\r\n        for (let buildingType of buildingTypes) {\r\n            let level = this[buildingType];\r\n            pop += popUsed(buildingType, level);\r\n        }\r\n        return pop;\r\n    }\r\n\r\n    populationCap() {\r\n        return Math.round(240 * 1.172103 ** (this.farm - 1));\r\n    }\r\n\r\n    resourceCap() {\r\n        return Math.round(1000 * 1.2294934 ** (this.storage - 1));\r\n    }\r\n    \r\n    resourceProductionHourly() {\r\n        return new Resources_Resources(\r\n            resProductionHourly(this.wood),\r\n            resProductionHourly(this.stone),\r\n            resProductionHourly(this.iron)\r\n        );\r\n    }\r\n\r\n    hideableResources() {\r\n        if (this.hide === 0) {\r\n            return 0;\r\n        }\r\n        return Math.round(112.4859 * 1.3335 ** this.hide);\r\n    }\r\n\r\n    canUpgrade(buildingType) {\r\n        let alreadyMaxed = this[buildingType] >= maxLevel(buildingType);\r\n        return !alreadyMaxed && this.areRequirementsMet(buildingType);\r\n    }\r\n\r\n    areRequirementsMet(buildingType) {\r\n        let reqs = requiredBuildingLevels(buildingType);\r\n        for (let [reqType, reqLevel] of Object.entries(reqs)) {\r\n            if (reqLevel > this[reqType]) {\r\n                return false;\r\n            }\r\n        }\r\n        return true;\r\n    }\r\n\r\n    toArray() {\r\n        return buildingTypes.map(type => this[type]);\r\n    }\r\n\r\n    static fromArray(array) {\r\n        let levels = new Buildings_BuildingLevels();\r\n        array.forEach((level, i) => {\r\n            levels[buildingTypes[i]] = level;\r\n        });\r\n        return levels;\r\n    }\r\n\r\n    static typeAt(index) {\r\n        return buildingTypes[index];\r\n    }\r\n}\r\n\r\n\r\nlet buildingUtil = {\r\n    buildingTypesOnWorld() {\r\n        return buildingTypes.filter(type => this.typeExistsOnWorld(type));\r\n    },\r\n\r\n    typeExistsOnWorld(buildingType) {\r\n        return typeof buildingConfig.get(buildingType) !== 'undefined';\r\n    },\r\n};\r\n\r\n\r\n\n// CONCATENATED MODULE: ./src/Models/Troops.js\n\r\n\r\nlet Troops_troopTypes = ['spear', 'sword', 'axe', 'archer', 'spy', 'light', 'marcher', 'heavy', 'ram', 'catapult', 'knight', 'snob', 'militia'];\r\n\r\n\r\nfunction troopPop(troopType) {\r\n    let troop = troopConfig.get(troopType);\r\n    if (typeof troop === 'undefined') {\r\n        return 0;\r\n    }\r\n    return troop.pop;\r\n}\r\n\r\n\r\nfunction travelMinutes(troopType) {\r\n    let troop = troopConfig.get(troopType);\r\n    if (typeof troop === 'undefined') {\r\n        return 0;\r\n    }\r\n    return troop.speed;\r\n}\r\n\r\n\r\nfunction troopCarry(troopType) {\r\n    let troop = troopConfig.get(troopType);\r\n    if (typeof troop === 'undefined') {\r\n        return 0;\r\n    }\r\n    return troop.carry;\r\n}\r\n\r\n\r\nclass TroopCounts {\r\n    constructor() {\r\n        for (let type of Troops_troopTypes) {\r\n            this[type] = 0;\r\n        }\r\n    }\r\n\r\n    clone() {\r\n        return Object.assign(new TroopCounts(), this);\r\n    }\r\n\r\n    filter(allowedTroopTypes) {\r\n        let counts = new TroopCounts();\r\n        for (let type of Troops_troopTypes) {\r\n            if (allowedTroopTypes.includes(type)) {\r\n                counts[type] = this[type];\r\n            }\r\n        }\r\n        return counts;\r\n    }\r\n\r\n    isZero() {        \r\n        for (let count of Object.values(this)) {\r\n            if (count !== 0) {\r\n                return false;\r\n            }\r\n        }\r\n        return true;\r\n    }\r\n\r\n    sum() {\r\n        let sum = 0;\r\n        for (let count of Object.values(this)) {\r\n            sum += count;\r\n        }\r\n        return sum;\r\n    }\r\n\r\n    /**\r\n     * @param {function} doSomething - receives two params: troopType and count\r\n     */\r\n    each(doSomething) {\r\n        for (let type of Troops_troopTypes) {\r\n            let count = this[type];\r\n            doSomething(type, count);\r\n        }\r\n    }\r\n\r\n    carryCapacity() {\r\n        let capacity = 0;\r\n        for (let type of Troops_troopTypes) {\r\n            capacity += this[type] * troopCarry(type);\r\n        }\r\n        return capacity;\r\n    }\r\n\r\n    populationUsed() {\r\n        return Troops_troopTypes.reduce((sum, type) => sum + troopPop(type) * this[type], 0);\r\n    }\r\n\r\n    travelDuration(distance, role = 'attack') {\r\n        let minutesPerField = this.travelMinutesPerField(role);\r\n        return calcTravelDuration(minutesPerField, distance);\r\n    }\r\n\r\n    travelMinutesPerField(role = 'attack') {\r\n        if (role === 'support' && this.knight > 0) {\r\n            return travelMinutes('knight');\r\n        }\r\n\r\n        let relevantMinutes = Troops_troopTypes\r\n            .filter(type => this[type] > 0)\r\n            .map(type => travelMinutes(type));\r\n\r\n        return Math.max(...relevantMinutes);\r\n    }\r\n\r\n    /**\r\n     * @param {TroopCounts} subtrahend\r\n     * @return {TroopCounts} difference\r\n     */\r\n    subtract(subtrahend) {\r\n        let difference = new TroopCounts();\r\n        for (let [troopType, count] of Object.entries(this)) {\r\n            difference[troopType] = count - subtrahend[troopType];\r\n        }\r\n        return difference;\r\n    }\r\n\r\n    /**\r\n     * get new TroopCounts, like this one but with any negative counts set to 0\r\n     */\r\n    zeroNegatives() {\r\n        let troopCounts = new TroopCounts();\r\n        for (let [troopType, count] of Object.entries(this)) {\r\n            troopCounts[troopType] = Math.max(0, count);\r\n        }\r\n        return troopCounts;\r\n    }\r\n\r\n    toArray() {\r\n        return Troops_troopTypes.map(type => this[type]);\r\n    }\r\n\r\n    static fromArray(array) {\r\n        let troops = new TroopCounts();\r\n        array.forEach((count, i) => {\r\n            troops[Troops_troopTypes[i]] = count;\r\n        });\r\n        return troops;\r\n    }\r\n}\r\n\r\n\r\n/**\r\n *\t@param {number} distance\r\n *\t@return\t{{spear:number, sword:number, ...}} milliseconds\r\n */\r\nfunction calcTravelDurations(distance) {\r\n    let travelTimes = {};\r\n    for (let type of Troops_troopTypes) {\r\n        travelTimes[type] = calcTravelDuration(travelMinutes(type), distance);\r\n    }\r\n    return travelTimes;\r\n};\r\n\r\n\r\nfunction calcTravelDuration(minutesPerField, distance) {\r\n    // The game rounds travel duration to the nearest second.\r\n    // The milliseconds part of the scheduled arrival is NOT some fraction of travel seconds.\r\n    // But rather, copied from the clock when the server started processing the request to travel.\r\n    //\r\n    // e.g. The clock says its 12:30:00.123.\r\n    // The server processes a request for troops to travel somewhere that takes them 10 minutes to reach.\r\n    // The scheduled arrival will be 12:40:00.123\r\n    return Math.round(distance * minutesPerField * 60) * 1000;\r\n}\r\n\r\n\r\nlet troopUtil = {\r\n\r\n    troopTypesOnWorld() {\r\n        return window.game_data.units;\r\n    },\r\n\r\n    existsOnWorld(troopType) {\r\n        return typeof troopConfig.get(troopType) !== 'undefined';\r\n    },\r\n\r\n    /** \r\n     * @param {string} troopType\r\n     * @param {number} resourceAmount     \r\n     * @param {number} haulBonus the extra % bonus haul from flags, events, etc. Example: 30 for 30%, NOT 0.3\r\n     * @return {number} how many troops does it take to carry all the resources\r\n     */\r\n    countToCarry(troopType, resourceAmount, haulBonus = 0) {\r\n        let haulPerUnit = troopCarry(troopType) * (100 + haulBonus) / 100;\r\n        let troopCount = resourceAmount / haulPerUnit;\r\n        return Math.round(10 * troopCount) / 10;\r\n    },\r\n\r\n    carryCapacity(troopType, factor = 1.0) {\r\n        return troopCarry(troopType) * factor;\r\n    },\r\n\r\n    /**\r\n     * @param {string} troopType\r\n     * @param {number} distance\r\n     * @return {number} milliseconds to travel\r\n     */\r\n    travelDuration(troopType, distance) {\r\n        return calcTravelDuration(travelMinutes(troopType), distance);\r\n    }\r\n\r\n};\r\n\r\n\r\n\n// CONCATENATED MODULE: ./src/Models/TwCheeseDate.js\n\r\n\r\nlet serverOffsetFromUtc = window.server_utc_diff * 1000;\r\nlet localOffsetFromUtc = new Date().getTimezoneOffset() * 60000;\r\n\r\nlet pretendServerIsUTC = function(cheeseDate) {\r\n    return cheeseDate.addMilliseconds(serverOffsetFromUtc)\r\n}\r\n\r\n\r\nclass TwCheeseDate_TwCheeseDate extends Date {\r\n    constructor() {\r\n        if (arguments.length === 0) {\r\n            super(window.Timing.getCurrentServerTime());\r\n        } else {\r\n            super(...arguments);\r\n        }\r\n    }\r\n\r\n    clone() {\r\n        return new TwCheeseDate_TwCheeseDate(this.getTime());\r\n    }\r\n\r\n    addDays(days) {\r\n        let ret = this.clone();\r\n        ret.setUTCDate(this.getUTCDate() + days);\r\n        return ret;\r\n    }\r\n\r\n    addHours(hours) {\r\n        let ret = this.clone();\r\n        ret.setUTCHours(this.getUTCHours() + hours);\r\n        return ret;\r\n    }\r\n\r\n    addMinutes(minutes) {\r\n        let ret = this.clone();\r\n        ret.setUTCMinutes(this.getUTCMinutes() + minutes);\r\n        return ret;\r\n    }\r\n\r\n    addSeconds(seconds) {\r\n        let ret = this.clone();\r\n        ret.setUTCSeconds(this.getUTCSeconds() + seconds);\r\n        return ret;\r\n    }\r\n\r\n    addMilliseconds(milliseconds) {\r\n        let ret = this.clone();\r\n        ret.setUTCMilliseconds(this.getUTCMilliseconds() + milliseconds);\r\n        return ret;\r\n    }\r\n\r\n    subDays(days) {\r\n        return this.addDays(-days);        \r\n    }\r\n\r\n    subHours(hours) {\r\n        return this.addHours(-hours);\r\n    }\r\n\r\n    subMinutes(minutes) {\r\n        return this.addMinutes(-minutes);\r\n    }\r\n\r\n    subSeconds(seconds) {\r\n        return this.addSeconds(-seconds);\r\n    }\r\n\r\n    subMilliseconds(milliseconds) {\r\n        return this.addMilliseconds(-milliseconds);\r\n    }\r\n\r\n    getServerYear() {\r\n        return pretendServerIsUTC(this).getUTCFullYear();\r\n    }\r\n\r\n    getServerMonth() {\r\n        return pretendServerIsUTC(this).getUTCMonth();\r\n    }\r\n\r\n    getServerDate() {\r\n        return pretendServerIsUTC(this).getUTCDate();\r\n    }\r\n\r\n    getServerHours() {\r\n        return pretendServerIsUTC(this).getUTCHours();\r\n    }\r\n\r\n    getServerHours() {\r\n        return pretendServerIsUTC(this).getUTCHours();\r\n    }\r\n\r\n    getServerMinutes() {\r\n        return pretendServerIsUTC(this).getUTCMinutes();\r\n    }\r\n\r\n    getServerSeconds() {\r\n        return pretendServerIsUTC(this).getUTCSeconds();\r\n    }\r\n\r\n    getServerMilliseconds() {\r\n        return pretendServerIsUTC(this).getUTCMilliseconds();\r\n    }\r\n\r\n    isTodayOnServer() {\r\n        let date = pretendServerIsUTC(this);\r\n        let now = pretendServerIsUTC(new TwCheeseDate_TwCheeseDate());\r\n        return date.isSameDayInUtc(now);\r\n    }\r\n\r\n    isTomorrowOnServer() {\r\n        let date = pretendServerIsUTC(this);\r\n        let now = pretendServerIsUTC(new TwCheeseDate_TwCheeseDate());\r\n        let tomorrow = now.addDays(1);    \r\n        return date.isSameDayInUtc(tomorrow);\r\n    }\r\n\r\n    isSameDayInUtc(otherDate) {\r\n        return this.getUTCFullYear() === otherDate.getUTCFullYear()\r\n            && this.getUTCMonth() === otherDate.getUTCMonth()\r\n            && this.getUTCDate() === otherDate.getUTCDate();\r\n    }\r\n\r\n    startOfHour() {\r\n        let ret = this.clone();\r\n        ret.setUTCMinutes(0);\r\n        ret.setUTCSeconds(0);\r\n        ret.setUTCMilliseconds(0);\r\n        return ret;\r\n    }\r\n\r\n    endOfHour() {\r\n        let ret = this.clone();\r\n        ret.setUTCMinutes(59);\r\n        ret.setUTCSeconds(59);\r\n        ret.setUTCMilliseconds(999);\r\n        return ret;\r\n    }\r\n\r\n    startOfSecond() {\r\n        let ret = this.clone();\r\n        ret.setUTCMilliseconds(0);\r\n        return ret;\r\n    }\r\n\r\n    equals(date) {\r\n        return this.getTime() === date.getTime();\r\n    }\r\n\r\n    toHtml(includeMillis = true) {\r\n        let d = pretendServerIsUTC(this);\r\n        let year = d.getUTCFullYear();\r\n        let monthName = d.toLocaleString('default', {month: 'short'});\r\n        let day = d.getUTCDate().toString().padStart(2, '0');\r\n        let hours = d.getUTCHours().toString().padStart(2, '0');\r\n        let minutes = d.getUTCMinutes().toString().padStart(2, '0');\r\n        let seconds = d.getUTCSeconds().toString().padStart(2, '0');\r\n        let ms = d.getUTCMilliseconds().toString().padStart(3, '0');\r\n\r\n        let html = `${monthName} ${day}, ${year} ${hours}:${minutes}:${seconds}`;\r\n        if (includeMillis) {\r\n            html += `<span class=\"small grey\">:${ms}</span>`;\r\n        }\r\n        return html;\r\n    }\r\n\r\n    toDebugString() {\r\n        let d = pretendServerIsUTC(this);\r\n        let year = d.getUTCFullYear();\r\n        let month = d.getUTCMonth().toString().padStart(2, '0');\r\n        let day = d.getUTCDate().toString().padStart(2, '0');\r\n        let hours = d.getUTCHours().toString().padStart(2, '0');\r\n        let minutes = d.getUTCMinutes().toString().padStart(2, '0');\r\n        let seconds = d.getUTCSeconds().toString().padStart(2, '0');\r\n        let ms = d.getUTCMilliseconds().toString().padStart(3, '0');\r\n        let offsetHours = Math.round(serverOffsetFromUtc / 360000) / 10;        \r\n        return `${year}-${month}-${day} ${hours}:${minutes}:${seconds}.${ms} ServerTime(UTC+${offsetHours})`;\r\n    }\r\n\r\n    imageSrc() {\r\n        return ImageSrc.calendar;\r\n    }\r\n\r\n    /**\r\n     * @params whatever would be passed to a Date constructor\r\n     * @return {TwCheeseDate}\r\n     */\r\n    static newServerDate() {\r\n        let ret = new TwCheeseDate_TwCheeseDate(...arguments);\r\n        if (arguments.length > 1) {\r\n            ret = ret.addMilliseconds(0 - serverOffsetFromUtc - localOffsetFromUtc);\r\n        }\r\n        return ret;\r\n    }\r\n\r\n    static monthNumber(monthName) {\r\n        return (new Date(monthName + ' 1 1970')).getMonth();\r\n    }\r\n\r\n}\r\n\r\n\n// CONCATENATED MODULE: ./src/Models/ReportRenamer.js\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\nclass ReportRenamer_ReportRenamer {\r\n\r\n    /**\r\n     * @param {BattleReport} report \r\n     * @param {string} note\r\n     * @return {Promise}\r\n     * @resolve {string} new name\r\n     */\r\n    async rename(report, note) {\r\n        let newName = this.createName(report, note);\r\n        await postToGame('report', { ajaxaction: 'edit_subject', report_id: report.reportId }, { text: newName });\r\n\r\n        $(this).trigger({\r\n            type: 'report-renamed',\r\n            reportId: report.reportId,\r\n            newName\r\n        });\r\n\r\n        return newName;\r\n    }\r\n\r\n    /**\r\n     * @param {BattleReport} report \r\n     * @param {string} note\r\n     * @return {string} new name\r\n     */\r\n    createName(report, note = '') {\r\n        var newName = 'twCheese: ';\r\n        newName += report.attacker.name.replace(textScraper.t('report.deletedPlayer'), '') + ' ';\r\n        newName += '(' + report.attackerVillage.x + '|' + report.attackerVillage.y + ',' + report.attackerVillage.id + ')';\r\n        newName += report.defender.name.replace(textScraper.t('report.deletedPlayer'), '');\r\n        newName += '(' + report.defenderVillage.x + '|' + report.defenderVillage.y + ',' + report.defenderVillage.id + ')';\r\n    \r\n        let timingInfo = report.calcTimingInfo();\r\n        newName += '_t:' + Math.floor(timingInfo.launchTime.getTime() / 1000) + '. ';\r\n\r\n        if (report.attackerLosses.snob > 0) //dead noble\r\n            newName += '_x';\r\n        if (report.loyalty)\r\n            newName += '_l:' + report.loyalty.after + '.';\r\n        if (report.defenderSurvivors)\r\n            newName += '_d[' + report.defenderSurvivors.toArray() + '] ';\r\n        if (report.buildingLevels)\r\n            newName += '_b[' + report.buildingLevels.toArray() + '] ';\r\n        if (report.resources)\r\n            newName += '_r[' + report.resources.toArray() + '] ';\r\n        if (report.wasAttackFeint())\r\n            newName += '_f';\r\n        if (note)\r\n            newName += '_n:' + note;\r\n    \r\n        return newName;\r\n    }\r\n\r\n\r\n    /**\r\n     * @param {string} reportName \r\n     * @return {BattleReportCondensed}\r\n     */\r\n    parseName(reportName) {\r\n        reportName = reportName.trim();\r\n    \r\n        if (reportName.startsWith('twCheese:')) {\r\n            try {\r\n                return this.parseTwCheeseName(reportName);\r\n            }\r\n            catch (err) {\r\n                console.error('parseTwCheeseName failed:', reportName, err);\r\n            }\r\n        }\r\n        else {\r\n            try {\r\n                return this.parseDefaultName(reportName);\r\n            }\r\n            catch (err) {\r\n                // The player could have renamed the report to something unrecognized, or the game changed the name format.\r\n                console.info('parseDefaultName failed:', reportName);\r\n            }\r\n        }\r\n        let fallbackReport = new BattleReportCondensed_BattleReportCondensed();        \r\n        fallbackReport.subject = reportName;\r\n        return fallbackReport;        \r\n    }\r\n\r\n    /**\r\n     * @param {string} reportName \r\n     * @return {BattleReportCondensed}\r\n     */\r\n    parseDefaultName(reportName) {\r\n        let report = new BattleReportCondensed_BattleReportCondensed();\r\n        report.subject = reportName;\r\n\r\n        // e.g. \"Pazuzu (Squanch) scouts cheesasauruss village (600|410) K46 - (spy)\"\r\n        let expr = /(.*?) \\(.+\\((\\d+)\\|(\\d+)/;\r\n        let [, aName, dvX, dvY] = reportName.match(expr);\r\n        report.attackerName = aName;\r\n        report.defenderVillage = new Village(0, dvX, dvY);\r\n        return report;\r\n    }\r\n\r\n    /**\r\n     * @param {string} reportName \r\n     * @return {BattleReportCondensed}\r\n     */\r\n    parseTwCheeseName(reportName) {\r\n        let report = new BattleReportCondensed_BattleReportCondensed();\r\n        report.subject = reportName;\r\n\r\n        // e.g. \"twCheese: Pazuzu (598|419,17068)cheesasaurus(600|410,20373)\"\r\n        let expr = /twCheese: (.*?) \\((\\d+)\\|(\\d+),(\\d+)\\)(.*?)\\((\\d+)\\|(\\d+),(\\d+)\\)/\r\n        let [, aName, avX, avY, avId, dName, dvX, dvY, dvId] = reportName.match(expr);\r\n        report.attackerName = aName;\r\n        report.attackerVillage = new Village(avId, avX, avY);\r\n        report.defenderName = dName;\r\n        report.defenderVillage = new Village(dvId, dvX, dvY);\r\n\r\n        // set note, and remove from reportName\r\n        if (reportName.includes('_n:')) {\r\n            report.note = reportName.match(/_n:(.+)/)[1];\r\n            reportName = reportName.replace(/_n:.+/, '');\r\n        }\r\n\r\n        // set buildingLevels\r\n        let matches = reportName.match(/_b(\\[\\S+\\])/);\r\n        if (matches) {\r\n            report.buildingLevels = Buildings_BuildingLevels.fromArray(JSON.parse(matches[1]));\r\n        }\r\n\r\n        // set resources\r\n        matches = reportName.match(/_r(\\[\\S+\\])/);\r\n        if (matches) {\r\n            let r = JSON.parse(matches[1]);\r\n            report.resources = new Resources_Resources(r[0], r[1], r[2]);\r\n        }\r\n\r\n        // set defenderSurvivors\r\n        matches = reportName.match(/_d(\\[\\S+\\])/);\r\n        if (matches) {\r\n            report.defenderSurvivors = TroopCounts.fromArray(JSON.parse(matches[1]));\r\n        }\r\n\r\n        // set loyalty\r\n        matches = reportName.match(/_l:(\\d+)/);\r\n        if (matches) {\r\n            report.loyalty = { after: parseInt(matches[1]) };\r\n        }\r\n\r\n        // set timeLaunched\r\n        matches = reportName.match(/_t:(\\d+)/);\r\n        if (matches) {\r\n            report.timeLaunched = TwCheeseDate_TwCheeseDate.newServerDate(parseInt(matches[1]) * 1000);\r\n        }\r\n\r\n        report.attackerNobleDied = reportName.includes('_x');\r\n        report.wasAttackFeint = reportName.includes('_f');\r\n        return report;\r\n    }\r\n\r\n    availableChars(name) {\r\n        return 255 - name.length;\r\n    }\r\n\r\n}\r\n\r\n\n// CONCATENATED MODULE: ./src/Models/DemolitionCalculator.js\n\r\nlet catAmounts = [0, 2, 6, 10, 15, 21, 28, 36, 45, 56, 68, 82, 98, 115, 136, 159, 185, 215, 248, 286, 328, 376, 430, 490, 558, 634, 720, 815, 922, 1041, 1175, 1175];\r\nlet catAmountsChurch = [0, 400, 500, 600, 600];\r\nlet ramAmounts = [0, 2, 4, 7, 10, 14, 19, 24, 30, 37, 45, 55, 65, 77, 91, 106, 124, 143, 166, 191, 219];\r\nlet invulnerable = ['church_f', 'hide'];\r\n\r\n\r\nfunction whichSiegeLookup(buildingType) {\r\n    switch (buildingType) {\r\n        case 'wall':    return ramAmounts;\r\n        case 'church':  return catAmountsChurch;\r\n        // todo: check if watchtower uses something special\r\n        default:        return catAmounts;\r\n    }\r\n}\r\n\r\n\r\nclass DemolitionCalculator {\r\n\r\n    /**\r\n     * @param {BuildingLevels} buildingLevels\r\n     * @return {{oneShotScouted:object, oneShotUpgraded:object}} mappings of how many siege units to demolish buildings\r\n     *     example: {\r\n     *         oneShotScouted: {\r\n     *             barracks: 23, // 23 catapults to demolish the scouted barracks level in one shot\r\n     *             wall: 42 // 42 rams to demolish the scouted wall level in one shot\r\n     *         },\r\n     *         oneShotUpgraded: {\r\n     *             barracks: 69, // 69 catapults to demolish the scouted barracks level, +1 upgrade, in one shot\r\n     *             wall: 1337 // 1337 rams to demolish the scouted wall level, +1 upgrade, in one shot\r\n     *         }\r\n     *     }\r\n     *  \r\n     */\r\n    suggestSiegeUnits(buildingLevels) {\r\n        let demoScouted = {};\r\n        let demoBuffer = {};\r\n\r\n        function assignDemolition(buildingType) {\r\n            if (invulnerable.includes(buildingType)) {\r\n                demoScouted[buildingType] = 'NA';\r\n                demoBuffer[buildingType] = 'NA';\r\n                return;\r\n            }\r\n\r\n            let level = buildingLevels[buildingType];\r\n            if (level === '?') {\r\n                demoScouted[buildingType] = '?';\r\n                demoBuffer[buildingType] = '?';\r\n                return;\r\n            }\r\n\r\n            let siegeAmounts = whichSiegeLookup(buildingType);\r\n\r\n            demoScouted[buildingType] = siegeAmounts[level];\r\n            let bufferLevel = buildingLevels.canUpgrade(buildingType) ? level + 1 : level;\r\n            demoBuffer[buildingType] = siegeAmounts[bufferLevel];\r\n        }\r\n\r\n        for (let buildingType in buildingLevels) {\r\n            assignDemolition(buildingType);\r\n        }\r\n\r\n        return {\r\n            oneShotScouted: demoScouted,\r\n            oneShotUpgraded: demoBuffer\r\n        };\r\n    }\r\n\r\n}\r\n\r\n\r\n\n// CONCATENATED MODULE: ./src/Models/BattleReport.js\n\r\n\r\n\r\n\r\nclass BattleReport_BattleReport {\r\n    constructor() {\r\n        this.attacker = null;\r\n        this.attackerLosses = null;\r\n        this.attackerQuantity = null;\r\n        this.attackerSurvivors = null;\r\n        this.attackerVillage = null;\r\n        this.battleTime = null;\r\n        this.buildingLevels = null;\r\n        this.catDamage = null;\r\n        this.defender = null;\r\n        this.defenderLosses = null;\r\n        this.defenderQuantity = null;\r\n        this.defenderSurvivors = null;\r\n        this.defenderVillage = null;\r\n        this.dotColor = null;\r\n        this.espionageLevel = null;\r\n        this.haul = null;\r\n        this.loyalty = null; // {before:number, after:number}\r\n        this.luck = null;\r\n        this.morale = null;\r\n        this.ramDamage = null;\r\n        this.reportId = null;\r\n        this.resources = null;\r\n        this.unitsInTransit = null;\r\n        this.unitsOutside = null;\r\n    }\r\n\r\n    /**\r\n     * @return {{launchTime:TwCheeseDate, returnTime:TwCheeseDate}}\r\n     */\r\n    calcTimingInfo() {\r\n        let distance = this.attackerVillage.distanceTo(this.defenderVillage);\r\n        let travelDuration = this.attackerQuantity.travelDuration(distance, 'attack');\r\n        return {\r\n            launchTime: this.battleTime.subMilliseconds(travelDuration),\r\n            returnTime: this.battleTime.addMilliseconds(travelDuration).startOfSecond()\r\n        };\r\n    }\r\n\r\n    /**\r\n     * @return {{buildings:number, troops:number, idle:number}}\r\n     */\r\n    calcPopulation() {\r\n        if (this.espionageLevel < 2) {\r\n            throw Error('not enough information to determine population');\r\n        }\r\n        let buildingPop = this.buildingLevels.populationUsed();\r\n        let troopPop = this.defenderQuantity.populationUsed();\r\n        if (this.unitsOutside) {\r\n            troopPop += this.unitsOutside.populationUsed();\r\n        }\r\n        return {\r\n            buildings: buildingPop,\r\n            troops: troopPop,\r\n            idle: this.buildingLevels.populationCap() - buildingPop - troopPop\r\n        };\r\n    }\r\n\r\n    /**\r\n     * @param {Number} haulBonus the extra % bonus haul from flags, events, etc.  Example: 30 for 30%, NOT 0.3\r\n     * @return {TroopCounts} how many of each type of troop should be sent to take all resources, provided only one type of troop is sent\r\n     */\r\n    calcRaidScouted(haulBonus = 0) {\r\n        if (this.espionageLevel < 1) {\r\n            throw Error('not enough information');\r\n        }\r\n        return this.calcRaidUnits(this.resources.sum(), haulBonus);\r\n    }\r\n\r\n    /**\r\n     * @param {{x:number, y:number}} home\r\n     * @param {TwCheeseDate} timeNow the current time\r\n     * @param {number} haulBonus the extra % bonus haul from flags, events, etc. Example: 30 for 30%, NOT 0.3\r\n     * @return {TroopCounts} how many of each type of troop should be sent to take all resources, provided only one type of troop is sent\r\n     */\r\n    calcRaidPredicted(home, timeNow, haulBonus = 0) {\r\n        if (this.espionageLevel < 2) {\r\n            throw Error('not enough information');\r\n        }\r\n        let distance = this.defenderVillage.distanceTo(home);\r\n        let maxLoot = this.buildingLevels.resourceCap() - this.buildingLevels.hideableResources();\r\n        let hourlyProduction = this.buildingLevels.resourceProductionHourly();\r\n\r\n        let hoursSinceReport = (timeNow - this.battleTime) / 3600000;\r\n        let resourcesProducedSinceReport = hourlyProduction.multiply(hoursSinceReport);\r\n        let resourcesNow = this.resources.add(resourcesProducedSinceReport);\r\n\r\n        let troopCounts = new TroopCounts();\r\n        for (let troopType of Troops_troopTypes) {\r\n            let travelDuration = troopUtil.travelDuration(troopType, distance);\r\n            let travelHours = travelDuration / 3600000;\r\n            let resourcesProducedDuringTravel = hourlyProduction.multiply(travelHours);\r\n            let resourcesAtArrival = resourcesNow.add(resourcesProducedDuringTravel).cap(maxLoot);\r\n            troopCounts[troopType] = troopUtil.countToCarry(troopType, resourcesAtArrival.sum(), haulBonus);\r\n        }\r\n        return troopCounts;\r\n    }\r\n\r\n    /**\r\n     * @param {number} periodHours the number of hours that resources have been accumulating\r\n     * @param {number} haulBonus the extra % bonus haul from flags, events, etc. Example: 30 for 30%, NOT 0.3\r\n     * @return {TroopCounts} how many of each type of troop should be sent to take all resources, provided only one type of troop is sent\r\n     */\r\n    calcRaidPeriodic(periodHours, haulBonus = 0) {\r\n        let resourcesProduced = this.buildingLevels.resourceProductionHourly().multiply(periodHours);\r\n        let maxLoot = this.buildingLevels.resourceCap() - this.buildingLevels.hideableResources();\r\n        let totalResources = resourcesProduced.cap(maxLoot).sum();\r\n        return this.calcRaidUnits(totalResources, haulBonus);\r\n    }\r\n\r\n    /**\r\n     * @param {number} resources the total resources to be raided\r\n     * @param {number} haulBonus the extra % bonus haul from flags, events, etc. Example: 30 for 30%, NOT 0.3\r\n     * @return {TroopCounts} how many of each type of troop should be sent to take all resources, provided only one type of troop is sent\r\n     */\r\n    calcRaidUnits(resources, haulBonus = 0) {\r\n        let troopCounts = new TroopCounts();\r\n        for (let troopType of Troops_troopTypes) {\r\n            troopCounts[troopType] = troopUtil.countToCarry(troopType, resources, haulBonus);\r\n        }\r\n        return troopCounts;\r\n    }\r\n\r\n    /**\r\n     * was the attack likely just a distraction?\r\n     * @return {boolean}\r\n     */\r\n    wasAttackFeint() {\r\n        let troops = this.attackerQuantity;\r\n        return troops.snob === 0 && troops.populationUsed() <= 130;\r\n    }\r\n\r\n    /**\r\n     * were the defender's troops all killed?\r\n     * @return {boolean}\r\n     */\r\n    wasDefenderCleared() {\r\n        return this.defenderSurvivors && this.defenderSurvivors.isZero();\r\n    }\r\n\r\n    /**\r\n     * @return {{oneShotScouted:object, oneShotUpgraded:object}} mappings of how many siege units to demolish buildings\r\n     */\r\n    suggestSiegeUnits() {\r\n        if (this.espionageLevel < 2) {\r\n            throw Error('not enough information');\r\n        }\r\n        return (new DemolitionCalculator()).suggestSiegeUnits(this.buildingLevels);\r\n    }\r\n\r\n}\r\n\r\n\r\n\n// CONCATENATED MODULE: ./src/Models/Player.js\n\r\nclass Player {\r\n    constructor(id, name) {\r\n        this.id = id;\r\n        this.name = name;\r\n    }\r\n}\r\n\r\n\r\n\n// CONCATENATED MODULE: ./src/Models/StationedTroops.js\n\r\nclass StationedTroops {\r\n    \r\n    /**\r\n     * @param TroopCounts troopCounts\r\n     * @param Village village\r\n     */\r\n    constructor(troopCounts, village) {\r\n        this.troopCounts = troopCounts;\r\n        this.village = village;\r\n    }\r\n\r\n}\r\n\r\n\r\n\n// CONCATENATED MODULE: ./src/Scrape/time.js\n\r\n\r\n// note: some worlds have milliseconds disabled\r\n\r\n/**\r\n * @param {string} text formatted the way tw does it\r\n * @param {string} market two char market code. e.g. \"en\"\r\n * @return {TwCheeseDate}\r\n */\r\nfunction parseArrival(text, market) {    \r\n    switch (market) {\r\n        case 'cz': return parseArrivalCzech(text);\r\n        case 'pt': return parseArrivalPortuguese(text);       \r\n        case 'nl': return parseArrivalNL(text);\r\n    }\r\n    return parseArrivalEnglish(text);\r\n};\r\n\r\nfunction parseArrivalEnglish(text) {\r\n    // e.g. \"Jun 12, 2019  15:36:23:000\"\r\n    let expr = /(\\D+) (\\d+), (\\d+)  (\\d+):(\\d+):(\\d+):?(\\d+)?/;\r\n    let [, monthName, day, year, hours, minutes, seconds, millis] = text.match(expr);    \r\n    let month = TwCheeseDate_TwCheeseDate.monthNumber(monthName);\r\n    return TwCheeseDate_TwCheeseDate.newServerDate(year, month, day, hours, minutes, seconds, millis || 0);\r\n}\r\n\r\nfunction parseArrivalCzech(text) {\r\n    // e.g. \"10.07.19 04:43:15:967\"\r\n    let [day, monthNumber, yearShort, hours, minutes, seconds, millis] = text.match(/\\d+/g);\r\n    let year = '20' + yearShort;\r\n    let month = monthNumber - 1;\r\n    return TwCheeseDate_TwCheeseDate.newServerDate(year, month, day, hours, minutes, seconds, millis || 0);\r\n}\r\n\r\nfunction parseArrivalPortuguese(text) {\r\n    // e.g. \"09/jul/2019 (20:03:15):895\"\r\n    let expr = /(\\d+)\\/(\\D+)\\/(\\d+) \\((\\d+):(\\d+):(\\d+)\\):?(\\d+)?/;\r\n    let [, day, monthName, year, hours, minutes, seconds, millis] = text.match(expr);\r\n    let month = TwCheeseDate_TwCheeseDate.monthNumber(monthName);\r\n    return TwCheeseDate_TwCheeseDate.newServerDate(year, month, day, hours, minutes, seconds, millis || 0);\r\n}\r\n\r\nfunction parseArrivalNL(text) {\r\n    // e.g. \"05.04.20 09:53:18:100\"\r\n    let expr = /(\\d+)\\.(\\d+)\\.(\\d+) \\((\\d+):(\\d+):(\\d+)\\):?(\\d+)?/;\r\n    let [, day, monthNumber, yearShort, hours, minutes, seconds, millis] = text.match(expr);\r\n    let year = '20' + yearShort;\r\n    let month = monthNumber\r\n    return TwCheeseDate_TwCheeseDate.newServerDate(year, month, day, hours, minutes, seconds, millis || 0);\r\n}\r\n\r\n\r\n\n// CONCATENATED MODULE: ./src/Scrape/res.js\n\r\n\r\n/**\r\n * @param {HTMLElement} resourcesContainer an element containing wood/stone/iron amounts\r\n * @return {Resources}\r\n */\r\nfunction scrapeResources(resourcesContainer) {\r\n    // remove grey periods used as thousands separators\r\n    let $res = $(resourcesContainer).clone();\r\n    $res.find('.grey').remove();\r\n\r\n    let resAmount = function(resIconCssClass) {\r\n        // note: sometimes, if the res amount is 0, the game excludes it (and its icon) instead of showing 0\r\n        let icon = $res.find('span.' + resIconCssClass).get(0);\r\n        return icon ? parseInt($(icon).parent().text()) : 0;\r\n    }\r\n\r\n    return new Resources_Resources(\r\n        resAmount('wood'),\r\n        resAmount('stone'),\r\n        resAmount('iron')\r\n    );\r\n};\r\n\r\n\n// CONCATENATED MODULE: ./src/Scrape/BattleReportScraper.js\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n/**\r\n * @param {HTMLTableCellElement} playerCell a cell containing a link to a player profile\r\n * @return {Player}\r\n */\r\nfunction scrapePlayer(playerCell) {\r\n    if (textScraper.includes(playerCell, 'report.deletedPlayer')) {\r\n        return new Player(-1, $(playerCell).text());\r\n    }\r\n    else if (playerCell.innerHTML === '---') {\r\n        return new Player(0, '---');\r\n    }\r\n    let playerLink = playerCell.firstChild;\r\n    let id = parseInt(playerLink.href.match(/&id=(\\d+)/)[1]);\r\n    let name = playerLink.innerHTML;\r\n    return new Player(id, name);\r\n}\r\n\r\n\r\n/**\r\n * @param {HTMLTableRowElement} troopRow a row of cells containing troop counts\r\n * @return {TroopCounts}\r\n */\r\nfunction scrapeTroopCounts(troopRow) {\r\n    let troops = new TroopCounts();\r\n    let troopTypes = troopUtil.troopTypesOnWorld();\r\n    for (let i = 0; i < troopTypes.length; i++) {\r\n        if (typeof troopRow.cells[i] !== 'undefined') { // attacker can't have militia\r\n            troops[troopTypes[i]] = parseInt(troopRow.cells[i].innerHTML);\r\n        }        \r\n    }\r\n    return troops;\r\n}\r\n\r\n\r\n/**\r\n * @param {HTMLAnchorElement} link - a link to a village with the name and coordinates\r\n * @return {Village}\r\n */\r\nfunction scrapeVillage(link) {\r\n    let [, id] = link.href.match(/&id=(\\d+)/);\r\n    let [, x, y] = link.innerHTML.match(/\\((\\d+)\\|(\\d+)\\)(?!.*\\(.*?\\))/);\r\n    return new Village(parseInt(id), parseInt(x), parseInt(y));\r\n}\r\n\r\n\r\n/**\r\n * removes the label from a troop count row\r\n * @return\ttroopRowCopy:HTMLTableRowElement - a row of troop counts suitable for the twcheese_getTroopCount function\r\n * @param\ttroopRow:HTMLTableRowElement - the row of troop counts with the label\r\n */\r\nfunction removeTroopsLabel(troopRow) {\r\n    var troopRowCopy = document.createElement('tr');\r\n    for (var i = 1; i < troopRow.cells.length; i++) {\r\n        troopRowCopy.appendChild(document.createElement('td'));\r\n        troopRowCopy.cells[i - 1].innerHTML = troopRow.cells[i].innerHTML;\r\n    }\r\n    return troopRowCopy;\r\n}\r\n\r\n/**\r\n * scrapes the page from game.php?screen=report&view={reportId}\r\n */\r\nclass BattleReportScraper_BattleReportScraper {\r\n\r\n    /**\r\n     * @param {HTMLDocument} gameDoc\r\n     */\r\n    constructor(gameDoc) {\r\n        this.gameDoc = gameDoc;\r\n        this.$gameDoc = $(gameDoc);\r\n        this.mainTable = this.$gameDoc.find('#attack_luck').parents('table')[0];\r\n        this.luckTable = gameDoc.getElementById('attack_luck');\r\n        this.attackerTable = gameDoc.getElementById('attack_info_att');\r\n        this.attackerUnitsTable = gameDoc.getElementById('attack_info_att_units');\r\n        this.defenderTable = gameDoc.getElementById('attack_info_def');\r\n        this.defenderUnitsTable = gameDoc.getElementById('attack_info_def_units');\r\n        this.resultsTable = gameDoc.getElementById('attack_results');\r\n        this.supportKilledTable = gameDoc.getElementById('attack_away_units');\r\n        this._validate();\r\n    }\r\n\r\n    _validate() {\r\n        let shouldAlwaysBeThere = ['mainTable', 'luckTable', 'attackerTable', 'attackerUnitsTable', 'defenderTable'];\r\n        for (let propName of shouldAlwaysBeThere) {\r\n            if (!this[propName]) {\r\n                throw Error(`BattleReportScraper failed: couldn't locate the ${propName}`);\r\n            }\r\n        }\r\n    }\r\n\r\n    scrapeReport() {\r\n        let report = new BattleReport_BattleReport();\r\n\r\n        report.attacker = this.getAttacker();\r\n        report.attackerLosses = this.getAttackerLosses();\r\n        report.attackerQuantity = this.getAttackerQuantity();\r\n        report.attackerVillage = this.getAttackerVillage();\r\n        report.battleTime = this.getBattleTime();\r\n        report.buildingLevels = this.getBuildingLevels();\r\n        report.catDamage = this.getCatDamage();\r\n        report.defender = this.getDefender();\r\n        report.defenderLosses = this.getDefenderLosses();\r\n        report.defenderQuantity = this.getDefenderQuantity();\r\n        report.defenderVillage = this.getDefenderVillage();\r\n        report.dotColor = this.getDotColor();\r\n        report.espionageLevel = this.getEspionageLevel();\r\n        report.haul = this.getHaul();\r\n        report.loyalty = this.getLoyalty();\r\n        report.luck = this.getLuck();\r\n        report.morale = this.getMorale();\r\n        report.ramDamage = this.getRamDamage();\r\n        report.reportId = this.getReportId();\r\n        report.resources = this.getResources();        \r\n        report.unitsOutside = this.getUnitsOutside();\r\n        report.unitsInTransit = this.getUnitsInTransit();\r\n\r\n        report.attackerSurvivors = report.attackerQuantity.subtract(report.attackerLosses);\r\n\r\n        if (report.defenderQuantity) {\r\n            report.defenderSurvivors = report.defenderQuantity.subtract(report.defenderLosses);\r\n        }\r\n\r\n        if (!report.buildingLevels && (report.ramDamage || report.catDamage)) {\r\n            report.buildingLevels = new Buildings_BuildingLevels('?');\r\n            if (report.ramDamage) {\r\n                report.buildingLevels.wall = report.ramDamage.levelAfter;\r\n            }\r\n            if (report.catDamage) {\r\n                report.buildingLevels[report.catDamage.buildingType] = report.catDamage.levelAfter;\r\n            }\r\n        }\r\n\r\n\r\n\r\n        return report;\r\n    }\r\n\r\n    /**\r\n     * @return {Player}\r\n     */\r\n    getAttacker() {\r\n        var playerCell = this.attackerTable.rows[0].cells[1];\r\n        return scrapePlayer(playerCell);\r\n    }\r\n\r\n    /**\r\n     * @return {TroopCounts}\r\n     */\r\n    getAttackerLosses() {\r\n        return scrapeTroopCounts(removeTroopsLabel(this.attackerUnitsTable.rows[2]));\r\n    }\r\n\r\n    /**\r\n     * @return {TroopCounts}\r\n     */\r\n    getAttackerQuantity() {\r\n        return scrapeTroopCounts(removeTroopsLabel(this.attackerUnitsTable.rows[1]));\r\n    }\r\n\r\n    /**\r\n     * @return {Village}\r\n     */\r\n    getAttackerVillage() {\r\n        return scrapeVillage(this.attackerTable.rows[1].cells[1].firstChild.firstChild);\r\n    }\r\n\r\n    /**\r\n     * @return {TwCheeseDate}\r\n     */\r\n    getBattleTime() {\r\n        var text = $(this.mainTable.rows[1].cells[1]).text();\r\n        return parseArrival(text, window.game_data.market);\r\n    }\r\n\r\n    /**\r\n     * @return {BuildingLevels|null}\r\n     */\r\n    getBuildingLevels() {\r\n        if (this.getEspionageLevel() < 2) {\r\n            return null;\r\n        }\r\n\r\n        let levels = new Buildings_BuildingLevels();\r\n        let buildingData = JSON.parse(this.$gameDoc.find('#attack_spy_building_data').val());\r\n        for (let building of buildingData) {\r\n            levels[building.id] = parseInt(building.level);\r\n        }\r\n        return levels;\r\n    }\r\n\r\n    /**\r\n     * @return {{buildingType:string, levelBefore:number, levelAfter:number} | null}\r\n     */\r\n    getCatDamage() {\r\n        if (!this.resultsTable) {\r\n            return null;\r\n        }\r\n        var thElements = this.resultsTable.getElementsByTagName('th');\r\n        let catHeader = textScraper.first(thElements, 'report.catDamage');\r\n        if (!catHeader) {\r\n            return null;\r\n        }\r\n        let damageCell = catHeader.parentNode.cells[1];\r\n        let buildingType = textScraper.buildingType(damageCell);\r\n        let bElements = damageCell.getElementsByTagName('b');\r\n        return {\r\n            buildingType,\r\n            levelBefore: parseInt(bElements[0].innerHTML),\r\n            levelAfter: parseInt(bElements[1].innerHTML)\r\n        };\r\n    }\r\n\r\n    /**\r\n     * @return {Player}\r\n     */\r\n    getDefender() {\r\n        var playerCell = this.defenderTable.rows[0].cells[1];\r\n        return scrapePlayer(playerCell);\r\n    }\r\n\r\n    /**\r\n     * @return {TroopCounts|null}\r\n     */\r\n    getDefenderLosses() {\r\n        if (!this.defenderUnitsTable) {\r\n            return null;\r\n        }\r\n        return scrapeTroopCounts(removeTroopsLabel(this.defenderUnitsTable.rows[2]));\r\n    }\r\n\r\n    /**\r\n     * @return {TroopCounts|null}\r\n     */\r\n    getDefenderQuantity() {\r\n        if (!this.defenderUnitsTable) {\r\n            return null;\r\n        }\r\n        return scrapeTroopCounts(removeTroopsLabel(this.defenderUnitsTable.rows[1]));\r\n    }\r\n\r\n    /**\r\n     * @return {Village}\r\n     */\r\n    getDefenderVillage() {\r\n        return scrapeVillage(this.defenderTable.rows[1].cells[1].firstChild.firstChild);\r\n    }\r\n\r\n    /**\r\n     * @return {string} color: blue, green, yellow, or red\r\n     */\r\n    getDotColor() {\r\n        return $(this.mainTable.rows[0].cells[1])\r\n            .find('img[src*=\"dots/\"]')\r\n            .attr('src')\r\n            .match(/dots\\/(.+).png/)[1];\r\n    }\r\n\r\n    /**\r\n     * @return {number} espionageLevel\r\n     *-------- level -------------\r\n        * value\tsignificance\r\n        * 0\t\tnothing scouted\r\n        * 1\t\tresources\r\n        * 2\t\tbuildings\r\n        * 3\t\texternal troops\r\n        */\r\n    getEspionageLevel() {\r\n        var spied_resources = this.$gameDoc.find('#attack_spy_resources').length > 0;\r\n        var spied_buildings = this.$gameDoc.find('#attack_spy_building_data').length > 0;\r\n        var spied_external = this.$gameDoc.find('#attack_spy_away').length > 0;\r\n        return Number(Number(spied_resources) + Number(spied_buildings) + Number(spied_external));\r\n    }\r\n\r\n    /**\r\n     * @return {Resources|null}\r\n     */\r\n    getHaul() {\r\n        if (!this.resultsTable) {\r\n            return null;\r\n        }\r\n        var thElements = this.resultsTable.getElementsByTagName('th');\r\n        let haulHeader = textScraper.first(thElements, 'report.haul');\r\n        if (!haulHeader) {\r\n            return null;\r\n        }\r\n        return scrapeResources(haulHeader.parentNode.cells[1]);\r\n    }\r\n\r\n    /**\r\n     * @return {number}\r\n     */\r\n    getLuck() {\r\n        var luckString = this.luckTable.getElementsByTagName('b')[0].innerHTML;\r\n        return new Number(luckString.substring(0, luckString.indexOf('%')));\r\n    }\r\n\r\n    /**\r\n     * @return {{before:number, after:number} | null}\r\n     */\r\n    getLoyalty() {\r\n        if (!this.resultsTable) {\r\n            return null;\r\n        }\r\n        var thElements = this.resultsTable.getElementsByTagName('th');\r\n        let loyaltyHeader = textScraper.first(thElements, 'report.loyalty');\r\n        if (!loyaltyHeader) {\r\n            return null;\r\n        }\r\n        var bElements = loyaltyHeader.parentNode.getElementsByTagName('b');\r\n        return {\r\n            before: parseInt(bElements[0].innerHTML),\r\n            after: parseInt(bElements[1].innerHTML)\r\n        };\r\n    }\r\n\r\n    /**\r\n     * @return {number|null}\r\n     */\r\n    getMorale() {\r\n        let moraleContainer = this.gameDoc.getElementById('attack_moral'); // todo: there's no such thing\r\n        if (!moraleContainer) {\r\n            return null;            \r\n        }\r\n        var moraleString = moraleContainer.getElementsByTagName('h4')[0].innerHTML;\r\n        return new Number(moraleString.substring(moraleString.indexOf(' ') + 1, moraleString.indexOf('%')));\r\n    }\r\n\r\n    /**\r\n     * @return {{levelBefore:number, levelAfter:number} | null}\r\n     */\r\n    getRamDamage() {\r\n        if (!this.resultsTable) {\r\n            return null;\r\n        }\r\n        var thElements = this.resultsTable.getElementsByTagName('th');\r\n        let ramHeader = textScraper.first(thElements, 'report.ramDamage');\r\n        if (!ramHeader) {\r\n            return null;\r\n        }\r\n        var bElements = ramHeader.parentNode.getElementsByTagName('b');\r\n        return {\r\n            levelBefore: parseInt(bElements[0].innerHTML),\r\n            levelAfter: parseInt(bElements[1].innerHTML)\r\n        };\r\n    }\r\n\r\n    /**\r\n     * @return {number}\r\n     */\r\n    getReportId() {\r\n        return parseInt(this.gameDoc.URL.match(/view=(\\d+)/)[1]);\r\n    }\r\n\r\n    /**\r\n     * @return {Resources|null}\r\n     */\r\n    getResources() {\r\n        let resContainer = this.$gameDoc.find('#attack_spy_resources').find('td')[0];\r\n        if (!resContainer) {\r\n            return null;\r\n        }\r\n        return scrapeResources(resContainer);\r\n    }\r\n\r\n    /**\r\n     * \"Defender's troops in other villages\"\r\n     * Only visible if the village was conquered.\r\n     * @return {StationedTroops[]}\r\n     */\r\n    getSupportKilled() {\r\n        if (!this.supportKilledTable) {\r\n            return [];\r\n        }\r\n        let supportKilled = [];\r\n        for (let row of this.supportKilledTable.rows) {\r\n            let troopCounts = scrapeTroopCounts(removeTroopsLabel(row));\r\n            let village = scrapeVillage(row.cells[0].firstChild);\r\n            supportKilled.push(new StationedTroops(troopCounts, village));\r\n        }\r\n        return supportKilled;\r\n    }\r\n\r\n    /**\r\n     * only visible if the village was conquered\r\n     * @return {TroopCounts|null}\r\n     */\r\n    getUnitsInTransit() {\r\n        var h4elements = this.gameDoc.getElementsByTagName('h4');\r\n        let transitHeader = textScraper.first(h4elements, 'report.unitsInTransit');\r\n        if (!transitHeader) {\r\n            return null;\r\n        }\r\n        return scrapeTroopCounts(transitHeader.nextSibling.nextSibling.rows[1]);\r\n    }\r\n\r\n    /**\r\n     * @return {TroopCounts|null}\r\n     */\r\n    getUnitsOutside() {\r\n        if (this.getEspionageLevel() < 3) {\r\n            return null;\r\n        }\r\n        return scrapeTroopCounts(this.$gameDoc.find('#attack_spy_away').find('table')[0].rows[1]);\r\n    }\r\n\r\n}\r\n\r\n\r\n\n// CONCATENATED MODULE: ./src/Models/AttackIcons.js\n\r\n\r\n\r\nlet bits = {\r\n    SENT_VIA_FA: 1,\r\n    CONTAINS_SNOB: 2,\r\n    CONTAINS_KNIGHT: 4,\r\n    SIZE_SMALL: 8,\r\n    SIZE_MEDIUM: 16,\r\n    SIZE_LARGE: 32,\r\n    CONTAINS_SPY: 64\r\n};\r\n\r\n\r\nlet sizeThresholds = [\r\n    [5001, bits.SIZE_LARGE],\r\n    [1001, bits.SIZE_MEDIUM],\r\n    [1, bits.SIZE_SMALL]\r\n];\r\n\r\n\r\nlet Icons = new Map([\r\n    [bits.SENT_VIA_FA, {\r\n        src: ImageSrc.attackSentViaFa,\r\n        description: 'Looting attack'\r\n    }],\r\n    [bits.SIZE_SMALL, {\r\n        src: ImageSrc.attackSizeSmall,\r\n        description: 'Small attack (1-1000 troops)'\r\n    }],\r\n    [bits.SIZE_MEDIUM, {\r\n        src: ImageSrc.attackSizeMedium,\r\n        description: 'Medium attack (1000-5000 troops)'\r\n    }],\r\n    [bits.SIZE_LARGE, {\r\n        src: ImageSrc.attackSizeLarge,\r\n        description: 'Large attack (5000+ troops)'\r\n    }],\r\n    [bits.CONTAINS_SNOB, {\r\n        src: ImageSrc.attackContainsSnob,\r\n        description: 'Contains Nobleman'\r\n    }],\r\n    [bits.CONTAINS_SPY, {\r\n        src: ImageSrc.attackContainsSpy,\r\n        description: 'Contains Scouts'\r\n    }],\r\n    [bits.CONTAINS_KNIGHT, {\r\n        src: ImageSrc.attackContainsKnight,\r\n        description: 'Contains Paladin'\r\n    }],\r\n]);\r\n\r\n\r\nclass AttackIcons {\r\n    constructor(mask = 0) {\r\n        this.mask = mask;\r\n    }\r\n\r\n    getIcons() {\r\n        let icons = [];\r\n        for (let [bit, icon] of Icons) {\r\n            if (this.mask & bit) {\r\n                icons.push(icon);\r\n            }\r\n        }\r\n        return icons;\r\n    }\r\n\r\n    getMask() {\r\n        return this.mask;\r\n    }\r\n\r\n    setSentViaFa() {\r\n        this.mask |= bits.SENT_VIA_FA;\r\n    }\r\n\r\n    setContainsSnob() {\r\n        this.mask |= bits.CONTAINS_SNOB;\r\n    }\r\n\r\n    setContainsSpy() {\r\n        this.mask |= bits.CONTAINS_SPY;\r\n    }\r\n\r\n    setContainsKnight() {\r\n        this.mask |= bits.CONTAINS_KNIGHT;\r\n    }\r\n\r\n    setSizeSmall() {\r\n        this.mask |= bits.SIZE_SMALL;\r\n    }\r\n\r\n    setSizeMedium() {\r\n        this.mask |= bits.SIZE_MEDIUM;\r\n    }\r\n\r\n    setSizeLarge() {\r\n        this.mask |= bits.SIZE_LARGE;\r\n    }\r\n\r\n    /**\r\n     * @param {TroopCounts} troops\r\n     * @param {boolean} wasSentViaFa\r\n     * @return {AttackIcons}\r\n     */\r\n    static fromTroopCounts(troops, wasSentViaFa = false) {\r\n        let mask = 0;\r\n        if (wasSentViaFa) {\r\n            mask |= bits.SENT_VIA_FA;\r\n        }\r\n        if (troops.snob > 0) {\r\n            mask |= bits.CONTAINS_SNOB;\r\n        }\r\n        if (troops.knight > 0) {\r\n            mask |= bits.CONTAINS_KNIGHT;\r\n        }\r\n        if (troops.spy > 0) {\r\n            mask |= bits.CONTAINS_SPY;\r\n        }\r\n        if (!wasSentViaFa) {\r\n            let sum = troops.sum();\r\n            for (let [threshold, bit] of sizeThresholds) {\r\n                if (sum >= threshold) {\r\n                    mask |= bit;\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n        return new AttackIcons(mask);\r\n    }\r\n\r\n}\r\n\r\n\r\n\r\n\n// CONCATENATED MODULE: ./src/Scrape/AttackIconsScraper.js\n\r\n\r\n\r\nclass AttackIconsScraper_AttackIconsScraper {\r\n    /**\r\n     * @param {HTMLImageElement} imgElements\r\n     * @return {AttackIcons}\r\n     */\r\n    scrapeIcons(imgElements) {\r\n        let icons = new AttackIcons();\r\n\r\n        for (let img of imgElements) {\r\n            if (img.src.includes('command/farm.png')) {\r\n                icons.setSentViaFa();\r\n            }\r\n            else if (img.src.includes('command/snob.png')) {\r\n                icons.setContainsSnob();\r\n            }\r\n            else if (img.src.includes('command/spy.png')) {\r\n                icons.setContainsSpy();\r\n            }\r\n            else if (img.src.includes('command/knight.png')) {\r\n                icons.setContainsKnight();\r\n            }\r\n            else if (img.src.includes('command/attack_small.png')) {\r\n                icons.setSizeSmall();\r\n            }\r\n            else if (img.src.includes('command/attack_medium.png')) {\r\n                icons.setSizeMedium();\r\n            }\r\n            else if (img.src.includes('command/attack_large.png')) {\r\n                icons.setSizeLarge();\r\n            }\r\n        }\r\n\r\n        return icons;\r\n    }\r\n}\r\n\r\n\n// CONCATENATED MODULE: ./src/Scrape/BattleReportCondensedScraper.js\n\r\n\r\n\r\n\r\n\r\n/**\r\n * scrapes listed reports from\r\n *     - game.php?screen=report&mode=attack\r\n *     - game.php?screen=report&mode=defense\r\n * \r\n */\r\nclass BattleReportCondensedScraper_BattleReportCondensedScraper {\r\n\r\n    /**\r\n     * @param {ReportRenamer} reportRenamer \r\n     */\r\n    constructor(reportRenamer) {\r\n        this.reportRenamer = reportRenamer;\r\n        this.attackIconsScraper = new AttackIconsScraper_AttackIconsScraper();\r\n    }\r\n\r\n    /**\r\n     * @param {HTMLTableElement} reportsTable\r\n     * @return {BattleReportCondensed[]}\r\n     */\r\n    scrapeReports(reportsTable) {\r\n        let reports = [];\r\n        for (var i = 1; i < reportsTable.rows.length - 1; i++) {\r\n            let report = this.scrapeReport(reportsTable.rows[i]);\r\n            reports.push(report);\r\n        }\r\n        return reports;\r\n    }\r\n\r\n    /**\r\n     * @param {HTMLTableRowElement} row\r\n     * @return {BattleReportCondensed}\r\n     */\r\n    scrapeReport(row) {\r\n        let reportLink = row.cells[1].getElementsByTagName('a')[0];\r\n        let reportName = reportLink.getElementsByTagName('span')[0].innerHTML;\r\n        let reportIcons = [...row.cells[1].getElementsByTagName('img')];\r\n\r\n        let report = this.reportRenamer.parseName(reportName);\r\n        report.reportId = parseInt(reportLink.href.match(/view=(\\d+)/)[1]);\r\n        report.dotColor = reportIcons.find(img => img.src.includes('graphic/dots/')).src.match(/dots\\/(.+).png/)[1];\r\n        report.isForwarded = !!reportIcons.find(img => img.src.includes('graphic/forwarded.png'));\r\n        report.isNew = $(row.cells[1]).text().trim().endsWith(textScraper.t('report.unread'));\r\n        report.strTimeReceived = row.cells[2].innerHTML;\r\n        report.haulStatus = this.determineHaulStatus(reportIcons);\r\n        report.attackIcons = this.attackIconsScraper.scrapeIcons(reportIcons);\r\n\r\n        return report;\r\n    }\r\n\r\n    /**\r\n     * @param {HTMLImageElement[]} reportIcons\r\n     * @return int\r\n     */\r\n    determineHaulStatus(reportIcons) {\r\n        let lootImg = reportIcons.find(img => img.src.includes('graphic/max_loot/'));\r\n        if (!lootImg) {\r\n            // Note: non-premium users don't get an icon showing partial/full haul.\r\n            // Scout reports don't have this icon either.\r\n            return BattleReportCondensed_BattleReportCondensed.HAUL_STATUS_UNKNOWN\r\n        }\r\n        if (lootImg.src.includes('max_loot/0.png')) {\r\n            return BattleReportCondensed_BattleReportCondensed.HAUL_STATUS_PARTIAL;\r\n        }\r\n        return BattleReportCondensed_BattleReportCondensed.HAUL_STATUS_FULL;        \r\n    }\r\n\r\n}\r\n\r\n\r\n\n// CONCATENATED MODULE: ./src/Models/KillScores.js\nlet scoreDefenderDied = {\r\n    spear: 4,\r\n    sword: 5,\r\n    axe: 1,\r\n    archer: 5,\r\n    spy: 1,\r\n    light: 5,\r\n    marcher: 6,\r\n    heavy: 23,\r\n    ram: 4,\r\n    catapult: 12,\r\n    knight: 40,\r\n    snob: 200,\r\n    militia: 4\r\n};\r\n\r\nlet scoreAttackerDied = {\r\n    spear: 1,\r\n    sword: 2,\r\n    axe: 4,\r\n    archer: 2,\r\n    spy: 2,\r\n    light: 13,\r\n    marcher: 12,\r\n    heavy: 15,\r\n    ram: 8,\r\n    catapult: 10,\r\n    knight: 20,\r\n    snob: 200,\r\n    militia: 1\r\n};\r\n\r\n\r\n/**\r\n * @param {TroopCounts} defenderLosses\r\n */\r\nfunction calcAttackerScore(defenderLosses) {\r\n    let attackerScore = 0;\r\n    for (let [unitType, count] of Object.entries(defenderLosses)) {\r\n        if (typeof scoreDefenderDied[unitType] === 'undefined') {\r\n            console.warn(`Couldn't determine ODA score for ${unitType}`);\r\n            continue;\r\n        }\r\n        attackerScore += scoreDefenderDied[unitType] * count;\r\n    }\r\n    return attackerScore;\r\n}    \r\n\r\n\r\n/**\r\n * @param {TroopCounts} attackerLosses\r\n */\r\nfunction calcDefenderScore(attackerLosses) {\r\n    let defenderScore = 0;\r\n    for (let [unitType, count] of Object.entries(attackerLosses)) {\r\n        if (typeof scoreAttackerDied[unitType] === 'undefined') {\r\n            console.warn(`Couldn't determine ODD score for ${unitType}`);\r\n            continue;\r\n        }\r\n        defenderScore += scoreAttackerDied[unitType] * count;\r\n    }\r\n    return defenderScore;\r\n}\r\n\r\n\r\n\r\n\n// CONCATENATED MODULE: ./src/Models/Loyalty.js\n\r\n\r\n\r\n\r\n/**\r\n * @param {number} reportedLoyalty\r\n * @param {Date} timeReported\r\n * @param {Date} timeNow\r\n * @param {Village|{x:number, y:number}} home\r\n * @param {Village} target\r\n * @return {{loyaltyNow:Number, loyatyAtArrival:Number}}\r\n */\r\nfunction calcLoyalty(reportedLoyalty, timeReported, timeNow, home, target) {\r\n    if (reportedLoyalty <= 0) {\r\n        reportedLoyalty = 25; // loyalty jumps to 25 after a village is conquered\r\n    }\r\n\r\n    let hourlyGain = gameConfig.get('speed');\r\n\r\n    let hoursPassed = (timeNow - timeReported) / 3600000;\r\n    let loyaltyNow = Math.min(100, Math.floor(reportedLoyalty + hoursPassed * hourlyGain));\r\n\r\n    let distance = target.distanceTo(home);\r\n    let travelHours = troopUtil.travelDuration('snob', distance) / 3600000;\r\n    let loyaltyAtArrival = Math.min(100, Math.floor(loyaltyNow + travelHours * hourlyGain));\r\n\r\n    return {loyaltyNow, loyaltyAtArrival};\r\n}\r\n\r\n\r\n\r\n\n// CONCATENATED MODULE: ./src/Util/UI.js\n\r\n\r\n\r\nfunction UI_escapeHtml(text) {\r\n    if (typeof text !== 'string') {\r\n        text = String(text);\r\n    }\r\n    // https://stackoverflow.com/a/4835406\r\n    var map = {\r\n      '&': '&amp;',\r\n      '<': '&lt;',\r\n      '>': '&gt;',\r\n      '\"': '&quot;',\r\n      \"'\": '&#039;'\r\n    };  \r\n    return text.replace(/[&<>\"']/g, function(m) { return map[m]; });\r\n}\r\n\r\n////// css //////\r\n\r\nlet cssInitd = new Set();\r\n\r\nfunction initCss(css) {\r\n    if (cssInitd.has(css)) {\r\n        return;\r\n    }\r\n    $(`<style>${css}</style>`).appendTo('head');\r\n    cssInitd.add(css);\r\n}\r\n\r\ninitCss(`\r\n    .twcheese-popup {\r\n        z-index: 13000;\r\n        display: block;\r\n        position: fixed;\r\n        top: 60px;\r\n        border: 19px solid #804000;\r\n        border-image: url(${ImageSrc.popupBorder}) 19 19 19 19 repeat;\r\n        left: 50%;\r\n        -webkit-transform: translateX(-50%);\r\n        transform: translateX(-50%);\r\n    }\r\n`);\r\n\r\n//////// faders ///////////\r\n\r\n\r\nfunction fadeGameContent () {\r\n    $('body').append('<div id=\"fader\" class=\"fader\">');\r\n};\r\n\r\n\r\nfunction unfadeGameContent() {\r\n    $('#fader').remove();\r\n    $('.twcheese-fader').remove();\r\n}\r\n\r\n\r\nfunction fadeGameContentExcept(el) {\r\n    let $el = $(el);\r\n\r\n    if ($el.length < 1) {\r\n        throw new Error('element does not exist');\r\n    }\r\n    if ($el.length > 1) {\r\n        throw new Error('expected exactly one element, got more');\r\n    }\r\n\r\n    let $faderLeft = spawnFader();\r\n    let $faderRight = spawnFader();\r\n    let $faderTopMenu = spawnFader();\r\n    let $faderTopScreen = spawnFader();\r\n    let $faderBottomScreen = spawnFader();\r\n    let $faderBottomMenu = spawnFader();\r\n\r\n    var $bottomMenu = $('#footer');\r\n    var $topMenu = $('#topContainer');\r\n    var topMenuHeight, screenWidth, screenHeight;\r\n\r\n    function updateMeasurements() {\r\n        topMenuHeight = $topMenu.outerHeight() + 3;\r\n        screenWidth = $('body').outerWidth();\r\n        screenHeight = Math.max($('#ds_body')[0].scrollHeight, document.documentElement.clientHeight);\r\n    }\r\n\r\n    function updateFaders() {\r\n        updateMeasurements();\r\n        updateFaderLeft();\r\n        updateFaderRight();\r\n        updateFaderTopMenu();\r\n        updateFaderTopScreen();\r\n        updateFaderBottomScreen();\r\n        updateFaderBottomMenu();\r\n    }\r\n\r\n\r\n    function updateFaderLeft() {\r\n        let offset = $el.offset();\r\n        $faderLeft.css({\r\n            top: 0,\r\n            left: 0,\r\n            width: offset.left,\r\n            height: screenHeight\r\n        });\r\n    }\r\n\r\n\r\n    function updateFaderRight() {\r\n        let offset = $el.offset();\r\n        $faderRight.css({\r\n            top: 0,\r\n            right: 0,\r\n            width: screenWidth - $el.outerWidth() - offset.left,\r\n            height: screenHeight\r\n        });\r\n    }\r\n\r\n\r\n    function updateFaderTopScreen() {\r\n        let offset = $el.offset();\r\n        $faderTopScreen.css({\r\n            top: topMenuHeight,\r\n            left: offset.left,\r\n            height: offset.top - topMenuHeight,\r\n            width: $el.outerWidth(),\r\n            zIndex: $('.top_bar').zIndex() - 1\r\n        });\r\n    }\r\n\r\n\r\n    function updateFaderBottomScreen() {\r\n        let offset = $el.offset();\r\n        $faderBottomScreen.css({\r\n            top: offset.top + $el.outerHeight(),\r\n            left: offset.left,\r\n            height: screenHeight - offset.top - $el.outerHeight(),\r\n            width: $el.outerWidth(),\r\n            zIndex: $bottomMenu.zIndex() - 1\r\n        });\r\n    }\r\n\r\n\r\n    function updateFaderTopMenu() {\r\n        let offset = $el.offset();\r\n        $faderTopMenu.css({\r\n            position: 'fixed',\r\n            top: 0,\r\n            left: offset.left,\r\n            height: topMenuHeight,\r\n            width: $el.outerWidth()\r\n        });\r\n    }\r\n\r\n\r\n    function updateFaderBottomMenu() {\r\n        let offset = $el.offset();\r\n        $faderBottomMenu.css({\r\n            position: 'fixed',\r\n            bottom: 0,\r\n            left: offset.left,\r\n            height: $bottomMenu.outerHeight(),\r\n            width: $el.outerWidth()\r\n        });\r\n    }\r\n\r\n\r\n    function spawnFader() {\r\n        let css = {\r\n            position: 'absolute',\r\n            background: 'black',\r\n            opacity: 0.5,\r\n            zIndex: 12000\r\n        };\r\n        return $('<div class=\"twcheese-fader\"></div>').css(css).appendTo($('body'));\r\n    }\r\n\r\n    updateFaders();\r\n    $(window).on('resize', updateFaders);\r\n}\r\n\r\n\r\n// mousetrap ///////////////////////////////\r\n\r\nlet mouseEvents = ['click', 'mousemove', 'mousenter', 'mouseleave', 'mouseover', 'mouseout', 'mousedown', 'mouseup'];\r\nlet mouseBubbleEvents = new Set(['click', 'mousemove', 'mouseover', 'mouseout', 'mousedown', 'mouseup']);\r\nlet mouseEventsNeedSpecial = new Set(['mousenter', 'mouseleave', 'mouseover', 'mouseout']);\r\n\r\nclass Mousetrap {\r\n    constructor() {\r\n        this.$trap = $('<div class=\"twcheese-mousetrap\">').css({\r\n            position: 'fixed',\r\n            top: 0,\r\n            left: 0,\r\n            width: '100%',\r\n            height: '100%',\r\n            background: 'cyan',\r\n            opacity: 0.001,\r\n            zIndex: 12000\r\n        })\r\n        this.prevIntendedTarget;\r\n\r\n        this.watchers = {\r\n            // example:\r\n            // click: [{$elements, handler}, {$elements, handler}]\r\n            mouseout: []\r\n        }\r\n\r\n        this.setupHandling();\r\n    }\r\n\r\n    spawn() {\r\n        this.$trap.appendTo('body');\r\n        return this;\r\n    }\r\n\r\n    destruct() {\r\n        this.$trap.remove();\r\n    }\r\n\r\n    setupHandling() {\r\n        let trapEvents = mouseEvents.filter(name => !mouseEventsNeedSpecial.has(name));\r\n\r\n        this.$trap.on(trapEvents.join(' '), (e) => {\r\n            this.$trap.hide();\r\n            let intendedTarget = document.elementFromPoint(e.offsetX, e.offsetY);\r\n            this.$trap.show();\r\n\r\n            this.notifyWatchers(e.type, e, intendedTarget);\r\n\r\n            if (e.type === 'mousemove' && intendedTarget !== this.prevIntendedTarget) {\r\n                this.notifyWatchers('mousenter', e, intendedTarget);\r\n                this.notifyWatchers('mouseleave', e, this.prevIntendedTarget);\r\n                this.notifyWatchers('mouseover', e, intendedTarget);\r\n\r\n                // mouseout\r\n                for (let watcher of this.watchers.mouseout) {\r\n                    watcher.$elements.each((i, el) => {\r\n                        if (\r\n                            this.doesElMatch(el, 'mouseover', this.prevIntendedTarget)\r\n                            && !this.doesElMatch(el, 'mouseover', intendedTarget)\r\n                        ) {\r\n                            watcher.handler.call(el, e);\r\n                        }\r\n                    });\r\n                }\r\n            }\r\n\r\n            this.prevIntendedTarget = intendedTarget;\r\n        });\r\n    }\r\n\r\n    notifyWatchers(eventName, e, intendedTarget) {\r\n        if (typeof this.watchers[eventName] === 'undefined') {\r\n            return;\r\n        }\r\n        for (let watcher of this.watchers[eventName]) {\r\n            watcher.$elements.each((i, el) => {\r\n                if (this.doesElMatch(el, eventName, intendedTarget)) {\r\n                    watcher.handler.call(el, e);\r\n                }\r\n            });\r\n        }\r\n    }\r\n\r\n    doesElMatch(el, eventName, intendedTarget) {\r\n        return el === intendedTarget\r\n        || (mouseBubbleEvents.has(eventName) && $.contains(el, intendedTarget));\r\n    }\r\n\r\n    on(eventName, $elements, handler) {\r\n        if (typeof this.watchers[eventName] === 'undefined') {\r\n            this.watchers[eventName] = [];\r\n        }\r\n        this.watchers[eventName].push({$elements, handler});\r\n        return this;\r\n    }\r\n\r\n}\r\n\r\n\r\n\n// CONCATENATED MODULE: ./src/Transform/enhanceBattleReport.js\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n/**\r\n * @param {HTMLDocument} gameDoc \r\n * @param {BattleReport} report\r\n */\r\nfunction enhanceBattleReport(gameDoc, report) {\r\n\r\n    var reportTable = gameDoc.getElementById('attack_luck').parentNode.parentNode.parentNode.parentNode.parentNode.parentNode;\r\n\r\n    /*==== surviving defenders ====*/\r\n    if (gameDoc.getElementById('attack_info_def_units')) {\r\n        var defenseUnitsTable = gameDoc.getElementById('attack_info_def_units');\r\n        let rowAbove = defenseUnitsTable.rows[defenseUnitsTable.rows.length - 1];\r\n        let survivorsRow = defenseUnitsTable.insertRow(-1);\r\n        survivorsRow.className = \"center\";\r\n        survivorsRow.insertCell(-1);\r\n        survivorsRow.cells[0].innerHTML = 'Survivors:';\r\n        survivorsRow.cells[0].align = 'left';\r\n        \r\n        for (let unitType of troopUtil.troopTypesOnWorld()) {\r\n            if (survivorsRow.cells.length >= rowAbove.cells.length) {\r\n                break;\r\n            }\r\n            let cell = survivorsRow.insertCell(-1);\r\n            let unitCount = report.defenderSurvivors[unitType];\r\n            if (unitCount === 0) {\r\n                cell.className = 'hidden';\r\n            }\r\n            cell.innerHTML = unitCount;\r\n        }\r\n    }\r\n\r\n    /*==== surviving attackers ====*/\r\n    if (gameDoc.getElementById('attack_info_att_units')) {\r\n        var unit_table = gameDoc.getElementById('attack_info_att_units');\r\n        let rowAbove = unit_table.rows[unit_table.rows.length - 1];\r\n        let survivorsRow = unit_table.insertRow(-1);\r\n        survivorsRow.className = \"center\";\r\n        survivorsRow.insertCell(-1);\r\n        survivorsRow.cells[0].innerHTML = 'Survivors:';\r\n        survivorsRow.cells[0].align = 'left';\r\n\r\n        for (let unitType of troopUtil.troopTypesOnWorld()) {\r\n            if (survivorsRow.cells.length >= rowAbove.cells.length) {\r\n                break;\r\n            }\r\n            let cell = survivorsRow.insertCell(-1);\r\n            let unitCount = report.attackerSurvivors[unitType];\r\n            if (unitCount === 0) {\r\n                cell.className = 'hidden';\r\n            }\r\n            cell.innerHTML = unitCount;\r\n        }\r\n    }\r\n\r\n    /*==== population summary ====*/\r\n    if (report.espionageLevel >= 2) {\r\n        let population = report.calcPopulation();\r\n        let idleLabel = (report.espionageLevel === 3) ? 'Idle' : 'Unknown';\r\n\r\n        $(gameDoc).find('#attack_spy_buildings_right')\r\n            .after(`\r\n                <table>\r\n                    <tr>\r\n                        <th>Population:</th>\r\n                        <td>\r\n                            Buildings <b>(${population.buildings})</b>\r\n                            <br/>Military <b>(${population.troops})</b>\r\n                            <br/>${idleLabel} <b>(${population.idle})</b>\r\n                        </td>\r\n                    </tr>\r\n                </table>\r\n            `);\r\n    }\r\n\r\n    /*==== loyalty ====*/\r\n    if (report.loyalty) {\r\n        let now = TwCheeseDate_TwCheeseDate.newServerDate();\r\n        let loyaltyExtra = calcLoyalty(report.loyalty.after, report.battleTime, now, game_data.village, report.defenderVillage);\r\n\r\n        var resultsHeaders = gameDoc.getElementById('attack_results').getElementsByTagName('th');\r\n        var loyaltyRow = textScraper.first(resultsHeaders, 'report.loyalty').parentNode;\r\n        var loyaltyHTML = loyaltyRow.cells[1].innerHTML;\r\n        loyaltyRow.removeChild(loyaltyRow.cells[1]);\r\n        loyaltyRow.insertCell(-1);\r\n        loyaltyRow.cells[1].innerHTML = loyaltyHTML;\r\n        loyaltyRow.cells[1].innerHTML += '<br/><span title=\"the current predicted loyalty, based on time passed since this report\">@Current Time: ' + loyaltyExtra.loyaltyNow + '</span>';\r\n        loyaltyRow.cells[1].innerHTML += '<br/><span title=\"the predicted loyalty at time of arrival, should you send a nobleman from your current village right now\">@Arrival: ' + loyaltyExtra.loyaltyAtArrival + '</span>';\r\n    }\r\n\r\n    /*==== opponents defeated ====*/\r\n    var oddRow = gameDoc.getElementById('attack_info_att').insertRow(-1);\r\n    var oddHeader = document.createElement('th');\r\n    oddHeader.innerHTML = 'ODD:';\r\n    oddRow.appendChild(oddHeader);\r\n    oddRow.insertCell(-1);\r\n    oddRow.cells[1].innerHTML = `The defender gained ${calcDefenderScore(report.attackerLosses)} points.`;\r\n\r\n    var odaRow = gameDoc.getElementById('attack_info_def').insertRow(-1);\r\n    var odaHeader = document.createElement('th');\r\n    odaHeader.innerHTML = 'ODA:';\r\n    odaRow.appendChild(odaHeader);\r\n    odaRow.insertCell(-1);\r\n    if (!report.defenderQuantity) {\r\n        odaRow.cells[1].innerHTML = 'Not enough information.'\r\n    } else {\r\n        odaRow.cells[1].innerHTML = `The attacker gained ${calcAttackerScore(report.defenderLosses)} points.`;\r\n    }\r\n\r\n    /*==== timing info ====*/\r\n    let timingInfo = report.calcTimingInfo();\r\n\r\n    if (!reportTable.rows) //6.5 graphics\r\n        reportTable = reportTable.getElementsByTagName('table')[1];\r\n    var launchRow = reportTable.insertRow(2);\r\n\r\n    launchRow.insertCell(-1);\r\n    launchRow.cells[0].innerHTML = '<span title=\"the time the attacker sent the attack\">Launched</span>';\r\n    launchRow.insertCell(-1);\r\n    launchRow.cells[1].innerHTML = timingInfo.launchTime.toHtml();\r\n\r\n    /*==== determine whether return time should be displayed. ====*/\r\n    let showReturnTime = !report.attackerSurvivors.isZero();\r\n\r\n    var returnRow = reportTable.insertRow(3);\r\n    returnRow.insertCell(-1);\r\n    if (showReturnTime) {\r\n        returnRow.cells[0].innerHTML = '<span title=\"the time the attacking troops return to the attacker\\'s village\">Returns</span>';\r\n        returnRow.insertCell(-1);\r\n        returnRow.cells[1].innerHTML = timingInfo.returnTime.toHtml();\r\n    }\r\n\r\n    /*==== rally point Manage Troops link ====*/\r\n    let isDefenderMe = report.defender.name == game_data.player.name;\r\n    let wasVillageConquered = report.loyalty && report.loyalty.after <= 0;\r\n    if (isDefenderMe || wasVillageConquered) {\r\n        let url = gameUrl('place', {mode:'units', village:report.defenderVillage.id});\r\n        let linkHtml = `<a href=\"${url}\" style=\"float: right;\">\r\n            <img title=\"manage troops\" style=\"float:right; cursor:pointer;\" src=\"${ImageSrc.buildingIcon('place')}\" />\r\n        </a>`;\r\n        let defenderVillageCell = gameDoc.getElementById('attack_info_def').rows[1].cells[1];\r\n        defenderVillageCell.appendChild($(linkHtml)[0]);\r\n    }\r\n\r\n    /*==== json representation ====*/\r\n    var jsonRow = reportTable.insertRow(5);\r\n    jsonRow.insertCell(-1);\r\n    jsonRow.cells[0].colSpan = 2;\r\n    jsonRow.cells[0].innerHTML = '<b>JSON</b><br/><textarea cols=50 readonly=true>' + UI_escapeHtml(JSON.stringify(report, null, 2)) + '</textarea>';\r\n}\r\n\r\n\r\n\n// CONCATENATED MODULE: ./src/Transform/spawnLegacyHelpButton.js\n\r\n\r\n\r\nvar spawnLegacyHelpButton_language = { \"twcheese\": {} };\r\nswitch (game_data.market) {\r\n    default:\r\n        /*==== tribalwars.net, tribalwars.us, tribalwars.co.uk, beta.tribalwars.net ====*/\r\n        spawnLegacyHelpButton_language['twcheese']['Help'] = 'Help';\r\n        break;\r\n\r\n    case 'cz':\r\n        /*==== divokekmeny.cz/ ====*/\r\n        spawnLegacyHelpButton_language['twcheese']['Help'] = 'Pomoc';\r\n        break;\r\n\r\n    case 'se':\r\n        spawnLegacyHelpButton_language['twcheese']['Help'] = 'Hjälp';\r\n        break;\r\n\r\n    /*==== fyletikesmaxes.gr/ ====*/\r\n    case 'gr':\r\n        spawnLegacyHelpButton_language['twcheese']['Help'] = 'Βοήθεια';\r\n        break;\r\n\r\n    /* Norwegian */\r\n    case 'no':\r\n        spawnLegacyHelpButton_language['twcheese']['Help'] = 'Hjelp';\r\n        break;\r\n                        \r\n}\r\n\r\n\r\n/**\r\n *\t@param\taddress:String\t(optional) if included, causes the button to open a new window when clicked, directing the page to the specified address\r\n */\r\nfunction spawnLegacyHelpButton(address) {\r\n    var twcheese_menu = document.createElement('div');\r\n    twcheese_menu.style.textAlign = 'center';\r\n\r\n    var twcheese_menu_text = document.createElement('p');\r\n    twcheese_menu_text.style.fontSize = '9pt';\r\n    twcheese_menu_text.innerHTML = spawnLegacyHelpButton_language['twcheese']['Help'];\r\n    twcheese_menu_text.style.fontWeight = '700';\r\n    twcheese_menu_text.style.marginTop = '3px';\r\n    twcheese_menu_text.style.color = '#422301';\r\n    twcheese_menu.appendChild(twcheese_menu_text);\r\n\r\n    twcheese_menu.style.background = `url(\"${ImageSrc.legacy.helpBackground}\")`;\r\n    twcheese_menu.style.height = '22px';\r\n    twcheese_menu.style.width = '49px';\r\n    twcheese_menu.style.display = 'block';\r\n    twcheese_menu.style.position = 'fixed';\r\n    twcheese_menu.style.left = '100%';\r\n    twcheese_menu.style.top = '100%';\r\n    twcheese_menu.style.marginTop = '-24px';\r\n    twcheese_menu.style.marginLeft = '-52px';\r\n    twcheese_menu.style.zIndex = '99999999999';\r\n\r\n    twcheese_menu.onmouseover = function () { this.style.background = `url(\"${ImageSrc.legacy.helpBackgroundBright}\")` };\r\n    twcheese_menu.onmouseout = function () { this.style.background = `url(\"${ImageSrc.legacy.helpBackground}\")` };\r\n\r\n    if (address) {\r\n        twcheese_menu.style.cursor = 'pointer';\r\n        twcheese_menu.onclick = function () { window.open(address, 'twcheese_menu_window') };\r\n    }\r\n    else\r\n        twcheese_menu.style.cursor = 'default';\r\n\r\n    return document.body.appendChild(twcheese_menu);\r\n}\r\n\r\n\r\n\n// CONCATENATED MODULE: ./src/Widget/AbstractWidget.js\n\r\nfunction afterDOMInsert(el, callback) {\r\n    let observer = new MutationObserver((mutations) => {\r\n        outerloop:\r\n            for (let mutation of mutations) {\r\n                for (let node of mutation.addedNodes) {\r\n                    if (node === el || node.contains(el)) {\r\n                        setTimeout(callback, 0);\r\n                        observer.disconnect();\r\n                        break outerloop;\r\n                    }\r\n                }\r\n            }\r\n    });\r\n\r\n    observer.observe(document, {\r\n        attributes: true,\r\n        childList: true,\r\n        subtree: true\r\n    });\r\n}\r\n\r\n\r\nclass AbstractWidget {\r\n\r\n    insertBefore(el) {\r\n        this._beforeInsert();\r\n        $(el).before(this.$el);\r\n        return this;\r\n    }\r\n\r\n    insertAfter(el) {\r\n        this._beforeInsert();\r\n        $(el).after(this.$el);\r\n        return this;\r\n    }\r\n\r\n    appendTo(el) {\r\n        this._beforeInsert();\r\n        $(el).append(this.$el);\r\n        return this;\r\n    }\r\n\r\n    _beforeInsert() {\r\n        if (typeof this.afterInsert !== 'function') {\r\n            return;\r\n        }\r\n        let el = this.$el[0];\r\n        afterDOMInsert(el, () => this.afterInsert());\r\n    }\r\n\r\n}\r\n\r\n\n// CONCATENATED MODULE: ./src/Widget/ReportRaiderWidget.js\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\nclass ReportRaiderWidget_ReportRaiderWidget extends AbstractWidget {\r\n    constructor(report) {\r\n        super();\r\n        this.report = report;\r\n\r\n        this.raiderTroopTypes = ['spear', 'sword', 'axe', 'archer', 'light', 'marcher', 'heavy']\r\n            .filter(troopType => troopUtil.existsOnWorld(troopType));\r\n\r\n        this.initStructure();\r\n        this.watchSelf();\r\n        this.applyUserConfig();\r\n\r\n        if (!this.mayFillRallyPoint()) {\r\n            this.$scoutsContainer.hide();\r\n        }\r\n    }\r\n\r\n    mayFillRallyPoint() {\r\n        // uk rules forbid filling units into rally point\r\n        return window.game_data.market !== 'uk';\r\n    }\r\n\r\n    initStructure() {\r\n        this.$el = $(this.createHtml().trim());\r\n        this.$raidMode = this.$el.find('#twcheese_raider_selection');\r\n        this.$haulBonus = this.$el.find('#twcheese_raider_haulBonus');\r\n        this.$period = this.$el.find('#twcheese_period');\r\n        this.$periodContainer = this.$el.find('#twcheese_periodic_options');\r\n        this.$scouts = this.$el.find('#twcheese_raider_scouts');\r\n        this.$scoutsContainer = this.$el.find('#twcheese_raider_scout');\r\n        this.$buttonSetDefault = this.$el.find('.twcheese-button-set-default');\r\n\r\n        let raiderUnitsTable = this.$el.find('#twcheese_raider_units')[0];\r\n        this.$raiderLinks = $(raiderUnitsTable.rows[0]).find('a');\r\n        this.$raiderTroopCounts = $(raiderUnitsTable.rows[1].cells);\r\n    }\r\n\r\n    createHtml() {\r\n        let report = this.report;\r\n        let travelTimes = calcTravelDurations(report.attackerVillage.distanceTo(report.defenderVillage));\r\n        let rallyPointUrl = gameUrl('place', {target: report.defenderVillage.id});\r\n\r\n        let raidModeOptions = [];\r\n        if (report.espionageLevel >= 1) { // resources were scouted\r\n            raidModeOptions.push(`<option value=\"scouted\">raid scouted resources</option>`);\r\n        }\r\n        if (report.espionageLevel >= 2) { // buildings were scouted\r\n            raidModeOptions.push(`<option value=\"predicted\">raid predicted resources</option>`);\r\n            raidModeOptions.push(`<option value=\"periodic\">periodically raid resources</option>`);\r\n        }        \r\n\r\n        let iconCells = [];\r\n        let troopCountCells = [];\r\n        let travelTimeCells = [];\r\n        for (let troopType of this.raiderTroopTypes) {\r\n            if (this.mayFillRallyPoint()) {\r\n                iconCells.push(`<td width=\"35px\"><a><img src=\"${ImageSrc.troopIcon(troopType)}\"></a></td>`);\r\n            } else {\r\n                iconCells.push(`<td width=\"35px\"><img src=\"${ImageSrc.troopIcon(troopType)}\"></td>`);\r\n            }\r\n            troopCountCells.push('<td></td>');\r\n            travelTimeCells.push(`<td>${window.Format.timeSpan(travelTimes[troopType])}</td>`);\r\n        }\r\n\r\n        return `\r\n            <table id=\"twcheese_raider_calculator\">\r\n                <tr>\r\n                    <td><span align=\"center\"><h2>Raiders</h2></span></td>\r\n                </tr>\r\n                <tr align=\"center\">\r\n                    <td>\r\n                        <select id=\"twcheese_raider_selection\">\r\n                            ${raidModeOptions.join('')}\r\n                        </select>\r\n                        <a href=\"${rallyPointUrl}\">&raquo; Send troops</a>\r\n                        <div>\r\n                            Haul Bonus: <input id=\"twcheese_raider_haulBonus\" type=\"text\" size=\"5\" value=\"0\"/>%\r\n                        </div>\r\n                        <div id=\"twcheese_periodic_options\">\r\n                            Period (hours): <input id=\"twcheese_period\" type=\"text\" size=\"4\" value=\"8\"/>\r\n                        </div>\r\n                        <button class=\"twcheese-button-set-default\">Use current selection as default</button>\r\n                    </td>\r\n                </tr>\r\n                <tr align=\"center\">\r\n                    <td>\r\n                        <table id=\"twcheese_raider_units\" class=\"vis overview_table\" style=\"border: 1px solid\">\r\n                            <tr class=\"center\">${iconCells.join('')}</tr>\r\n                            <tr class=\"center\">${troopCountCells.join('')}</tr>\r\n                            <tr class=\"center\">${travelTimeCells.join('')}</tr>\r\n                        </table>\r\n                    </td>\r\n                    <td>\r\n                        <table id=\"twcheese_raider_scout\" class=\"vis overview_table\" style=\"border: 1px solid\">\r\n                            <tr class=\"center\">\r\n                                <td width=\"35px\">\r\n                                    <img src=\"${ImageSrc.troopIcon('spy')}\" title=\"Number of scouts to send when a unit icon to the left is clicked\">\r\n                                </td>\r\n                            </tr>\r\n                            <tr class=\"center\">\r\n                                <td>\r\n                                    <input id=\"twcheese_raider_scouts\" type=\"number\" size=\"3\" value=\"0\" min=\"0\">\r\n                                </td>\r\n                            </tr>\r\n                        </table>\r\n                    </td>\r\n                </tr>\r\n            </table>\r\n        `;\r\n    }\r\n\r\n    watchSelf() {\r\n        this.$raidMode.on('change', () => {\r\n            this.updateRaiders();\r\n        });\r\n\r\n        this.$haulBonus.on('input', () => {\r\n            this.updateRaiders();\r\n        });\r\n\r\n        this.$period.on('input', () => {\r\n            this.updateRaiders();\r\n        });\r\n\r\n        this.$scouts.on('input', () => {\r\n            userConfig.set('ReportRaiderWidget.raidScouts', this.getScouts());\r\n            this.updateRaiders();\r\n        });\r\n\r\n        this.$buttonSetDefault.on('click', () => {\r\n            userConfig.set('ReportRaiderWidget.raidMode', this.getRaidMode());\r\n            userConfig.set('ReportRaiderWidget.haulBonus', this.getHaulBonus());\r\n            userConfig.set('ReportRaiderWidget.raidPeriodHours', this.getPeriod());\r\n            window.UI.SuccessMessage('Settings Saved', 2000);\r\n        });\r\n    }\r\n\r\n    applyUserConfig() {\r\n        let haulBonus = userConfig.get('ReportRaiderWidget.haulBonus', 0);\r\n        this.$haulBonus.val(haulBonus);\r\n\r\n        let period = userConfig.get('ReportRaiderWidget.raidPeriodHours', 8);\r\n        this.$period.val(period);        \r\n\r\n        let scouts = userConfig.get('ReportRaiderWidget.raidScouts', 0);\r\n        this.$scouts.val(scouts);\r\n        \r\n        let raidMode = userConfig.get('ReportRaiderWidget.raidMode', 'scouted');\r\n        this.$raidMode.val(raidMode);\r\n\r\n        this.updateRaiders();\r\n    }\r\n\r\n    updateRaiders() {\r\n        let mode = this.getRaidMode();\r\n        let haulBonus = this.getHaulBonus();\r\n        let period = this.getPeriod();\r\n        let report = this.report;\r\n\r\n        if (mode === 'scouted') {            \r\n            let raiders = report.calcRaidScouted(haulBonus);\r\n            this.setRaiders(raiders);\r\n            this.$periodContainer.hide();\r\n        }\r\n        else if (mode === 'predicted') {\r\n            let raiders = report.calcRaidPredicted(window.game_data.village, TwCheeseDate_TwCheeseDate.newServerDate(), haulBonus);\r\n            this.setRaiders(raiders);\r\n            this.$periodContainer.hide();\r\n        }\r\n        else if (mode === 'periodic') {\r\n            let raiders = report.calcRaidPeriodic(period, haulBonus);\r\n            this.setRaiders(raiders);\r\n            this.$periodContainer.show();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @param {TroopCounts} troopCounts\r\n     */\r\n    setRaiders(troopCounts) {\r\n        let spyCount = this.getScouts();\r\n        let attackUrl = (troopType, count) => {\r\n            return attackPrepUrl({spy: spyCount, [troopType]: count}, this.report.defenderVillage.id);\r\n        }\r\n\r\n        for (let [i, troopType] of Object.entries(this.raiderTroopTypes)) {\r\n            let troopCount = troopCounts[troopType];\r\n            this.$raiderTroopCounts.eq(i).text(troopCount);\r\n            if (!this.mayFillRallyPoint()) {\r\n                continue;\r\n            }\r\n            let url = attackUrl(troopType, Math.round(troopCount));\r\n            this.$raiderLinks.eq(i).attr('href', url);\r\n        }\r\n    }\r\n\r\n    getRaidMode() {\r\n        return this.$raidMode.val();\r\n    }\r\n\r\n    getHaulBonus() {\r\n        return parseFloat(this.$haulBonus.val()) || 0;\r\n    }\r\n\r\n    getPeriod() {\r\n        return parseFloat(this.$period.val()) || 0;\r\n    }\r\n\r\n    getScouts() {\r\n        return parseFloat(this.$scouts.val()) || 0;\r\n    }\r\n\r\n}\r\n\r\n\n// CONCATENATED MODULE: ./src/Widget/ReportRenamerWidget.js\n\r\n\r\n\r\n\r\n\r\n\r\nclass ReportRenamerWidget_ReportRenamerWidget extends AbstractWidget {\r\n\r\n    /**\r\n     * @param {ReportRenamer} renamer \r\n     * @param {BattleReport} report      \r\n     */\r\n    constructor(renamer, report) {\r\n        super();\r\n        this.renamer = renamer;\r\n        this.report = report;\r\n\r\n        this.initStructure();\r\n        this.watchSelf();\r\n        this.applyUserConfig();\r\n    }\r\n\r\n    initStructure() {\r\n        this.$el = $(this.createHtml().trim());\r\n        this.$note = this.$el.find('#twcheese_note');\r\n        this.$renameButton = this.$el.find('button');\r\n        this.$autoRename = this.$el.find('#twcheese_auto_rename');\r\n        this.$namePreview = this.$el.find('#twcheese_rename_preview');\r\n        this.$availableChars = this.$el.find('#twcheese_availableCharacters');\r\n    }\r\n\r\n    createHtml() {\r\n        let renamer = this.renamer;\r\n        let name = renamer.createName(this.report, '');\r\n\r\n        return `\r\n            <div id=\"twcheese_renamer\" align=\"center\">\r\n                <span align=\"center\"><h2>Renamer</h2></span>\r\n                note <input id=\"twcheese_note\" type=\"text\"/>\r\n                <button>rename</button>\r\n                <input id=\"twcheese_auto_rename\" type=\"checkbox\" />auto rename\r\n                <img id=\"twcheese_autoRenameInfo\" src=\"${ImageSrc.info}\" width=\"13\" height=\"13\" title=\"automatically rename reports when the BRE is used\" />\r\n                <br/> characters available: <span id=\"twcheese_availableCharacters\">${renamer.availableChars(name)}</span>\r\n                <br/><b>Preview: </b><span id=\"twcheese_rename_preview\">${UI_escapeHtml(name)}</span>\r\n            </div>\r\n        `;\r\n    }\r\n\r\n    watchSelf() {\r\n        let renamer = this.renamer;\r\n\r\n        this.$note.on('input', () => {\r\n            let name = renamer.createName(this.report, this.$note.val());\r\n            this.$namePreview.text(name);\r\n            this.$availableChars.text(renamer.availableChars(name));\r\n        });\r\n\r\n        this.$renameButton.on('click', () => {\r\n            this.renamer.rename(this.report, this.$note.val());\r\n        });\r\n\r\n        this.$autoRename.on('click', function() {\r\n            userConfig.set('BattleReportEnhancer.autoRename', this.checked);\r\n        });\r\n    }\r\n\r\n    applyUserConfig() {\r\n        let autoRename = userConfig.get('BattleReportEnhancer.autoRename', false);\r\n        this.$autoRename.prop('checked', autoRename);\r\n    }\r\n\r\n}\r\n\r\n\r\n\n// CONCATENATED MODULE: ./src/Widget/ReportToolsWidget.js\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\nclass ReportToolsWidget_ReportToolsWidget extends AbstractWidget {\r\n\r\n    /**\r\n     * @param {BattleReport} report \r\n     * @param {ReportRenamer} renamer \r\n     */\r\n    constructor(report, renamer) {\r\n        super();\r\n        this.report = report;\r\n        this.renamer = renamer;\r\n        this.initStructure();\r\n        this.watchSelf();\r\n        this.applyUserConfig();\r\n        this.initChildWidgets();\r\n    }\r\n\r\n    initStructure() {\r\n        this.$el = $(this.createHtml().trim());\r\n        this.$content = this.$el.find('.widget_content');\r\n        this.$toggleIcon = this.$el.find('.twcheese-toggle-icon');\r\n        this.$raiderContainer = this.$el.find('.twcheese-raider-container');\r\n        this.$renamerContainer = this.$el.find('.twcheese-renamer-container');\r\n    }\r\n\r\n    createHtml() {\r\n        return `\r\n            <div id=\"twcheese_show_report_tools\" class=\"vis widget\">\r\n                <h4>\r\n                    Report Tools\r\n                    <img class=\"twcheese-toggle-icon\" src=\"${ImageSrc.plus}\" style=\"float:right; cursor:pointer;\">\r\n                </h4>\r\n                <div class=\"widget_content\" style=\"display: none\">\r\n                    <table id=\"twcheese_BRE_tools\" border=\"1\">\r\n                        <tr>\r\n                            <td class=\"twcheese-raider-container\" valign=\"top\"></td>\r\n                            <td valign=\"top\">\r\n                                ${this.createDemolitionTableHtml()}\r\n                            </td>\r\n                        </tr>\r\n                        <tr>\r\n                            <td class=\"twcheese-renamer-container\" colspan=\"2\" valign=\"top\"></td>\r\n                        </tr>\r\n                    </table>\r\n                </div>\r\n            </div>\r\n        `;\r\n    }\r\n\r\n    createDemolitionTableHtml() {\r\n        let report = this.report;\r\n        if (!report.buildingLevels) {\r\n            return '';\r\n        }\r\n\r\n        if (report.buildingLevels) {\r\n            let catHeaders = [];\r\n            let ramHeaders = [];\r\n            let catRowOne = [];\r\n            let catRowTwo = [];\r\n            let ramRowOne = [];\r\n            let ramRowTwo = [];\r\n\r\n            let suggestedCounts = report.suggestSiegeUnits();\r\n\r\n            for (let buildingType of buildingUtil.buildingTypesOnWorld()) {\r\n                let siegeWeapon = (buildingType === 'wall') ? 'ram' : 'catapult';\r\n\r\n                let headerInnerHtml;\r\n                if (game_data.market == 'uk') {\r\n                    headerInnerHtml = '<img src=\"' + ImageSrc.buildingIcon(buildingType) + '\" />';\r\n                } else {\r\n                    let troopCounts = {[siegeWeapon]: suggestedCounts.oneShotUpgraded[buildingType]};\r\n                    let rallyPointUrl = attackPrepUrl(troopCounts, report.defenderVillage.id);\r\n                    headerInnerHtml = '<a href=\"' + rallyPointUrl + '\"><img src=\"' + ImageSrc.buildingIcon(buildingType) + '\" /></a>';\r\n                }\r\n                let headers = (siegeWeapon === 'ram') ? ramHeaders : catHeaders;\r\n                headers.push(`<td style=\"width: 35px;\">${headerInnerHtml}</td>`);\r\n\r\n                let rowOne = (siegeWeapon === 'ram') ? ramRowOne : catRowOne;\r\n                let rowTwo = (siegeWeapon === 'ram') ? ramRowTwo : catRowTwo;\r\n                rowOne.push(`<td>${suggestedCounts.oneShotScouted[buildingType]}</td>`);\r\n                rowTwo.push(`<td>${suggestedCounts.oneShotUpgraded[buildingType]}</td>`);\r\n            }\r\n\r\n            let demolitionHtml = `\r\n                <table id=\"twcheese_demolition_calculator\">\r\n                    <tr>\r\n                        <td><span align=\"center\"><h2>Demolition</h2></span></td>\r\n                    </tr>\r\n                    <tr>\r\n                        <td>\r\n                            <table id=\"twcheese_demolition_units\" class=\"vis overview_table\" style=\"border: 1px solid;\">\r\n                                <tr class=\"center\">\r\n                                    <td colspan=\"${catHeaders.length}\">\r\n                                        <img src=\"${ImageSrc.troopIcon('catapult')}\" alt=\"catapults\" />\r\n                                    </td>\r\n                                    <td colspan=\"${ramHeaders.length}\">\r\n                                        <img src=\"${ImageSrc.troopIcon('ram')}\" alt=\"rams\" />\r\n                                    </td>\r\n                                </tr>\r\n                                <tr class=\"center\">${catHeaders.join('') + ramHeaders.join('')}</tr>\r\n                                <tr class=\"center\">${catRowOne.join('') + ramRowOne.join('')}</tr>\r\n                                <tr class=\"center\">${catRowTwo.join('') + ramRowTwo.join('')}<tr/>\r\n                            </table>\r\n                        </td>\r\n                    </tr>\r\n                </table>\r\n            `;\r\n\r\n            return demolitionHtml.trim();\r\n        }\r\n    }\r\n\r\n    watchSelf() {\r\n        this.$toggleIcon.on('click', () => {\r\n            this.toggleCollapsed();\r\n        });\r\n    }\r\n\r\n    applyUserConfig() {\r\n        if (!userConfig.get('ReportToolsWidget.collapse', false)) {\r\n            this.toggleCollapsed();\r\n        }\r\n    }\r\n\r\n    toggleCollapsed() {\r\n        this.$content.toggle({\r\n            duration: 200,\r\n            start: () => {\r\n                let willCollapse = this.$toggleIcon.attr('src').includes(ImageSrc.minus);\r\n                this.$toggleIcon.attr('src', willCollapse ? ImageSrc.plus : ImageSrc.minus);\r\n                userConfig.set('ReportToolsWidget.collapse', willCollapse);\r\n            }\r\n        });\r\n    }\r\n\r\n    initChildWidgets() {\r\n        (new ReportRenamerWidget_ReportRenamerWidget(this.renamer, this.report))\r\n            .appendTo(this.$renamerContainer);\r\n\r\n        (new ReportRaiderWidget_ReportRaiderWidget(this.report))\r\n            .appendTo(this.$raiderContainer);\r\n    }\r\n\r\n}\r\n\r\n\r\n\n// CONCATENATED MODULE: ./src/Widget/ReportsFolder/columnCategories.js\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\nvar columnCategories_language = { \"twcheese\": {} };\r\nswitch (game_data.market) {\r\n    default:\r\n        /*==== tribalwars.net, tribalwars.us, tribalwars.co.uk, beta.tribalwars.net ====*/\r\n        columnCategories_language['twcheese']['Building'] = 'Building';\r\n        break;\r\n\r\n    case 'cz':\r\n        /*==== divokekmeny.cz/ ====*/\r\n        columnCategories_language['twcheese']['Building'] = 'budově';\r\n        break;\r\n\r\n    case 'se':\r\n        columnCategories_language['twcheese']['Building'] = 'Byggnad';\r\n        break;\r\n\r\n    /*==== fyletikesmaxes.gr/ ====*/\r\n    case 'gr':\r\n        columnCategories_language['twcheese']['Building'] = 'Κτίριο';\r\n        break;\r\n\r\n    /* Norwegian */\r\n    case 'no':\r\n        columnCategories_language['twcheese']['Building'] = 'Bygning';\r\n        break;\r\n                        \r\n}\r\n\r\n\r\nfunction centeredImg(src, tooltip = '') {\r\n    return `<img style=\"display:block; margin-left:auto; margin-right:auto\" src=\"${src}\" title=\"${tooltip}\">`;\r\n}\r\n\r\n\r\nfunction villageLink(village) {\r\n    let url = gameUrl('info_village', {id: village.id});\r\n    return `<a href=\"${url}\">${village.x}|${village.y}</a>`;\r\n}\r\n\r\n\r\nclass ColumnCategories extends Map {\r\n\r\n    getHideableCategories() {\r\n        return this.toArray().filter(category => category.hideable);\r\n    }\r\n\r\n    toArray() {\r\n        return [...this.values()];\r\n    }\r\n}\r\n\r\n\r\nlet columnCategories_cfg = [\r\n    {\r\n        key: 'essential',\r\n        hideable: false,\r\n        cols: [{\r\n            width: 120,\r\n            header: '',\r\n            createCellHtml(report) {\r\n                let icons = [`<img src=\"${ImageSrc.dotIcon(report.dotColor)}\">`];\r\n                if (report.haulStatus !== BattleReportCondensed_BattleReportCondensed.HAUL_STATUS_UNKNOWN) {\r\n                    icons.push(`<img src=\"${report.haulStatusIconSrc()}\">`);\r\n                }\r\n                if (report.isForwarded) {\r\n                    icons.push('<img src=\"graphic/forwarded.png?1\">');\r\n                }\r\n                let html = `<input name=\"id_${report.reportId}\" type=\"checkbox\"> ${icons.join(' ')}\r\n                    <a href=\"${gameUrl('report', {mode:game_data.mode, view:report.reportId})}\"> view</a>\r\n                `;\r\n                if (report.defenderName && report.defenderVillage) {\r\n                    let isDefenderMe = report.defenderName == game_data.player.name;\r\n                    let wasVillageConquered = report.loyalty && report.loyalty.after <= 0;\r\n                    if (isDefenderMe || wasVillageConquered) {\r\n                        html += `<a href=\"${gameUrl('place', {mode:'units', village:report.defenderVillage.id})}\">\r\n                            <img title=\"manage troops\" style=\"float:right; cursor:pointer;\" src=\"${ImageSrc.buildingIcon('place')}\" />\r\n                        </a>`;\r\n                    }\r\n                }\r\n                return html;\r\n            }\r\n        }]\r\n    },\r\n\r\n    {\r\n        key: 'attackIcons',\r\n        hideable: true,\r\n        description: 'Attack icons',\r\n        cols: [{\r\n            width: 50,\r\n            header: '',\r\n            createCellHtml: (report) => {\r\n                return report.attackIcons.getIcons().map(icon => {\r\n                    return `<img title=\"${escapeHtml(icon.description)}\" src=\"${icon.src}\">`\r\n                }).join(' ');\r\n            }\r\n        }]\r\n    },\r\n\r\n    {\r\n        key: 'distance',\r\n        hideable: true,\r\n        description: 'Distance',\r\n        cols: [{\r\n            width: 60,\r\n            header: 'Distance',\r\n            createCellHtml: (report) => report.defenderDistance(game_data.village)\r\n        }]\r\n    },\r\n\r\n    {\r\n        key: 'repeatLinks',\r\n        hideable: true,\r\n        description: 'Links to repeat attack',\r\n        cols: [{\r\n            width: 50,\r\n            header: 'Repeat',\r\n            createCellHtml(report) {\r\n                if (report.attackerName !== game_data.player.name) {\r\n                    return '';\r\n                }\r\n                let url = gameUrl('place', {try: 'confirm', type: 'same', report_id: report.reportId});\r\n                let html = `<a title=\"repeat attack, from current village\" href=\"${url}\"><img src=\"${ImageSrc.attack}\"></a>`;\r\n                if (report.attackerVillage && report.attackerVillage.id) {\r\n                    let url = gameUrl('place', {try: 'confirm', type: 'same', report_id: report.reportId, village: report.attackerVillage.id});\r\n                    html += ` | <a title=\"repeat attack, from original village\" href=\"${url}\"><img src=\"${ImageSrc.attack}\"></a>`;\r\n                }\r\n                return html;\r\n            }\r\n        }]\r\n    },\r\n    \r\n    {\r\n        key: 'fullSubject',\r\n        hideable: true,\r\n        startHidden: true,\r\n        description: 'Full subject',\r\n        cols: [{\r\n            width: 400,\r\n            header: 'Subject',\r\n            createCellHtml: (report) => report.subject\r\n        }]\r\n    },\r\n    {\r\n        key: 'note',\r\n        hideable: true,\r\n        startHidden: true,\r\n        description: 'Note',\r\n        cols: [{\r\n            width: 200,\r\n            header: 'Note',\r\n            createCellHtml: (report) => report.note || ''\r\n        }]\r\n    },\r\n    {\r\n        key: 'attackerName',\r\n        hideable: true,\r\n        description: 'Attacker',\r\n        cols: [{\r\n            width: 150,\r\n            header: 'Attacker',\r\n            createCellHtml: (report) => report.attackerName || ''\r\n        }]\r\n    },\r\n    {\r\n        key: 'defenderName',\r\n        hideable: true,\r\n        description: 'Defender',\r\n        cols: [{\r\n            width: 150,\r\n            header: 'Defender',\r\n            createCellHtml: (report) => report.defenderName || ''\r\n        }]\r\n    },\r\n    {\r\n        key: 'attackerVillage',\r\n        hideable: true,\r\n        description: `Attacker's village`,\r\n        cols: [{\r\n            width: 70,\r\n            header: 'Origin',\r\n            createCellHtml(report) {\r\n                if (!report.attackerVillage) {\r\n                    return '';\r\n                }\r\n                return villageLink(report.attackerVillage);\r\n            }\r\n        }]\r\n    },\r\n    {\r\n        key: 'defenderVillage',\r\n        hideable: true,\r\n        description: `Defender's village`,\r\n        cols: [{\r\n            width: 70,\r\n            header: 'Target',\r\n            createCellHtml(report) {\r\n                if (!report.defenderVillage) {\r\n                    return '';\r\n                }\r\n                return villageLink(report.defenderVillage);\r\n            }\r\n        }]\r\n    },\r\n    {\r\n        key: 'feint',\r\n        hideable: true,\r\n        description: 'Feint',\r\n        cols: [{\r\n            width: 50,\r\n            header: 'Feint',\r\n            createCellHtml(report) {\r\n                if (report.wasAttackFeint) {\r\n                    return centeredImg('graphic/dots/grey.png?1', 'The attack contained only a small amount of units');\r\n                }\r\n                return '';\r\n            }\r\n        }]\r\n    },\r\n    {\r\n        key: 'deadNoble',\r\n        hideable: true,\r\n        description: 'Attacking noble died',\r\n        cols: [{\r\n            width: 50,\r\n            header: 'Noble',\r\n            createCellHtml(report) {\r\n                if (!report.attackerNobleDied) {\r\n                    return '';\r\n                }\r\n                let img = centeredImg(ImageSrc.troopIcon('priest'), 'An attacking nobleman died.');\r\n                if (report.attackerVillage && report.attackerName === game_data.player.name) {\r\n                    let url = gameUrl('snob', {village: report.attackerVillage.id});\r\n                    return `<a href=\"${url}\">${img}</a>`;\r\n                }\r\n                return img;\r\n            }\r\n        }]\r\n    },\r\n    {\r\n        key: 'loyalty',\r\n        hideable: true,\r\n        description: 'Loyalty reported',\r\n        cols: [{\r\n            width: 50,\r\n            header: 'Loyalty',\r\n            createCellHtml(report) {\r\n                if (report.loyalty) {\r\n                    return '<span class=\"icon ally lead\" title=\"Loyalty change\"></span> ' + report.loyalty.after;\r\n                }\r\n                return '';\r\n            }\r\n        }]\r\n    },\r\n    {\r\n        key: 'defenderSurvivors',\r\n        hideable: true,\r\n        description: 'Troops: Defense remaining',\r\n        title: 'Defense remaining',\r\n        cols: troopUtil.troopTypesOnWorld().map(troopType => {\r\n            return {\r\n                width: 20,\r\n                align: 'center',\r\n                header: centeredImg(ImageSrc.troopIcon(troopType)),\r\n                createCellHtml(report) {\r\n                    if (!report.defenderSurvivors) {\r\n                        return '';\r\n                    }\r\n                    let survivorCount = report.defenderSurvivors[troopType];\r\n                    return survivorCount;\r\n                },\r\n                cssClass(report) {\r\n                    if (!report.defenderSurvivors) {\r\n                        return '';\r\n                    }\r\n                    let survivorCount = report.defenderSurvivors[troopType];\r\n                    return (survivorCount === 0) ? 'unit-item hidden' : '';\r\n                }\r\n            };\r\n        })\r\n    },\r\n\r\n    ...buildingUtil.buildingTypesOnWorld().map(function(buildingType) {\r\n        return {\r\n            key: 'buildingLevels.' + buildingType,\r\n            hideable: true,\r\n            description: columnCategories_language['twcheese']['Building'] + ': ' + textScraper.t(`buildings.${buildingType}`),\r\n            cols: [{\r\n                width: 20,\r\n                align: 'center',\r\n                header: centeredImg(ImageSrc.buildingIcon(buildingType)),\r\n                createCellHtml(report) {\r\n                    if (!report.buildingLevels) {\r\n                        return '';\r\n                    }\r\n                    let level = report.buildingLevels[buildingType];\r\n                    if (level === '?') {\r\n                        return '';\r\n                    }\r\n                    return level;\r\n                },\r\n                cssClass(report) {\r\n                    if (!report.buildingLevels) {\r\n                        return '';\r\n                    }\r\n                    let level = report.buildingLevels[buildingType];\r\n                    return ['?', 0].includes(level) ? 'hidden' : '';\r\n                }\r\n            }]\r\n        };\r\n    }),\r\n\r\n    ...Resources_Resources.TYPES.map(function(resType) {\r\n        let resName = {wood:'Timber', stone:'Clay', iron:'Iron'}[resType];\r\n        return {\r\n            key: `resources.${resType}`,\r\n            hideable: true,\r\n            description: `Resources: ${resName}`,\r\n            cols: [{\r\n                width: 16,\r\n                align: 'center',\r\n                header: centeredImg(ImageSrc[resType]),\r\n                createCellHtml(report) {\r\n                    if (!report.resources) {\r\n                        return '';                        \r\n                    }\r\n                    return window.Format.number(report.resources[resType].amount);\r\n                },\r\n                cssClass(report) {\r\n                    if (!report.resources) {\r\n                        return '';                        \r\n                    }\r\n                    return (report.resources[resType].amount === 0) ? 'hidden' : '';\r\n                }\r\n            }]\r\n        };\r\n    }),\r\n\r\n    {\r\n        key: 'resources.sum',\r\n        hideable: true,\r\n        description: 'Resources: Total',\r\n        cols: [{\r\n            width: 40,\r\n            align: 'center',\r\n            header: 'Total',\r\n            createCellHtml(report) {\r\n                if (!report.resources) {\r\n                    return '';                        \r\n                }\r\n                return window.Format.number(report.resources.sum());\r\n            },\r\n            cssClass(report) {\r\n                if (!report.resources) {\r\n                    return '';                        \r\n                }\r\n                return (report.resources.sum() === 0) ? 'hidden' : '';\r\n            }\r\n        }]\r\n    },\r\n    {\r\n        key: 'timelaunched',\r\n        hideable: true,\r\n        description: 'Time: Attack launched',\r\n        cols: [{\r\n            width: 170,\r\n            header: 'Launched',\r\n            createCellHtml(report) {\r\n                if (!report.timeLaunched) {\r\n                    return '';\r\n                }\r\n                return report.timeLaunched.toHtml(false);\r\n            }\r\n        }]\r\n    },\r\n    {\r\n        key: 'strTimeReceived',\r\n        hideable: true,\r\n        description: 'Time: Report received',\r\n        cols: [{\r\n            width: 140,\r\n            header: 'Received',\r\n            createCellHtml: (report) => report.strTimeReceived || ''\r\n        }]\r\n    }\r\n];\r\n\r\nlet columnCategories = new ColumnCategories();\r\nfor (let category of columnCategories_cfg) {\r\n    columnCategories.set(category.key, category);\r\n}\r\n\r\n\n// CONCATENATED MODULE: ./src/Widget/ReportsFolder/ReportListWidget.js\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\nfunction cellAtIndex(row, i) {\r\n    let endIndex = -1;\r\n    for (let cell of row.cells) {\r\n        let initialColSpan = cell.initialColSpan || cell.colSpan;\r\n        endIndex += initialColSpan;\r\n        if (endIndex >= i) {\r\n            return cell;\r\n        }\r\n    }\r\n}\r\n\r\n\r\nclass ReportListWidget_ReportListWidget extends AbstractWidget {\r\n    /**\r\n     * @param {Map.<number, BattleReportCondensed>} reports \r\n     */\r\n    constructor(reports) {\r\n        super();\r\n        this.reports = reports;\r\n        this.columnIndexes = new Map();\r\n\r\n        this.initStructure();\r\n        this.$el.resizable();\r\n        this.watchSelf();\r\n    }\r\n\r\n    initStructure() {\r\n        var reportsFolderDisplay = document.createElement('div');\r\n        reportsFolderDisplay.id = 'twcheese_reportsFolderDisplay';\r\n        reportsFolderDisplay.style.overflow = 'hidden';\r\n        reportsFolderDisplay.style.position = 'relative';\r\n        reportsFolderDisplay.style.width = '646px';\r\n        reportsFolderDisplay.style.height = '400px';\r\n        reportsFolderDisplay.style.minHeight = '100px';\r\n        reportsFolderDisplay.style.minWidth = '100px';        \r\n\r\n        /*==== reports table header ====*/\r\n        var reportsTableHeaderDiv = document.createElement('div');\r\n        reportsFolderDisplay.appendChild(reportsTableHeaderDiv);\r\n        reportsTableHeaderDiv.style.overflow = 'hidden';\r\n\r\n        var reportsTableHeader = document.createElement('table');\r\n        reportsTableHeaderDiv.appendChild(reportsTableHeader);\r\n        reportsTableHeader.style.tableLayout = 'fixed';\r\n        reportsTableHeader.style.width = '2370px';\r\n        reportsTableHeader.id = 'twcheese_reportsTable_header';\r\n\r\n        /*==== create headers ====*/\r\n        reportsTableHeader.insertRow(-1);\r\n        reportsTableHeader.insertRow(-1);\r\n        reportsTableHeader.insertRow(-1);\r\n\r\n        let cellIndex = 0;\r\n        for (let category of columnCategories.values()) {\r\n            let titleTh = document.createElement('th');\r\n            titleTh.innerHTML = category.title || '';\r\n            titleTh.initialColSpan = category.cols.length;\r\n            titleTh.colSpan = category.cols.length;\r\n            reportsTableHeader.rows[1].appendChild(titleTh);\r\n\r\n            let widthSum = 0;\r\n            let colIndexes = [];\r\n            for (let col of category.cols) {\r\n                let alignmentTh = document.createElement('th');\r\n                alignmentTh.style.width = col.width + 'px';\r\n                alignmentTh.style.paddingTop = 0;\r\n                alignmentTh.style.paddingBottom = 0;\r\n                reportsTableHeader.rows[0].appendChild(alignmentTh);\r\n\r\n                let lowerTh = document.createElement('th');\r\n                lowerTh.innerHTML = col.header;\r\n                reportsTableHeader.rows[2].appendChild(lowerTh);\r\n\r\n                widthSum += col.width;\r\n                colIndexes.push(cellIndex);\r\n                cellIndex++;\r\n            }\r\n            let borderSpacing = 2 * (category.cols.length - 1);\r\n            titleTh.style.width = (widthSum + borderSpacing) + 'px';\r\n            this.columnIndexes.set(category.key, colIndexes);\r\n        }\r\n\r\n        /*==== reports table body ====*/\r\n        var reportsTableBodyDiv = document.createElement('div');\r\n        reportsFolderDisplay.appendChild(reportsTableBodyDiv);\r\n        reportsTableBodyDiv.style.overflow = 'hidden';\r\n        reportsTableBodyDiv.style.height = Number(400 - 20 - reportsTableHeaderDiv.clientHeight) + 'px';\r\n        reportsTableBodyDiv.style.width = '646px';\r\n        reportsTableBodyDiv.id = 'twcheese_reportsTable';\r\n\r\n\r\n        var reportsTableBody = document.createElement('table');\r\n        reportsTableBodyDiv.appendChild(reportsTableBody);\r\n        reportsTableBody.style.tableLayout = 'fixed';\r\n        reportsTableBody.style.width = '2370px';\r\n        reportsTableBody.id = 'twcheese_reportsTable_body';\r\n        reportsTableBody.className = 'vis';\r\n\r\n        /*==== create first row to match widths to header table ====*/\r\n        reportsTableBody.insertRow(-1);\r\n        for (let alignmentTh of reportsTableHeader.rows[0].cells) {\r\n            let alignmentCell = reportsTableBody.rows[0].insertCell(-1);\r\n            alignmentCell.style.width = alignmentTh.style.width;\r\n            alignmentCell.style.paddingTop = 0;\r\n            alignmentCell.style.paddingBottom = 0;\r\n        }\r\n\r\n        /*==== y scroll panel====*/\r\n        var yScrollPanel = document.createElement('div');\r\n        yScrollPanel.id = 'twcheese_reportsDisplay_yScrollPanel';\r\n        reportsFolderDisplay.appendChild(yScrollPanel);\r\n        yScrollPanel.style.overflowY = 'scroll';\r\n        yScrollPanel.style.overflowX = 'hidden';\r\n        yScrollPanel.style.background = 'transparent';\r\n        yScrollPanel.style.position = 'absolute';\r\n        yScrollPanel.style.right = 0;\r\n        yScrollPanel.style.scrollbarWidth = 'thin';\r\n\r\n        /*==== y table emulator ====*/\r\n        var yTableEmulator = document.createElement('div');\r\n        yTableEmulator.id = 'twcheese_reportsDisplay_y-table-emulator';\r\n        yScrollPanel.appendChild(yTableEmulator);\r\n        yTableEmulator.style.overflow = 'hidden';\r\n        yTableEmulator.style.position = 'relative';\r\n        yTableEmulator.innerHTML = '&nbsp;';\r\n\r\n        /*==== x scroll panel ====*/\r\n        var xScrollPanel = document.createElement('div');\r\n        xScrollPanel.id = 'twcheese_reportsDisplay_xScrollPanel';\r\n        reportsFolderDisplay.appendChild(xScrollPanel);\r\n        xScrollPanel.style.height = '40px';\r\n        xScrollPanel.style.width = `calc(100% - 18px)`;\r\n        xScrollPanel.style.marginTop = '-23px';\r\n        xScrollPanel.style.overflowX = 'scroll';\r\n        xScrollPanel.style.overflowY = 'hidden';\r\n        xScrollPanel.style.marginTop = 'expression(\\'0px\\')';// IE 7 fix\r\n        xScrollPanel.style.height = 'expression(\\'17px\\')'; // IE 7 fix\r\n\r\n        /*==== x table emulator ====*/\r\n        var xTableEmulator = document.createElement('div');\r\n        xTableEmulator.id = 'twcheese_reportsDisplay_x-table-emulator';\r\n        xScrollPanel.appendChild(xTableEmulator);\r\n        xTableEmulator.style.width = reportsTableHeader.clientWidth + 'px';\r\n        xTableEmulator.innerHTML = '&nbsp;';\r\n        \r\n        this.$el = $(reportsFolderDisplay);\r\n        this.$head = this.$el.find('#twcheese_reportsTable_header');\r\n        this.$body = this.$el.find('#twcheese_reportsTable_body');\r\n        this.$bodyPane = this.$el.find('#twcheese_reportsTable');\r\n        this.$xBodyEmulator = this.$el.find('#twcheese_reportsDisplay_x-table-emulator');\r\n        this.$yBodyEmulator = this.$el.find('#twcheese_reportsDisplay_y-table-emulator');\r\n        this.$xScrollPanel = this.$el.find('#twcheese_reportsDisplay_xScrollPanel');\r\n        this.$yScrollPanel = this.$el.find('#twcheese_reportsDisplay_yScrollPanel');\r\n    }\r\n\r\n\r\n    afterInsert() {\r\n        let $headContainer = this.$head.parent();\r\n        this.$yScrollPanel.css({\r\n            top: $headContainer.outerHeight() + 2\r\n        });\r\n        this.populateReportsTable();\r\n        this.applySettings();\r\n    }\r\n\r\n\r\n    watchSelf() {\r\n        this.$el.on('resize', (e) => {\r\n            this.fitDisplayComponents();\r\n            userConfig.set('ReportListWidget.size.width', this.$el.width());\r\n            userConfig.set('ReportListWidget.size.height', this.$el.height());\r\n        });\r\n\r\n        this.$bodyPane.on('scroll', (e) => {\r\n            this.$xScrollPanel.scrollTop(this.$bodyPane.scrollTop());\r\n        });\r\n\r\n        this.$yScrollPanel.on('scroll', (e) => {\r\n            this.$bodyPane.scrollTop(this.$yScrollPanel.scrollTop());\r\n        });\r\n\r\n        this.$xScrollPanel.on('scroll', (e) => {\r\n            this.$bodyPane.scrollLeft(this.$xScrollPanel.scrollLeft());\r\n            this.$head.parent().scrollLeft(this.$xScrollPanel.scrollLeft());\r\n        });\r\n\r\n        this.$bodyPane.on('wheel', (e) => {\r\n            e.preventDefault();\r\n            let deltaY = 90 * Math.sign(e.originalEvent.deltaY);\r\n            \r\n            let timeStart = performance.now();\r\n            let animDurationMs = 250;\r\n            let y = 0;\r\n\r\n            let scrollStep = () => {\r\n                let msElapsed = performance.now() - timeStart;\r\n                let targetY = deltaY * Math.min(1, msElapsed / animDurationMs);\r\n                let stepY = targetY - y;\r\n\r\n                y += stepY;\r\n                this.$yScrollPanel[0].scrollTop += stepY;\r\n                this.$bodyPane[0].scrollTop += stepY;\r\n\r\n                if (msElapsed < animDurationMs) {\r\n                    window.requestAnimationFrame(scrollStep);\r\n                }\r\n            }\r\n            window.requestAnimationFrame(scrollStep);\r\n        });\r\n    }\r\n\r\n\r\n    /**\r\n     * fills body with information\r\n     */\r\n    populateReportsTable() {\r\n        let minimal = new Set(['essential', 'attackIcons', 'repeatLinks', 'distance', 'fullSubject', 'strTimeReceived']);\r\n\r\n        let fallbackSubjectColSpan = columnCategories.toArray().reduce(function(acc, category) {\r\n            if (category.key !== 'fullSubject' && minimal.has(category.key)) {\r\n                return acc;\r\n            }\r\n            return acc + category.cols.length;\r\n        }, 0);\r\n\r\n        for (let report of this.reports.values()) {\r\n            let row = this.$body[0].insertRow(-1);\r\n            row.twcheeseReport = report;\r\n            let hasDecentInfo = report.attackerName && report.defenderName && report.attackerVillage && report.defenderVillage;\r\n\r\n            for (let category of columnCategories.values()) {\r\n                if (!hasDecentInfo && !minimal.has(category.key)) {\r\n                    continue;\r\n                }\r\n                for (let col of category.cols) {\r\n                    let cell = row.insertCell(-1);\r\n                    cell.innerHTML = col.createCellHtml(report);\r\n                    if (typeof col.align === 'string') {\r\n                        cell.style.textAlign = col.align;\r\n                    }\r\n                    if (typeof col.cssClass === 'function') {\r\n                        cell.className = col.cssClass(report);\r\n                    }\r\n                    if (!hasDecentInfo && category.key === 'fullSubject') {\r\n                        cell.initialColSpan = fallbackSubjectColSpan;\r\n                        cell.colSpan = cell.initialColSpan;\r\n                    }                    \r\n                }                \r\n            }\r\n        }\r\n        \r\n        this.alignForTroops();\r\n        this.alignForResources();\r\n        this.adjustScrollbars();\r\n    }\r\n\r\n\r\n    /**\r\n     * hides columns and resizes to user's preferences\r\n     */\r\n    applySettings() {\r\n        for (let category of columnCategories.values()) {\r\n            if (!userConfig.get(`ReportListWidget.showCols.${category.key}`, !category.startHidden)) {\r\n                this.hideColumns(category.key);\r\n            }\r\n        }\r\n\r\n        this.$el.css({\r\n            width: userConfig.get('ReportListWidget.size.width', '720px'),\r\n            height: userConfig.get('ReportListWidget.size.height', '250px')\r\n        });\r\n                \r\n        this.fitDisplayComponents();\r\n        this.adjustScrollbars();\r\n    }\r\n\r\n\r\n    adjustScrollbars() {\r\n        this.$xBodyEmulator.width(this.$body.width());\r\n        this.$yBodyEmulator.height(this.$body.height());\r\n    }\r\n\r\n\r\n    toggleReportsColumns(settingName) {\r\n        let startHidden = columnCategories.get(settingName).startHidden;\r\n        let configKey = `ReportListWidget.showCols.${settingName}`;\r\n        let show = !userConfig.get(configKey, !startHidden);\r\n        userConfig.set(configKey, show);\r\n\r\n        for (let i of this.columnIndexes.get(settingName)) {\r\n            if (show) {\r\n                this.showColumn(i);\r\n            } else {\r\n                this.hideColumn(i);\r\n            }\r\n        }\r\n        this.adjustScrollbars();\r\n    }\r\n\r\n\r\n    hideColumns(settingName) {\r\n        for (let i of this.columnIndexes.get(settingName)) {\r\n            this.hideColumn(i);\r\n        }\r\n    }\r\n\r\n\r\n    showColumn(column) {\r\n        var body = this.$body[0];\r\n        var head = this.$head[0];\r\n\r\n        var tableWidth = head.style.width.split('px')[0];        \r\n\r\n        /*==== header ====*/\r\n        let alignmentTh = cellAtIndex(head.rows[0], column);\r\n        let columnWidth = alignmentTh.style.width.split('px')[0];\r\n        tableWidth = parseFloat(tableWidth) + parseFloat(columnWidth);\r\n        head.style.width = tableWidth + 'px';\r\n\r\n        alignmentTh.style.display = \"table-cell\";\r\n        cellAtIndex(head.rows[1], column).style.display = \"table-cell\";\r\n        head.rows[2].cells[column].style.display = \"table-cell\";\r\n\r\n        /*==== body ====*/\r\n        body.style.width = tableWidth + 'px';\r\n        for (let row of body.rows) {\r\n            let cell = cellAtIndex(row, column);\r\n\r\n            if (cell.initialColSpan && cell.initialColSpan > 1) {\r\n                cell.colSpan += 1;\r\n            } else {\r\n                cell.style.display = 'table-cell';\r\n            }\r\n        }\r\n    }\r\n\r\n\r\n    hideColumn(column) {\r\n        var body = this.$body[0];\r\n        var head = this.$head[0];\r\n\r\n        var tableWidth = head.style.width.split('px')[0];\r\n\r\n        /*==== header ====*/\r\n        let alignmentTh = cellAtIndex(head.rows[0], column);\r\n        let columnWidth = alignmentTh.style.width.split('px')[0];\r\n        tableWidth = parseFloat(tableWidth) - parseFloat(columnWidth);\r\n        head.style.width = tableWidth + 'px';\r\n\r\n        alignmentTh.style.display = \"none\";\r\n        cellAtIndex(head.rows[1], column).style.display = \"none\";\r\n        head.rows[2].cells[column].style.display = \"none\";\r\n\r\n        /*==== body ====*/\r\n        body.style.width = tableWidth + 'px';\r\n        for (let row of body.rows) {\r\n            let cell = cellAtIndex(row, column);\r\n\r\n            if (cell.initialColSpan && cell.initialColSpan > 1) {\r\n                cell.colSpan -= 1;\r\n            } else {\r\n                cell.style.display = 'none';\r\n            }\r\n        }\r\n    }\r\n\r\n\r\n    getSelectedReportIds() {\r\n        return this.$body.find('input:checked')\r\n            .toArray()\r\n            .map(el => parseInt(el.name.match(/\\d+/)[0]));\r\n    }\r\n\r\n    refreshContents() {\r\n        this.$body.find('tr:not(:first)').remove();    \r\n        this.populateReportsTable();\r\n        this.applySettings();    \r\n    }\r\n\r\n    /**\r\n     * sets display components styles to fill the display zone and ensure scrolling functionality\r\n     */\r\n    fitDisplayComponents() {\r\n        let bodyPaneHeight = this.$el.height() - 67;\r\n\r\n        this.$bodyPane.css({\r\n            width: this.$el.width(),\r\n            height: bodyPaneHeight\r\n        });\r\n        \r\n        this.$yScrollPanel.css({height: bodyPaneHeight});\r\n    }\r\n\r\n\r\n    /**\r\n     * adjust widths for troop counts\r\n     */\r\n    alignForTroops() {\r\n        let colIndexes = this.columnIndexes.get('defenderSurvivors');\r\n\r\n        let maxChars = Array(colIndexes.length).fill(2);\r\n\r\n        for (let r = 1; r < this.$body[0].rows.length; r++) {\r\n            let row = this.$body[0].rows[r];\r\n            if (!row.twcheeseReport.defenderSurvivors) {\r\n                continue;\r\n            }\r\n            for (let [i, col] of Object.entries(colIndexes)) {\r\n                let chars = String(row.cells[col].innerHTML).length;\r\n                maxChars[i] = Math.max(chars, maxChars[i]);\r\n            }\r\n        }\r\n\r\n        this.alignCols(colIndexes, maxChars);\r\n    }\r\n\r\n\r\n    /**\r\n     * adjust widths for resources\r\n     */\r\n    alignForResources() {\r\n        let colIndexes = [\r\n            ...this.columnIndexes.get('resources.wood'),\r\n            ...this.columnIndexes.get('resources.stone'),\r\n            ...this.columnIndexes.get('resources.iron'),\r\n            ...this.columnIndexes.get('resources.sum'),\r\n        ];\r\n\r\n        let maxChars = [2, 2, 2, 2];\r\n\r\n        for (let r = 1; r < this.$body[0].rows.length; r++) {\r\n            let row = this.$body[0].rows[r];\r\n            if (!row.twcheeseReport.resources) {\r\n                continue;\r\n            }\r\n            for (let [i, col] of Object.entries(colIndexes)) {\r\n                let chars = row.cells[col].innerText.length;\r\n                maxChars[i] = Math.max(chars, maxChars[i]);\r\n            }\r\n        }\r\n\r\n        this.alignCols(colIndexes, maxChars);\r\n    }\r\n\r\n\r\n    alignCols(colIndexes, maxChars) {\r\n        let charWidth = 8;\r\n        let widthSum = 0;\r\n        for (let [i, col] of Object.entries(colIndexes)) {\r\n            let width = charWidth * maxChars[i];\r\n            width = Math.max(20, width);\r\n            widthSum += width;\r\n\r\n            let alignmentTh = this.$head[0].rows[0].cells[col];\r\n            let bodyCell = this.$body[0].rows[0].cells[col];\r\n\r\n            alignmentTh.style.width = width + 'px';\r\n            bodyCell.style.width = width + 'px';\r\n        }\r\n\r\n        let padding = 3 * 2 * colIndexes.length;\r\n        let borderSpacing = 2 * (colIndexes.length - 1);\r\n        let width = widthSum + borderSpacing + padding;\r\n        \r\n        let titleTh = cellAtIndex(this.$head[0].rows[1], colIndexes[0]);\r\n        titleTh.style.width = width + 'px';\r\n    }\r\n\r\n\r\n    selectMatchingReports(isReportMatch) {\r\n        for (let report of this.reports.values()) {\r\n            if (isReportMatch(report)) {\r\n                $(`input[name='id_${report.reportId}']`).prop('checked', true);\r\n            }\r\n        }\r\n    }\r\n\r\n    deselectAllReports() {\r\n        for (let report of this.reports.values()) {\r\n            $(`input[name='id_${report.reportId}']`).prop('checked', false);\r\n        }\r\n    }\r\n\r\n}\r\n\r\n\r\n\r\n\r\n\r\n// jquery-ui. Used for resizable\r\ninitCss(`\r\n    .ui-icon-gripsmall-diagonal-se { background-position: -64px -224px; }\r\n\r\n    /* Icons\r\n    ----------------------------------*/\r\n\r\n    .ui-icon {\r\n        display: block;\r\n        text-indent: -99999px;\r\n        overflow: hidden;\r\n        background-repeat: no-repeat;\r\n    }\r\n\r\n    .ui-icon {\r\n        width: 16px;\r\n        height: 16px;\r\n    }\r\n    .ui-icon,\r\n    .ui-widget-content .ui-icon {\r\n        background-image: url(${ImageSrc.jq.darkGrey});\r\n    }\r\n    .ui-widget-header .ui-icon {\r\n        background-image: url(${ImageSrc.jq.black});\r\n    }\r\n    .ui-state-default .ui-icon {\r\n        background-image: url(${ImageSrc.jq.grey});\r\n    }\r\n    .ui-state-hover .ui-icon,\r\n    .ui-state-focus .ui-icon {\r\n        background-image: url(${ImageSrc.jq.darkGrey});\r\n    }\r\n    .ui-state-active .ui-icon {\r\n        background-image: url(${ImageSrc.jq.darkGrey});\r\n    }\r\n    .ui-state-highlight .ui-icon {\r\n        background-image: url(${ImageSrc.jq.blue});\r\n    }\r\n    .ui-state-error .ui-icon,\r\n    .ui-state-error-text .ui-icon {\r\n        background-image: url(${ImageSrc.jq.red});\r\n    }\r\n\r\n    /* Overlays */\r\n    .ui-widget-overlay {\r\n        position: fixed;\r\n        top: 0;\r\n        left: 0;\r\n        width: 100%;\r\n        height: 100%;\r\n    }\r\n    .ui-resizable {\r\n        position: relative;\r\n    }\r\n    .ui-resizable-handle {\r\n        position: absolute;\r\n        font-size: 0.1px;\r\n        display: block;\r\n    }\r\n    .ui-resizable-disabled .ui-resizable-handle,\r\n    .ui-resizable-autohide .ui-resizable-handle {\r\n        display: none;\r\n    }\r\n    .ui-resizable-n {\r\n        cursor: n-resize;\r\n        height: 7px;\r\n        width: 100%;\r\n        top: -5px;\r\n        left: 0;\r\n    }\r\n    .ui-resizable-s {\r\n        cursor: s-resize;\r\n        height: 7px;\r\n        width: 100%;\r\n        bottom: -5px;\r\n        left: 0;\r\n    }\r\n    .ui-resizable-e {\r\n        cursor: e-resize;\r\n        width: 7px;\r\n        right: -5px;\r\n        top: 0;\r\n        height: 100%;\r\n    }\r\n    .ui-resizable-w {\r\n        cursor: w-resize;\r\n        width: 7px;\r\n        left: -5px;\r\n        top: 0;\r\n        height: 100%;\r\n    }\r\n    .ui-resizable-se {\r\n        cursor: se-resize;\r\n        width: 12px;\r\n        height: 12px;\r\n        right: 1px;\r\n        bottom: 1px;\r\n    }\r\n    .ui-resizable-sw {\r\n        cursor: sw-resize;\r\n        width: 9px;\r\n        height: 9px;\r\n        left: -5px;\r\n        bottom: -5px;\r\n    }\r\n    .ui-resizable-nw {\r\n        cursor: nw-resize;\r\n        width: 9px;\r\n        height: 9px;\r\n        left: -5px;\r\n        top: -5px;\r\n    }\r\n    .ui-resizable-ne {\r\n        cursor: ne-resize;\r\n        width: 9px;\r\n        height: 9px;\r\n        right: -5px;\r\n        top: -5px;\r\n    }\r\n`);\r\n\r\n\r\n\n// CONCATENATED MODULE: ./src/Widget/ReportsFolder/DisplayConfigurer.js\n\r\n\r\n\r\n\r\n\r\nclass DisplayConfigurer_DisplayConfigurer {\r\n    /**\r\n     * @param {ReportListWidget} reportListWidget \r\n     */\r\n    constructor(reportListWidget) {\r\n        this.widget = reportListWidget;\r\n    }\r\n\r\n    /**\r\n     * @param {string} key \r\n     * @return {boolean}\r\n     */\r\n    shouldShowColumn(key) {\r\n        let startHidden = columnCategories.get(key).startHidden;\r\n        return userConfig.get(`ReportListWidget.showCols.${key}`, !startHidden);\r\n    }\r\n\r\n    /**\r\n     * @param {string} key \r\n     */\r\n    toggleColumn(key) {\r\n        this.widget.toggleReportsColumns(key);\r\n    }\r\n\r\n    /**\r\n     * @return {{key:string, description:string}}\r\n     */\r\n    getHideableColumns() {\r\n        return columnCategories.getHideableCategories()\r\n            .map(category => {\r\n                return {\r\n                    key: category.key,\r\n                    description: category.description\r\n                }\r\n            });\r\n    }\r\n\r\n    refreshDisplay() {\r\n        this.widget.refreshContents();\r\n    }\r\n\r\n}\r\n\r\n\n// CONCATENATED MODULE: ./src/Widget/ReportsFolder/DisplayConfigWidget.js\n\r\n\r\n\r\nclass DisplayConfigWidget_DisplayConfigWidget extends AbstractWidget {\r\n\r\n    /**\r\n     * @param {DisplayConfigurer} displayConfigurer\r\n     */\r\n    constructor(displayConfigurer) {\r\n        super();\r\n\r\n        var reportsFolderSettingsDiv = document.createElement('div');\r\n        reportsFolderSettingsDiv.id = 'twcheese_reportsFolderSettings';\r\n        reportsFolderSettingsDiv.style.display = 'none';\r\n        reportsFolderSettingsDiv.style.columnWidth = '200px';\r\n        this.$el = $(reportsFolderSettingsDiv);\r\n        \r\n        function insertCheckbox(key, text) {\r\n            let $el = $(`<div style=\"white-space:nowrap\"><label><input type=\"checkbox\"> ${text}</label></div>`);\r\n            $el.find('input')\r\n                .prop('checked', displayConfigurer.shouldShowColumn(key))\r\n                .on('click', () => {\r\n                    displayConfigurer.toggleColumn(key);\r\n                });\r\n\r\n            reportsFolderSettingsDiv.appendChild($el[0]);\r\n        }\r\n\r\n        for (let col of displayConfigurer.getHideableColumns()) {\r\n            insertCheckbox(col.key, col.description);\r\n        }\r\n    }\r\n}\r\n\r\n\n// CONCATENATED MODULE: ./src/Models/RepeatAttackLinks/Exporter.js\n\r\n\r\n\r\nclass Exporter_Exporter {\r\n\r\n    /**\r\n     * @param {BattleReportCondensed[]} reports \r\n     * @param {string} attackFrom\r\n     * @param {string} headerText\r\n     * @return {string}\r\n     */\r\n    buildExportText(reports, attackFrom, headerText) {\r\n        let exportText = this.buildHeader(headerText);\r\n\r\n        for (let report of reports) {\r\n            if (!report.defenderVillage) {\r\n                continue; // not enough information\r\n            }\r\n            if (report.attackerName !== game_data.player.name) {\r\n                continue; // can't repeat somebody else's attack\r\n            }\r\n            if (attackFrom === Exporter_Exporter.ATTACK_FROM_CURRENT) {\r\n                exportText += \"\\n\" + this.buildEntryCurrentVillage(report);\r\n            }\r\n            else if (attackFrom === Exporter_Exporter.ATTACK_FROM_ORIGINAL && report.attackerVillage) {\r\n                exportText += \"\\n\" + this.buildEntryOriginalVillage(report);\r\n            } \r\n        }\r\n\r\n        exportText += \"\\n\" + this.buildFooter();\r\n        return exportText;\r\n    }\r\n\r\n    /**\r\n     * @param {BattleReportCondensed} report\r\n     * @return {string}\r\n     */\r\n    urlCurrentVillage(report) {\r\n        return gameUrl('place', {try: 'confirm', type: 'same', report_id: report.reportId});\r\n    }\r\n\r\n    /**\r\n     * @param {BattleReportCondensed} report\r\n     * @return {string}\r\n     */\r\n    urlOriginalVillage(report) {\r\n        return gameUrl('place', {try: 'confirm', type: 'same', report_id: report.reportId, village: report.attackerVillage.id});\r\n    }\r\n\r\n    /**\r\n     * @abstract\r\n     * @param {string} text\r\n     * @return {string}\r\n     */\r\n    buildHeader(text) {\r\n        throw Error('not implemented');\r\n    }\r\n\r\n    /**\r\n     * @abstract\r\n     * @param {BattleReportCondensed} report\r\n     * @return {string}\r\n     */\r\n    buildEntryCurrentVillage(report) {\r\n        throw Error('not implemented');\r\n    }\r\n\r\n    /**\r\n     * @abstract\r\n     * @param {BattleReportCondensed} report\r\n     * @return {string}\r\n     */\r\n    buildEntryOriginalVillage(report) {\r\n        throw Error('not implemented');\r\n    }\r\n\r\n    /**\r\n     * @abstract\r\n     * @return {string}\r\n     */\r\n    buildFooter() {\r\n        throw Error('not implemented');\r\n    }\r\n\r\n}\r\n\r\nExporter_Exporter.ATTACK_FROM_CURRENT = 'current';\r\nExporter_Exporter.ATTACK_FROM_ORIGINAL = 'original';\r\n\r\n\r\n\n// CONCATENATED MODULE: ./src/Models/RepeatAttackLinks/ExporterBBCode.js\n\r\n\r\n\r\nclass ExporterBBCode_ExporterBBCode extends Exporter_Exporter {\r\n\r\n    /**\r\n     * @param {string} text\r\n     * @return {string}\r\n     */\r\n    buildHeader(text) {\r\n        return `[b][u][size=12]${text}[/size][/u][/b]`;\r\n    }\r\n\r\n    /**\r\n     * @param {BattleReportCondensed} report\r\n     * @return {string}\r\n     */\r\n    buildEntryCurrentVillage(report) {\r\n        return '[url=' + this.urlCurrentVillage(report) + ']repeat attack ' + report.reportId + ' from (' + game_data.village.coord + ') to (' + report.defenderVillage.x + '|' + report.defenderVillage.y + ')[/url]';\r\n    }\r\n\r\n    /**\r\n     * @param {BattleReportCondensed} report\r\n     * @return {string}\r\n     */\r\n    buildEntryOriginalVillage(report) {\r\n        return '[url=' + this.urlOriginalVillage(report) + ']repeat attack ' + report.reportId + ' from (' + report.attackerVillage.x + '|' + report.attackerVillage.y + ') to (' + report.defenderVillage.x + '|' + report.defenderVillage.y + ')[/url]';\r\n    }\r\n\r\n    /**\r\n     * @return {string}\r\n     */\r\n    buildFooter() {\r\n        return '';\r\n    }\r\n\r\n}\r\n\r\n\r\n\n// CONCATENATED MODULE: ./src/Models/RepeatAttackLinks/ExporterPlainText.js\n\r\n\r\n\r\nclass ExporterPlainText_ExporterPlainText extends Exporter_Exporter {\r\n\r\n    /**\r\n     * @param {string} text\r\n     * @return {string}\r\n     */\r\n    buildHeader(text) {\r\n        return text;\r\n    }\r\n\r\n    /**\r\n     * @param {BattleReportCondensed} report\r\n     * @return {string}\r\n     */\r\n    buildEntryCurrentVillage(report) {\r\n        return this.urlCurrentVillage(report);\r\n    }\r\n\r\n    /**\r\n     * @param {BattleReportCondensed} report\r\n     * @return {string}\r\n     */\r\n    buildEntryOriginalVillage(report) {\r\n        return this.urlOriginalVillage(report);\r\n    }\r\n\r\n    /**\r\n     * @return {string}\r\n     */\r\n    buildFooter() {\r\n        return '';\r\n    }\r\n\r\n}\r\n\r\n\r\n\n// CONCATENATED MODULE: ./src/Models/RepeatAttackLinks/ExporterHTML.js\n\r\n\r\n\r\nclass ExporterHTML_ExporterHTML extends Exporter_Exporter {\r\n\r\n    /**\r\n     * @param {string} text\r\n     * @return {string}\r\n     */\r\n    buildHeader(text) {\r\n        return [\r\n            '<!DOCTYPE NETSCAPE-Bookmark-file-1>\\n<META HTTP-EQUIV=\"Content-Type\" CONTENT=\"text/html; charset=UTF-8\">',\r\n            `\\n<DT><H3>${text}</H3></DT>\\n<DL><P>`\r\n        ].join('');\r\n    }\r\n\r\n    /**\r\n     * @param {BattleReportCondensed} report\r\n     * @return {string}\r\n     */\r\n    buildEntryCurrentVillage(report) {\r\n        let leadingZero = '';\r\n        let distance = report.defenderDistance(game_data.village);\r\n        if (distance < 10) {\r\n            leadingZero = '0';\r\n        }\r\n        return '<DT><A HREF=\"' + this.urlCurrentVillage(report) + '\" >' + leadingZero + distance + ' Repeat Attack ' + report.reportId + ' from (' + game_data.village.coord + ') to (' + report.defenderVillage.x + '|' + report.defenderVillage.y + ')</A></DT>';\r\n    }\r\n\r\n    /**\r\n     * @param {BattleReportCondensed} report\r\n     * @return {string}\r\n     */\r\n    buildEntryOriginalVillage(report) {\r\n        return '<DT><A HREF=\"' + this.urlOriginalVillage(report) + '\" >Repeat Attack ' + report.reportId + ' from (' + report.attackerVillage.x + '|' + report.attackerVillage.y + ') to (' + report.defenderVillage.x + '|' + report.defenderVillage.y + ')</A></DT>';\r\n    }\r\n\r\n    /**\r\n     * @return {string}\r\n     */\r\n    buildFooter() {\r\n        return '</P></DL>';\r\n    }\r\n\r\n}\r\n\r\n\r\n\n// CONCATENATED MODULE: ./src/Widget/ReportsFolder/ExportRepeatLinksWidget.js\n\r\n\r\n\r\n\r\n\r\n\r\nclass ExportRepeatLinksWidget_ExportRepeatLinksWidget extends AbstractWidget {\r\n\r\n    /**\r\n     * @param {Map.<BattleReportCondensed>} reports \r\n     */\r\n    constructor(reports) {\r\n        super();\r\n        this.reports = reports;\r\n        this.defaultHeader = 'new cheesy attack group';\r\n\r\n        this.exporters = {\r\n            bbcode: new ExporterBBCode_ExporterBBCode(),\r\n            plainLink: new ExporterPlainText_ExporterPlainText(),\r\n            html: new ExporterHTML_ExporterHTML()\r\n        };\r\n\r\n        this.initStructure();\r\n        this.watchSelf();\r\n        this.updateExportText();\r\n    }\r\n\r\n    initStructure() {\r\n        this.$el = $(this.createHtml().trim());\r\n        this.$exportText = this.$el.find('.twcheese-export-text');\r\n        this.$buttonCopy = this.$el.find('.twcheese-button-copy');\r\n        this.$headerInput = this.$el.find('#twcheese_export_header');\r\n        this.$formatOptions = this.$el.find(\"input[name='twcheese-repeat-attack-export-format']\");\r\n        this.$attackingVillageOptions = this.$el.find(\"input[name='twcheese-repeat-attack-export-village']\");\r\n    }\r\n\r\n    createHtml() {\r\n        return `\r\n            <table id=\"twcheese_reportsFolderExport\" style=\"display: none;\">\r\n                <td>\r\n                    <textarea class=\"twcheese-export-text\" rows=\"10\" cols=\"40\" readonly=\"true\" />\r\n                </td>\r\n                <td>\r\n                    <table id=\"twcheese_exportConfigTable\">\r\n                        <tr>\r\n                            <th>Format</th>\r\n                            <th>Attacking Village</th>\r\n                        </tr>\r\n                        <tr>\r\n                            <td>\r\n                                <input type=\"radio\" name=\"twcheese-repeat-attack-export-format\" checked=\"true\" value=\"bbcode\"/> BBCode\r\n                                <br/><input type=\"radio\" name=\"twcheese-repeat-attack-export-format\" value=\"plainLink\"/> plain links\r\n                                <br/><input type=\"radio\" name=\"twcheese-repeat-attack-export-format\" value=\"html\"/> HTML\r\n                            </td>\r\n                            <td>\r\n                                <input type=\"radio\" name=\"twcheese-repeat-attack-export-village\" checked=\"true\" value=\"current\"/> current village\r\n                                <br/><input type=\"radio\" name=\"twcheese-repeat-attack-export-village\" value=\"original\"/> original village\r\n                            </td>\r\n                        </tr>\r\n                        <tr>\r\n                            <td colspan=\"2\">\r\n                                Header: <input type=\"text\" id=\"twcheese_export_header\" value=\"${this.defaultHeader}\" />\r\n                            </td>\r\n                        </tr>\r\n                        <tr>\r\n                            <td colspan=\"2\" style=\"text-align: center; padding-top: 20px;\">\r\n                                <a class=\"twcheese-button-copy btn btn-default\" href=\"#\">Copy to clipboard</a>\r\n                            </td>\r\n                        </tr>\r\n                    </table>\r\n                </td>\r\n            </table>\r\n        `;\r\n    }\r\n\r\n    watchSelf() {\r\n        this.$headerInput.on('click', () => {\r\n            if (this.$headerInput.val() === this.defaultHeader) {\r\n                this.$headerInput.val('');\r\n            }\r\n            this.updateExportText();\r\n        });\r\n\r\n        this.$headerInput.on('input', (e) => {\r\n            this.updateExportText();\r\n        });\r\n\r\n        this.$formatOptions.on('change', (e) => {\r\n            this.updateExportText();\r\n        });\r\n\r\n        this.$attackingVillageOptions.on('change', (e) => {\r\n            this.updateExportText();\r\n        });\r\n\r\n        this.$buttonCopy.on('click', (e) => {\r\n            e.preventDefault();\r\n            this.$exportText.select();\r\n            document.execCommand('copy');\r\n            window.UI.SuccessMessage('Copied to clipboard');\r\n        });\r\n    }\r\n\r\n    updateExportText() {\r\n        let format = this.$formatOptions.filter(':checked').val();\r\n        let attackFrom = this.$attackingVillageOptions.filter(':checked').val();\r\n        let headerText = this.$headerInput.val();\r\n\r\n        let exporter = this.exporters[format];\r\n        let exportText = exporter.buildExportText(this.reports.values(), attackFrom, headerText);\r\n        this.$exportText.val(exportText);\r\n    }\r\n\r\n}\r\n\r\n\n// CONCATENATED MODULE: ./src/Widget/ReportsFolder/ReportSelector.js\n\r\nclass ReportSelector {\r\n\r\n    /**\r\n     * @param {ReportListWidget} reportListWidget\r\n     */\r\n    constructor(reportListWidget) {\r\n        this.widget = reportListWidget;\r\n    }\r\n\r\n    /**\r\n     * @return {number[]}\r\n     */\r\n    getSelectedReportIds() {\r\n        return this.widget.getSelectedReportIds();\r\n    }\r\n\r\n    selectNew() {\r\n        this.widget.selectMatchingReports(report => report.isNew);\r\n    }\r\n\r\n    selectOld() {\r\n        this.widget.selectMatchingReports(report => !report.isNew);\r\n    }\r\n\r\n    selectAll() {\r\n        this.widget.selectMatchingReports(report => true);\r\n    }\r\n\r\n    selectNone() {\r\n        this.widget.deselectAllReports();\r\n    }\r\n\r\n    selectDotColor(dotColor) {\r\n        this.widget.selectMatchingReports(report => report.dotColor === dotColor);\r\n    }\r\n\r\n    selectForwarded() {\r\n        this.widget.selectMatchingReports(report => report.isForwarded);\r\n    }\r\n\r\n    /**\r\n     * @param {number} haulStatus 0 for non full haul, 1 for full haul\r\n     */\r\n    selectLoot(haulStatus) {\r\n        this.widget.selectMatchingReports(report => report.haulStatus === haulStatus);\r\n    }\r\n\r\n    selectFeint() {\r\n        this.widget.selectMatchingReports(report => report.wasAttackFeint);\r\n    }\r\n\r\n    selectDeadNoble() {\r\n        this.widget.selectMatchingReports(report => report.attackerNobleDied);\r\n    }\r\n\r\n    selectLoyalty() {\r\n        this.widget.selectMatchingReports(report => report.loyalty !== null);\r\n    }\r\n\r\n    selectCleared() {\r\n        this.widget.selectMatchingReports(report => report.wasDefenderCleared());\r\n    }\r\n\r\n    selectText(text) {\r\n        let textLower = text.toLowerCase();\r\n        this.widget.selectMatchingReports(report => report.subject.toLowerCase().includes(textLower));\r\n    }\r\n\r\n    selectAttacker(attackerName) {\r\n        let nameLower = attackerName.toLowerCase();\r\n        this.widget.selectMatchingReports(report => report.attackerName && report.attackerName.toLowerCase().includes(nameLower));\r\n    }\r\n\r\n    selectDefender(defenderName) {\r\n        let nameLower = defenderName.toLowerCase();\r\n        this.widget.selectMatchingReports(report => report.defenderName && report.defenderName.toLowerCase().includes(nameLower));\r\n    }\r\n\r\n    selectAttackerVillage(coordinates) {\r\n        let [, x, y] = coordinates.match(/(\\d+)\\|(\\d+)/);\r\n        x = parseInt(x);\r\n        y = parseInt(y);\r\n\r\n        this.widget.selectMatchingReports(report => {\r\n            if (!report.attackerVillage) {\r\n                return false;\r\n            }\r\n\r\n            return report.attackerVillage.x === x\r\n                && report.attackerVillage.y === y;\r\n        });\r\n    }\r\n\r\n    selectDefenderVillage(coordinates) {\r\n        let [, x, y] = coordinates.match(/(\\d+)\\|(\\d+)/);\r\n        x = parseInt(x);\r\n        y = parseInt(y);\r\n\r\n        this.widget.selectMatchingReports(report => {\r\n            if (!report.defenderVillage) {\r\n                return false;\r\n            }\r\n            \r\n            return report.defenderVillage.x === x\r\n                && report.defenderVillage.y === y;\r\n        });\r\n    }\r\n\r\n}\r\n\r\n\n// CONCATENATED MODULE: ./src/Widget/ReportsFolder/ReportSelectorWidget.js\n\r\n\r\n\r\n\r\nclass ReportSelectorWidget_ReportSelectorWidget extends AbstractWidget {\r\n    /**\r\n     * @param {ReportSelector} reportSelector \r\n     */\r\n    constructor(reportSelector) {\r\n        super();\r\n\r\n        var reportsSelectorBar = document.createElement('div');\r\n        this.$el = $(reportsSelectorBar);\r\n        reportsSelectorBar.id = 'twcheese_reportsSelectorBar';\r\n        reportsSelectorBar.style.borderStyle = 'solid';\r\n        reportsSelectorBar.style.borderWidth = '1px';\r\n\r\n        /*==== label ====*/\r\n        var reportsSelectorBarLabel = document.createElement('div');\r\n        reportsSelectorBar.appendChild(reportsSelectorBarLabel);\r\n        reportsSelectorBarLabel.style.backgroundColor = 'rgb(193, 162, 100) !important';\r\n        reportsSelectorBarLabel.style.backgroundImage = 'linear-gradient(rgb(229,194,126), rgb(193,162,100))';\r\n        reportsSelectorBarLabel.style.backgroundRepeat = 'repeat-x';\r\n        reportsSelectorBarLabel.style.fontSize = '9pt';\r\n        reportsSelectorBarLabel.style.fontWeight = '700';\r\n        reportsSelectorBarLabel.innerHTML = 'SELECT';\r\n        reportsSelectorBarLabel.style.height = '18px';\r\n        reportsSelectorBarLabel.style.paddingLeft = '3px';\r\n\r\n        /*==== clicky table ====*/\r\n        var selectorClickyTable = document.createElement('table');\r\n        reportsSelectorBar.appendChild(selectorClickyTable);\r\n        selectorClickyTable.className = 'vis';\r\n        selectorClickyTable.insertRow(-1);\r\n\r\n        let imgHtml = src => `<img style=\"display:block; margin-left:auto; margin-right:auto\" src=\"${src}\"/>`;\r\n\r\n        let clickyOptions = new Map([\r\n            ['all', {\r\n                click: () => reportSelector.selectAll(),\r\n                html: 'all'\r\n            }],\r\n            ['none', {\r\n                click: () => reportSelector.selectNone(),\r\n                html: 'none'\r\n            }],\r\n            ['new', {\r\n                click: () => reportSelector.selectNew(),\r\n                html: 'new'\r\n            }],\r\n            ['old', {\r\n                click: () => reportSelector.selectOld(),\r\n                html: 'old'\r\n            }],\r\n            ['dotGreen', {\r\n                click: () => reportSelector.selectDotColor('green'),\r\n                html: imgHtml('graphic/dots/green.png')\r\n            }],\r\n            ['dotYellow', {\r\n                click: () => reportSelector.selectDotColor('yellow'),\r\n                html: imgHtml('graphic/dots/yellow.png')\r\n            }],\r\n            ['dotRed', {\r\n                click: () => reportSelector.selectDotColor('red'),\r\n                html: imgHtml('graphic/dots/red.png')\r\n            }],\r\n            ['dotBlue', {\r\n                click: () => reportSelector.selectDotColor('blue'),\r\n                html: imgHtml('graphic/dots/blue.png')\r\n            }],\r\n            ['forwarded', {\r\n                click: () => reportSelector.selectForwarded(),\r\n                html: imgHtml('graphic/forwarded.png')\r\n            }],\r\n            ['haulPartial', {\r\n                click: () => reportSelector.selectLoot(BattleReportCondensed.HAUL_STATUS_PARTIAL),\r\n                html: imgHtml('graphic/max_loot/0.png')\r\n            }],\r\n            ['haulFull', {\r\n                click: () => reportSelector.selectLoot(BattleReportCondensed.HAUL_STATUS_FULL),\r\n                html: imgHtml('graphic/max_loot/1.png')\r\n            }],\r\n            ['feint', {\r\n                click: () => reportSelector.selectFeint(),\r\n                html: imgHtml('graphic/dots/grey.png'),\r\n                tooltip: 'feint'\r\n            }],\r\n            ['deadNoble', {\r\n                click: () => reportSelector.selectDeadNoble(),\r\n                html: imgHtml(ImageSrc.troopIcon('priest')),\r\n                tooltip: 'dead noble'\r\n            }],\r\n            ['loyalty', {\r\n                click: () => reportSelector.selectLoyalty(),\r\n                html: '<span style=\"display:block; margin-left:auto; margin-right:auto\" class=\"icon ally lead\"/>',\r\n                tooltip: 'loyalty change'\r\n            }],\r\n            ['cleared', {\r\n                click: () => reportSelector.selectCleared(),\r\n                html: 'defenseless'\r\n            }]\r\n        ]);\r\n\r\n        for (let [descriptor, option] of clickyOptions) {\r\n            let optionEl = $(`<a href=\"#\">${option.html}</a>`)[0];\r\n            if (option.tooltip) {\r\n                optionEl.title = option.tooltip;\r\n            }\r\n            optionEl.addEventListener('click', function(e) {\r\n                e.preventDefault();\r\n                option.click();\r\n            });\r\n\r\n            let cell = selectorClickyTable.rows[0].insertCell(-1);\r\n            cell.style.width = '25px';\r\n            cell.style.textAlign = 'center';        \r\n            cell.appendChild(optionEl);\r\n        }\r\n\r\n        /*==== input table ====*/\r\n        var selectorInputTable = document.createElement('table');\r\n        reportsSelectorBar.appendChild(selectorInputTable);\r\n        selectorInputTable.className = 'vis';\r\n        selectorInputTable.insertRow(-1);\r\n\r\n        let inputOptions = [\r\n            {\r\n                hintInput: 'contains text',\r\n                hintButton: 'select text',\r\n                use: (text) => reportSelector.selectText(text),\r\n                sprite: [-140, 0]\r\n            },\r\n            {\r\n                hintInput: 'attacker',\r\n                hintButton: 'select attacking player',\r\n                use: (attackerName) => reportSelector.selectAttacker(attackerName),\r\n                sprite: [-80, 0]\r\n            },\r\n            {\r\n                hintInput: 'defender',\r\n                hintButton: 'select defending player',\r\n                use: (defenderName) => reportSelector.selectDefender(defenderName),\r\n                sprite: [-80, 0]\r\n            },\r\n            {\r\n                hintInput: 'origin',\r\n                hintButton: 'select attacking village',\r\n                placeholder: 'x|y',\r\n                use: (coords) => reportSelector.selectAttackerVillage(coords),\r\n                sprite: [-120, 0]\r\n            },\r\n            {\r\n                hintInput: 'target',\r\n                hintButton: 'select defending village',\r\n                placeholder: 'x|y',\r\n                use: (coords) => reportSelector.selectDefenderVillage(coords),\r\n                sprite: [-120, 0]\r\n            }\r\n        ];\r\n\r\n        for (let option of inputOptions) {\r\n            let input = document.createElement('input');\r\n            input.type = 'text';\r\n            input.size = 10;\r\n            input.value = option.hintInput;\r\n            input.placeholder = option.placeholder || '';\r\n            let alreadyCleared = false;\r\n            input.addEventListener('mousedown', function() {\r\n                if (alreadyCleared) {\r\n                    return;\r\n                }\r\n                this.value = '';\r\n                alreadyCleared = true;\r\n            });\r\n\r\n            let $button = $(`<a href=\"#\" title=\"${option.hintButton}\"></a>`)\r\n                .on('click', function(e) {\r\n                    e.preventDefault();\r\n                    option.use(input.value);\r\n                });\r\n\r\n            let $buttonIcon = $('<span>&nbsp;</span>')\r\n                .css({\r\n                    display: 'inline-block',\r\n                    background: `url(graphic/bbcodes/bbcodes.png) no-repeat ${option.sprite[0]}px ${option.sprite[1]}px`,\r\n                    paddingLeft: 0,\r\n                    paddingBottom: 0,\r\n                    margin: 3,\r\n                    width: 20,\r\n                    height: 20\r\n                });\r\n\r\n            $button.append($buttonIcon);\r\n\r\n            let cell = selectorInputTable.rows[0].insertCell(-1);\r\n            cell.appendChild(input);\r\n            cell.appendChild($button[0]);\r\n        }\r\n    }\r\n\r\n\r\n}\r\n\r\n\r\n\n// CONCATENATED MODULE: ./src/Widget/ReportsFolder/MassRenamerWidget.js\n\r\n\r\n\r\n\r\n\r\nvar MassRenamerWidget_language = { \"twcheese\": {} };\r\nswitch (game_data.market) {\r\n    default:\r\n        /*==== tribalwars.net, tribalwars.us, tribalwars.co.uk, beta.tribalwars.net ====*/\r\n        MassRenamerWidget_language['twcheese']['noReportsSelected'] = 'You haven\\'t selected any reports to be renamed.';\r\n        break;\r\n\r\n    case 'cz':\r\n        /*==== divokekmeny.cz/ ====*/\r\n        MassRenamerWidget_language['twcheese']['noReportsSelected'] = 'Nejdříve si musíte vybrat, které zprávy přejmenovat.';\r\n        break;\r\n\r\n    case 'se':\r\n        MassRenamerWidget_language['twcheese']['noReportsSelected'] = 'Du har inte valt några rapporter som skall döpas om.';\r\n        break;\r\n\r\n    /*==== fyletikesmaxes.gr/ ====*/\r\n    case 'gr':\r\n        MassRenamerWidget_language['twcheese']['noReportsSelected'] = 'Δεν έχεις επιλέξει  καμιά αναφορά για μετονομασία';\r\n        break;\r\n\r\n    /* Norwegian */\r\n    case 'no':\r\n        MassRenamerWidget_language['twcheese']['noReportsSelected'] = 'Du har ikke valgt hvilke rapporter som skal endres navn på.';\r\n        break;\r\n                        \r\n}\r\n\r\n\r\nclass MassRenamerWidget_MassRenamerWidget extends AbstractWidget {\r\n\r\n    /**\r\n     * @param {Map.<number, BattleReportCondensed>} reports\r\n     * @param {ReportRenamer} renamer\r\n     * @param {ReportSelector} reportSelector\r\n     * @param {DisplayConfigurer} displayConfigurer\r\n     */\r\n    constructor(reports, renamer, reportSelector, displayConfigurer) {\r\n        super();\r\n        this.reports = reports;\r\n        this.renamer = renamer;\r\n        this.reportSelector = reportSelector;\r\n        this.displayConfigurer = displayConfigurer;\r\n\r\n        this.initStructure();\r\n        this.watchSelf();\r\n    }\r\n\r\n    initStructure() {\r\n        this.$el = $(`\r\n            <table class=\"vis\">\r\n                <tbody>\r\n                    <tr>\r\n                        <td>\r\n                            <a class=\"twcheese-button-rename\" href=\"#\">&raquo; Rename</a>\r\n                            <img src=\"/graphic/questionmark.png?1\" width=\"13\" height=\"13\" title=\"rename selected reports to twCheese format\">\r\n                        </td>\r\n                        <td style=\"textAlign: right;\">Progress:</td>\r\n                        <td style=\"width: 40px;\"><span id=\"twcheese_progress_percent\">0</span>%</td>\r\n                        <td style=\"width: 136px;\">(<span id=\"twcheese_progress_count\">0</span>/<span id=\"twcheese_progress_count_max\">0</span> reports)</td>\r\n                        <td>time remaining: <span id=\"twcheese_time_remaining\">00:00</span></td>\r\n                    </tr>\r\n                </tbody>\r\n            </table>\r\n        `.trim());\r\n\r\n        this.$buttonRename = this.$el.find('.twcheese-button-rename');\r\n        this.$progressCount = this.$el.find('#twcheese_progress_count');\r\n        this.$targetCount = this.$el.find('#twcheese_progress_count_max');\r\n        this.$progressPercent = this.$el.find('#twcheese_progress_percent');\r\n        this.$timeRemaining = this.$el.find('#twcheese_time_remaining');\r\n    }\r\n\r\n    watchSelf() {\r\n        this.$buttonRename.on('click', (e) => {\r\n            e.preventDefault();\r\n            this.massRename();\r\n        });\r\n    }\r\n\r\n    async massRename() {\r\n        let reportIds = this.reportSelector.getSelectedReportIds();\r\n        let total = reportIds.length;\r\n        let progress = 0;\r\n\r\n        if (total === 0) {\r\n            window.UI.ErrorMessage(MassRenamerWidget_language['twcheese']['noReportsSelected'], 3000);\r\n            return;\r\n        }\r\n\r\n        this.$progressCount.text(0);\r\n        this.$targetCount.text(total);\r\n        \r\n        var estimatedTimeRemaining;\r\n\r\n        /*==== rename reports 1 by 1 ====*/\r\n\r\n        for (let reportId of reportIds) {\r\n            let startTime = performance.now();           \r\n\r\n            try {\r\n                let reportDoc = await requestDocument(gameUrl('report', {mode: game_data.mode, view: reportId}));\r\n\r\n                let scraper = new BattleReportScraper_BattleReportScraper(reportDoc);\r\n                let fullReport = scraper.scrapeReport();\r\n                let name = await this.renamer.rename(fullReport, '');\r\n    \r\n                $('.quickedit[data-id=\"' + reportId + '\"]')\r\n                    .find('.quickedit-label').html(name);\r\n    \r\n                /*==== update reports information so row can be redrawn with updated information====*/\r\n    \r\n                let oldReport = this.reports.get(reportId);\r\n    \r\n                let report = this.renamer.parseName(name);\r\n                report.reportId = reportId;\r\n                report.attackIcons = oldReport.attackIcons;\r\n                report.dotColor = oldReport.dotColor;\r\n                report.haulStatus = oldReport.haulStatus;\r\n                report.isForwarded = oldReport.isForwarded;\r\n                report.strTimeReceived = oldReport.strTimeReceived;\r\n    \r\n                this.reports.set(report.reportId, report);\r\n    \r\n    \r\n                /*==== update progress display ====*/\r\n                progress++;\r\n                var millisElapsed = performance.now() - startTime;\r\n                estimatedTimeRemaining = (millisElapsed * (total - progress)) / 1000;\r\n                var minutesRemaining = Math.floor(estimatedTimeRemaining / 60);\r\n                var secondsRemaining = Math.round(estimatedTimeRemaining - (minutesRemaining * 60));\r\n                if (minutesRemaining < 10)\r\n                    minutesRemaining = '0' + minutesRemaining;\r\n                if (secondsRemaining < 10)\r\n                    secondsRemaining = '0' + secondsRemaining;\r\n                this.$timeRemaining.text(`${minutesRemaining}:${secondsRemaining}`);\r\n                this.$progressCount.text(progress);\r\n                this.$progressPercent.text(Math.round(progress / total * 100));\r\n            }\r\n            catch (e) {\r\n                console.error('error renaming report:', e);\r\n            }\r\n\r\n        }\r\n        \r\n        this.displayConfigurer.refreshDisplay();\r\n    }\r\n\r\n}\r\n\r\n\n// CONCATENATED MODULE: ./src/Widget/ReportsFolder/ReportsFolderWidget.js\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\nclass ReportsFolderWidget_ReportsFolderWidget extends AbstractWidget {\r\n    constructor(reports, renamer) {\r\n        super();\r\n        this.reports = reports;\r\n\r\n        let reportListWidget = new ReportListWidget_ReportListWidget(this.reports);\r\n        let displayConfigurer = new DisplayConfigurer_DisplayConfigurer(reportListWidget);\r\n        let reportSelector = new ReportSelector(reportListWidget);\r\n\r\n        /*==== create twcheese reports folder ====*/\r\n        var reportsFolder = document.createElement('div');\r\n        reportsFolder.id = 'twcheese_reportsFolder';\r\n        this.$el = $(reportsFolder);\r\n\r\n        /*==== reports folder toolbar ====*/\r\n        var reportsFolderToolbar = document.createElement('div');\r\n        reportsFolder.appendChild(reportsFolderToolbar);\r\n        reportsFolderToolbar.id = 'twcheese_reportsFolderToolbar';\r\n\r\n        reportsFolderToolbar.currentPanel = 'none';\r\n        reportsFolderToolbar.toggleDisplayConfig = function () {\r\n            if (this.currentPanel == 'displayConfig') {\r\n                document.getElementById('twcheese_displayConfig_tab').className = '';\r\n                document.getElementById('twcheese_reportsFolderSettings').style.display = 'none';\r\n                this.currentPanel = 'none';\r\n            }\r\n            else {\r\n                document.getElementById('twcheese_displayConfig_tab').className = 'selected';\r\n                document.getElementById('twcheese_export_tab').className = '';\r\n                document.getElementById('twcheese_reportsFolderSettings').style.display = '';\r\n                document.getElementById('twcheese_reportsFolderExport').style.display = 'none';\r\n                this.currentPanel = 'displayConfig';\r\n            }\r\n        };\r\n\r\n        reportsFolderToolbar.toggleExport = function () {\r\n            if (this.currentPanel == 'exportLinks') {\r\n                document.getElementById('twcheese_export_tab').className = '';\r\n                document.getElementById('twcheese_reportsFolderExport').style.display = 'none';\r\n                this.currentPanel = 'none';\r\n            }\r\n            else {\r\n                document.getElementById('twcheese_export_tab').className = 'selected';\r\n                document.getElementById('twcheese_displayConfig_tab').className = '';\r\n                document.getElementById('twcheese_reportsFolderExport').style.display = '';\r\n                document.getElementById('twcheese_reportsFolderSettings').style.display = 'none';\r\n                this.currentPanel = 'exportLinks';\r\n            }\r\n        };\r\n\r\n        /*==== toolbar tabs ====*/\r\n        reportsFolderToolbar.innerHTML += `\r\n            <table style=\"border-style:solid; border-width:0px;\" class=\"vis modemenu\">\r\n                <tbody>\r\n                    <tr>\r\n                        <td id=\"twcheese_displayConfig_tab\" style=\"border-style:solid; border-width:1px; cursor:default;\" onclick=\"document.getElementById(\\'twcheese_reportsFolderToolbar\\').toggleDisplayConfig();\">\r\n                            <a>configure display</a>\r\n                        </td>\r\n                        <td id=\"twcheese_export_tab\" style=\"border-style:solid; border-width:1px; cursor:default;\" onclick=\"document.getElementById(\\'twcheese_reportsFolderToolbar\\').toggleExport();\">\r\n                            <a>export repeat-attack links</a>\r\n                        </td>\r\n                    </tr>\r\n                </tbody>\r\n            </table>`;\r\n\r\n\r\n        /*==== export links to repeat attacks ====*/\r\n        let exportLinksWidget = new ExportRepeatLinksWidget_ExportRepeatLinksWidget(this.reports);\r\n        exportLinksWidget.appendTo(reportsFolderToolbar);\r\n\r\n        /*==== display settings ====*/\r\n        (new DisplayConfigWidget_DisplayConfigWidget(displayConfigurer))\r\n            .appendTo(reportsFolderToolbar);\r\n\r\n        /*==== reports display ====*/\r\n        reportListWidget\r\n            .appendTo(reportsFolder);\r\n\r\n        /*==== reports selector bar ====*/\r\n        (new ReportSelectorWidget_ReportSelectorWidget(reportSelector))\r\n            .appendTo(reportsFolder);\r\n\r\n        /*==== mass renamer ====*/\r\n        (new MassRenamerWidget_MassRenamerWidget(this.reports, renamer, reportSelector, displayConfigurer))\r\n            .appendTo(reportsFolder);\r\n\r\n    }\r\n}\r\n\r\n\r\ninitCss(`\r\n    #twcheese_reportsFolder {\r\n        margin-bottom: 30px;\r\n    }\r\n`);\r\n\r\n\r\n\n// EXTERNAL MODULE: ./src/Models/Debug/Build/ProcessFactory.js\nvar ProcessFactory = __webpack_require__(3);\n\n// CONCATENATED MODULE: ./dist/tool/cfg/debug/BRE/Default.js\nlet processCfg = { phases: [{\"type\":\"PhaseQuestion\",\"internalName\":\"Entry\",\"questions\":[{\"type\":\"QuestionFreeForm\",\"ask\":\"What's broken?\",\"placeholderText\":\"e.g. \\\"it shows wrong OD scores\\\"\",\"minResponseLength\":10}]}] };\r\n\r\n\n// CONCATENATED MODULE: ./src/ToolSetup/BRE.js\n/* global $, game_data */\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\nlet initialized = false;\r\nlet reportEnhanced = false;\r\nlet reportsFolderEnhanced = false;\r\n\r\nasync function useTool() {\r\n    if (!initialized) {\r\n        await ensureRemoteConfigsUpdated();\r\n        initBRE();\r\n        initialized = true;\r\n    }\r\n\r\n    if (game_data.screen == 'report' && document.URL.includes('&view=')) {\r\n        // user is viewing single report\r\n        if (!reportEnhanced) {\r\n            enhanceReport();\r\n            reportEnhanced = true;\r\n        }\r\n    }\r\n    else if (game_data.screen == 'report' && (game_data.mode == 'attack' || game_data.mode == 'defense')) {\r\n        // user is viewing reports folder with 'Attacks' or \"Defenses\" filter on\r\n        if (!reportsFolderEnhanced) {\r\n            enhanceReportsFolder();\r\n            reportsFolderEnhanced = true;\r\n        }\r\n    }\r\n    else {\r\n        alert('try using this on:\\n1) a battle report\\n2) a reports folder, with the \"Attacks\" filter on\\n3) a reports folder, with the \"Defenses\" filter on');\r\n    }\r\n}\r\n\r\n\r\nfunction initBRE() {\r\n\r\n    /*==== contact information ====*/\r\n    var narcismDiv = document.createElement('div');\r\n    document.getElementById('content_value').insertBefore(narcismDiv, document.getElementById('content_value').firstChild);\r\n    narcismDiv.innerHTML = 'BRE created by <a href=\"https://forum.tribalwars.net/index.php?members/28484\">cheesasaurus</a>';\r\n    narcismDiv.style.fontSize = '10px';\r\n\r\n    /*==== help ====*/\r\n    spawnLegacyHelpButton('https://forum.tribalwars.net/index.php?threads/256225/');\r\n}\r\n\r\n\r\nfunction enhanceReport() {\r\n    let scraper = new BattleReportScraper_BattleReportScraper(document);\r\n    let report = scraper.scrapeReport();\r\n\r\n    let renamer = new ReportRenamer_ReportRenamer();\r\n\r\n    $(renamer).on('report-renamed', function(e) {\r\n        $('.quickedit[data-id=\"' + e.reportId + '\"]')\r\n            .find('.quickedit-label')\r\n            .html(e.newName);\r\n    });\r\n\r\n    if (userConfig.get('BattleReportEnhancer.autoRename', false)) {\r\n        renamer.rename(report, '');\r\n    }\r\n\r\n    enhanceBattleReport(document, report);\r\n\r\n    (new ReportToolsWidget_ReportToolsWidget(report, renamer))\r\n        .insertBefore($('#content_value').find('h2').eq(0));\r\n}\r\n\r\n\r\nfunction enhanceReportsFolder() {\r\n    let renamer = new ReportRenamer_ReportRenamer();\r\n\r\n    let oldReportsList = document.getElementById('report_list');\r\n    let reportsForm = oldReportsList.parentNode;\r\n  \r\n    // scrape listed reports\r\n    let reportScraper = new BattleReportCondensedScraper_BattleReportCondensedScraper(renamer);\r\n    let reports = new Map();\r\n    for (let report of reportScraper.scrapeReports(oldReportsList)) {\r\n        reports.set(report.reportId, report);\r\n    }\r\n\r\n    // enhance list and add tools\r\n    reportsForm.removeChild(oldReportsList);\r\n\r\n    (new ReportsFolderWidget_ReportsFolderWidget(reports, renamer))\r\n        .insertBefore(reportsForm.firstChild);\r\n}\r\n\r\n\r\n// register tool ///////////////////////////////////////////////////////\r\n\r\nlet processFactory = new ProcessFactory[\"a\" /* ProcessFactory */]({});\r\n\r\nfunction newDebugProcess() {\r\n    let name = 'Tool: Battle Report Enhancer';\r\n    return processFactory.create(name, processCfg, true);\r\n}\r\n\r\n\r\nwindow.TwCheese.registerTool({\r\n    id: 'BRE',\r\n    use: useTool,\r\n    getDebugProcess: newDebugProcess\r\n});\n\n/***/ })\n/******/ ]);"]}